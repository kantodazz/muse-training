@model IFMIS.Areas.IFMISTZ.Models.Contract
@{
    ViewBag.Title = "Contract Receiving";
}



<div id="content" style="margin: 5px; padding-top: 30px">

    <div class="row">


    </div>


    <!-- widget grid 1 -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID start)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2> Contract Receiving </h2>

                    </header>


                    <div>
                        <div class="widget-body " style="padding-top:10px;width:100%">

                            <br />
                            <br />


                            <div class="row">
                                @using (Html.BeginForm(null, null, FormMethod.Post))
                                {
                                    <div class="col-lg-3 col-sm-3 col-xs-3">
                                        <div class="input-group"><input class="form-control" id="ContractNo" name="ContractNo" placeholder="Contract Reg Number" value='@ViewBag.ContractNo' type="text" autocomplete="off" /><span class="input-group-btn"><button class="btn shiny  " id="search" type="submit">Search</button></span></div>
                                    </div>
                                }

                                <br />
                                <br />
                                <br />
                                <hr />
                            </div>

                            @if (ViewBag.ContractNo != null)
                            {
                                if (ViewBag.Invalid == "Yes")
                                {
                                    <h3><font color="red">Contract of this number either does not exist, not approved,or full received!!!</font></h3>
                                    <div class="col-md-offset-1">
                                        <a href="@Url.Action("PendingReceiving","Contract")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>



                                    </div>
                                    <br />
                                    <br />
                                }
                                else
                                {
                                    if (Model.Received == "Full")
                                    {
                                        <h3><font color="red">This contract already full received !!!</font></h3>
                                        <div class="col-md-offset-1">
                                            <a href="@Url.Action("PendingReceiving","Contract")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                        </div>
                                        <br />
                                        <br />
                                    }

                                    else
                                    {
                                        <p align="left">
                                            <span>Contract Number&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.ContractNumber</strong></span><br />
                                            <span>Contract Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.ContractName</strong></span><br />
                                            <span>Supplier&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.Payeename</strong></span><br />
                                            <span>Payee Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.PayeeCode</strong></span><br />
                                            Currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.OperationalCurrency</strong><br />Contract Start Date&nbsp;:<strong>@Convert.ToDateTime(Model.ContractStartDate).ToString("dd/MM/yyyy")</strong><br />Contract End Date&nbsp;&nbsp;:<strong>@Convert.ToDateTime(Model.ContractEndDate).ToString("dd/MM/yyyy")</strong><br />Description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong>@Model.ContractDescription</strong>
                                        </p>
                                        <hr />
                                        <input type="hidden" id="PayeeCode" name="PayeeCode" value='@Model.PayeeCode'>
                                        <input type="hidden" id="PayeeName" name="PayeeName" value='@Model.Payeename'>
                                        <div class="row">

                                            <div class="col-md-offset-2 col-md-3">
                                                @Html.DropDownList("ReceiveType", new List<SelectListItem>{
                                                new SelectListItem{ Text="Receive By Quantity", Value = "Quantity" },
                                                new SelectListItem{ Text="Receive By Amount", Value = "Amount" },
                                        }, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <br />
                                        <div class="row">
                                            <div class="col-md-2">
                                                <strong>Choose Payment Schedule</strong>
                                            </div>
                                            <div class="col-md-3">
                                                @Html.DropDownList("PaymentScheduleId", Model.PaymentScheduleList, "Select ---", new { @class = "form-control" })
                                                @Html.HiddenFor(model => model.ContractId)
                                                <input type="hidden" name="CountItems" id="CountItems" value="">
                                            </div>
                                        </div>
                                        <hr />
                                        <p align="left" class="schedule_info" style="display:none">
                                            Total Amount &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="payment_amount"></span></strong><br />
                                            Description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="description"></span></strong><br />
                                            Deliverable &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="deliverable"></span></strong><br />
                                            Received Amount &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="previous_amount"></span></strong><br />
                                            Received Percentage:<strong><span id="percentage"></span></strong><br />
                                            Balance &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="balance"></span></strong><br />

                                        </p>
                                        <p align="left" class="schedule_info2" style="display:none">
                                            Total Amount &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="payment_amount2"></span></strong><br />
                                            Description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="description2"></span></strong><br />
                                            Deliverable &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<strong><span id="deliverable2"></span></strong><br />
                                        </p>
                                        using (Html.BeginForm(null, null, FormMethod.Post, new { id = "ReceivingItems" }))
                                        {
                                            <table class="table  table-bordered table-hover table-condensed" id="items"></table>
                                            <table class="table  table-bordered table-hover table-condensed" id="certificate_payment"></table>
                                            <div align="center">
                                                <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" style="display:none" />
                                            </div>
                                            <div class="receiving_form" style="display:none">
                                                <div class="new_certificate" style="display:none">
                                                    <div class="row">
                                                        <div class="col-md-offset-1 col-sm-6 col-lg-4">
                                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse1" class="btn btn-info btn-xs">&nbsp;&nbsp;&nbsp;New Certificate&nbsp;&nbsp;&nbsp;</a>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div id="collapse1" class="panel-collapse collapse">
                                                        <div class="row">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <label class="col-md-5 control-label"><strong>Certificate Number:</strong></label>
                                                                    <div class="col-md-7">
                                                                        <input type="text" name="certificate_number" id="certificate_number" class="form-control" autocomplete="off">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br />
                                                        <div class="row">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <label class="col-md-5 control-label"><strong>Certificate Amount:</strong></label>
                                                                    <div class="col-md-7">
                                                                        <input type="text" name="certificate_amount" id="certificate_amount" class="form-control" autocomplete="off">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br />

                                                        <div class="row">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <label class="col-md-5 control-label"><strong>Available Amount:</strong></label>
                                                                    <div class="col-md-7">

                                                                        <input type="text" name="available_amount" id="available_amount" class="form-control" autocomplete="off">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br />
                                                        <div class="row">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <label class="col-md-7 control-label"><strong>Has Advance Payment ?:</strong></label>
                                                                    <div class="col-md-5">
                                                                        <input type="checkbox" name="advancePayment2" id="advancePayment2" value="">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br />

                                                        <div class="row" style="display:none" id="advance_payment2">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <label class="col-md-5 control-label"><strong>Paid Vouchers:</strong></label>
                                                                    <div class="col-md-7">
                                                                        <button type="button" class="btn btn-info search_vouchers2" data-toggle="modal" data-target="#search_vouchers2">
                                                                            <i class="fa fa-search"></i> <span class="hidden-mobile">Search Paid Vouchers</span>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br />
                                                            <br />
                                                        </div>
                                                        <table class="table table-condensed table-hover table-bordered" id="advance_payments2">
                                                            <thead>

                                                            </thead>

                                                            <tbody></tbody>
                                                        </table>
                                                        <div class="row">
                                                            <div class="col-sm-8 col-lg-4">
                                                                <div class="form-group">
                                                                    <div class="col-md-offset-5 col-md-7">
                                                                        <button type="button" class="save_payment btn btn-info">
                                                                            <i class="glyphicon glyphicon-floppy-disk"></i> Save
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="certificate" style="display:none">
                                                    <div class="row">
                                                        <div class="col-sm-8 col-lg-4">
                                                            <div class="form-group">
                                                                <label class="col-md-5 control-label"><strong>Certificate Number:</strong></label>
                                                                <div class="col-md-7">
                                                                    <input type="text" name="CertificateNumber" id="CertificateNumber" class="form-control" autocomplete="off">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br />
                                                    <div class="row">
                                                        <div class="col-sm-8 col-lg-4">
                                                            <div class="form-group">
                                                                <label class="col-md-5 control-label"><strong>Certificate Amount:</strong></label>
                                                                <div class="col-md-7">
                                                                    <input type="text" name="CertificateAmount" id="CertificateAmount" class="form-control" autocomplete="off">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br />
                                                    <div class="row">
                                                        <div class="col-sm-8 col-lg-4">
                                                            <div class="form-group">
                                                                <label class="col-md-5 control-label"><strong>Available Amount:</strong></label>
                                                                <div class="col-md-7">

                                                                    <input type="text" name="AvailableAmount" id="AvailableAmount" class="form-control" autocomplete="off">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br />
                                                    <div class="row">
                                                        <div class="col-sm-8 col-lg-4">
                                                            <div class="form-group">
                                                                <label class="col-md-7 control-label"><strong>Has Advance Payment ?:</strong></label>
                                                                <div class="col-md-5">
                                                                    <input type="checkbox" name="advancePayment" id="advancePayment" value="">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br />

                                                    <div class="row" style="display:none" id="advance_payment">
                                                        <div class="col-sm-8 col-lg-4">
                                                            <div class="form-group">
                                                                <label class="col-md-5 control-label"><strong>Paid Vouchers:</strong></label>
                                                                <div class="col-md-7">
                                                                    <button type="button" class="btn btn-info search_vouchers" data-toggle="modal" data-target="#search_vouchers">
                                                                        <i class="fa fa-search"></i> <span class="hidden-mobile">Search Paid Vouchers</span>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br />
                                                        <br />
                                                    </div>
                                                    <table class="table table-condensed table-hover table-bordered" id="advance_payments">
                                                        <thead>

                                                        </thead>

                                                        <tbody></tbody>
                                                    </table>

                                                </div>
                                            </div>
                                    
                                            //Advance payment for Receiving By Quantity
                                            <div class="display_advance_payment" style="display:none">
                                                <br />
                                                <div class="row">
                                                    <div class="col-sm-8 col-lg-4">
                                                        <div class="form-group">
                                                            <label class="col-md-7 control-label"><strong>Has Advance Payment ?:</strong></label>
                                                            <div class="col-md-5">
                                                                <input type="checkbox" name="advancePayment4" id="advancePayment4" value="">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <br />

                                                <div class="row" style="display:none" id="advance_payment4">
                                                    <div class="col-sm-8 col-lg-4">
                                                        <div class="form-group">
                                                            <label class="col-md-5 control-label"><strong>Paid Vouchers:</strong></label>
                                                            <div class="col-md-7">
                                                                <button type="button" class="btn btn-info search_vouchers4" data-toggle="modal" data-target="#search_vouchers4">
                                                                    <i class="fa fa-search"></i> <span class="hidden-mobile">Search Paid Vouchers</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br />
                                                    <br />
                                                </div>
                                                <table class="table table-condensed table-hover table-bordered" id="advance_payments4">
                                                    <thead>

                                                    </thead>

                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                            //End Advance payment for Receiving By Quantity

                                            <div class="col-md-offset-1">
                                                <a href="@Url.Action("PendingReceiving","Contract")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                                <button type="button" class="save_button btn btn-info" style="margin-right:2px;display:none">
                                                    <i class="glyphicon glyphicon-floppy-disk"></i> Save
                                                </button>

                                            </div>
                                        }

                                        <br />
                                        <br />
                                    }
                                }


                            }
                            else
                            {
                                <div align="center">
                                    <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" style="display:none" />
                                </div>
                                <div class="col-md-offset-1">
                                    <a href="@Url.Action("PendingReceiving","Contract")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                </div>
                                <br />
                                <br />

                            }


                        </div>





                    </div>


                </div>
            </article>

        </div>
    </section>

</div>

<div class="modal fade" id="contract_payment" style="left:4%">

    <div class="modal-dialog" style="width:70%;">
        <div class="modal-content panel-info">

            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title" style="text-align:center"> Certificate Payment</h3>

            </div>

            @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "payment_form" }))
            {
                <div class="modal-body form-horizontal">

                    <br />

                    <input type="hidden" name="id" id="id" value="">
                    <input type="hidden" name="balance_amt" id="balance_amt" value="">
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Certificate Number:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="certificate_no" id="certificate_no" class="form-control" readonly autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Certificate Amount:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="certificate_amt" id="certificate_amt" class="form-control" readonly autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Previous Amount Paid:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="previous_amt" id="previous_amt" class="form-control" readonly autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>New Amount:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="new_amount" id="new_amount" class="form-control" required autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-7 control-label"><strong>Advance Payment ?:</strong></label>
                                <div class="col-md-5" style="padding-top:8px">
                                    <input type="checkbox" name="advancePayment3" id="advancePayment3" value="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="display:none" id="advance_payment">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Paid Vouchers:</strong></label>
                                <div class="col-md-7">
                                    <button type="button" class="btn btn-info search_vouchers3" data-toggle="modal" data-target="#search_vouchers3">
                                        <i class="fa fa-search"></i> <span class="hidden-mobile">Search Paid Vouchers</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                    <table class="table table-condensed table-hover table-bordered" id="advance_payments">
                        <thead>

                        </thead>

                        <tbody></tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                    <input class="btn btn-info" type="submit" id="btnSubmit" value="Save" />
                    @*<input type="submit" value="Submit" class="btn btn-success" id="btnSubmit" />*@

                </div>

            }
        </div>
    </div>
</div>

<div class="modal fade" id="edit_certificate" style="left:4%">

    <div class="modal-dialog" style="width:35%;">
        <div class="modal-content panel-info">

            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title" style="text-align:center"> Certificate Payment</h3>

            </div>

            @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "certificate_form", enctype = "multipart/form-data", onsubmit = "return SubmitEditCertificate(this)" }))
            {
                <div class="modal-body2 form-horizontal">

                    <br />

                    <input type="hidden" name="ContractPaymentId" id="ContractPaymentId" value="">
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Certificate Number:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="CertificateNumber" id="CertificateNumber" class="form-control" required autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 col-lg-10">
                            <div class="form-group">
                                <label class="col-md-5 control-label"><strong>Certificate Amount:</strong></label>
                                <div class="col-md-7">
                                    <input type="text" name="CertificateAmount" id="CertificateAmount" class="form-control" required autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                    <input class="btn btn-info" type="submit" id="btnSubmit" value="Save" />
                    @*<input type="submit" value="Submit" class="btn btn-success" id="btnSubmit" />*@

                </div>

            }
        </div>
    </div>
</div>

<!----------- Search  Voucher----------------->
<div class="modal fade" id="search_vouchers" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Previous Paid Vouchers</h3>
            </div>
            <div class="modal-body">
                @*<table>
                        <tr>
                            <td style="padding:5px">Total Items Amount</td>
                            <td style="padding:5px">
                                <input type="text" disabled id="total_items_amount">
                            </td>

                            <td style="padding:5px">Total Line Amount</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="total_line_amount">
                            </td>

                            <td style="padding:5px">Difference</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="difference" style="width:250px">
                            </td>
                        </tr>
                    </table>*@
                <div>

                    <strong>Payee:</strong><span id="payee"></span><br />
                    <strong>Payee Code:</strong><span id="payee_code"></span>


                    <div class="row" style="padding-top:1%;padding-bottom:1%">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <div class="search-container " style="float:right">
                                <i class="fa fa-search search-icon"></i>
                                <input type="search" name="search" placeholder="Search..." id="search_voucher">
                            </div>
                        </div>
                    </div>
                    <div align="center">
                        <img src="/Media/Images/ajax_loader.gif" class="loadingImg" />
                    </div>
                    <table id="dt_search_voucher" class="table table-striped table-bordered table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Vourcher Number</th>
                                <th>Description</th>
                                <th>Voucher Amount</th>
                                <th> Balance</th>
                                <th> Amount</th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" id="btn_save_voucher">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button class="btn btn-info" data-dismiss="modal">
                        <i class="fa  fa-times"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------- Search Voucher ----------------->
<!----------- Search  Voucher----------------->
<div class="modal fade" id="search_vouchers2" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Previous Paid Vouchers </h3>
            </div>
            <div class="modal-body">
                @*<table>
                        <tr>
                            <td style="padding:5px">Total Items Amount</td>
                            <td style="padding:5px">
                                <input type="text" disabled id="total_items_amount">
                            </td>

                            <td style="padding:5px">Total Line Amount</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="total_line_amount">
                            </td>

                            <td style="padding:5px">Difference</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="difference" style="width:250px">
                            </td>
                        </tr>
                    </table>*@
                <div>

                    <strong>Payee:</strong><span id="payee"></span><br />
                    <strong>Payee Code:</strong><span id="payee_code"></span>


                    <div class="row" style="padding-top:1%;padding-bottom:1%">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <div class="search-container " style="float:right">
                                <i class="fa fa-search search-icon"></i>
                                <input type="search" name="search" placeholder="Search..." id="search_voucher">
                            </div>
                        </div>
                    </div>
                    <div align="center">
                        <img src="/Media/Images/ajax_loader.gif" class="loadingImg" />
                    </div>
                    <table id="dt_search_voucher2" class="table table-striped table-bordered table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Vourcher Number</th>
                                <th>Description</th>
                                <th>Voucher Amount</th>
                                <th> Balance</th>
                                <th> Amount</th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" id="btn_save_voucher">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button class="btn btn-info" data-dismiss="modal">
                        <i class="fa  fa-times"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!----------- Search Voucher ----------------->
<div class="modal fade" id="search_vouchers3" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Previous Paid Vouchers</h3>
            </div>
            <div class="modal-body">
                @*<table>
                        <tr>
                            <td style="padding:5px">Total Items Amount</td>
                            <td style="padding:5px">
                                <input type="text" disabled id="total_items_amount">
                            </td>

                            <td style="padding:5px">Total Line Amount</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="total_line_amount">
                            </td>

                            <td style="padding:5px">Difference</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="difference" style="width:250px">
                            </td>
                        </tr>
                    </table>*@
                <div>

                    <strong>Payee:</strong><span id="payee"></span><br />
                    <strong>Payee Code:</strong><span id="payee_code"></span>


                    <div class="row" style="padding-top:1%;padding-bottom:1%">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <div class="search-container " style="float:right">
                                <i class="fa fa-search search-icon"></i>
                                <input type="search" name="search" placeholder="Search..." id="search_voucher">
                            </div>
                        </div>
                    </div>
                    <div align="center">
                        <img src="/Media/Images/ajax_loader.gif" class="loadingImg" />
                    </div>
                    <table id="dt_search_voucher3" class="table table-striped table-bordered table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Vourcher Number</th>
                                <th>Description</th>
                                <th>Voucher Amount</th>
                                <th> Balance</th>
                                <th> Amount</th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" id="btn_save_voucher">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button class="btn btn-info" data-dismiss="modal">
                        <i class="fa  fa-times"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------- Search  Voucher----------------->
<div class="modal fade" id="search_vouchers4" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Previous Paid Vouchers </h3>
            </div>
            <div class="modal-body">
                @*<table>
                        <tr>
                            <td style="padding:5px">Total Items Amount</td>
                            <td style="padding:5px">
                                <input type="text" disabled id="total_items_amount">
                            </td>

                            <td style="padding:5px">Total Line Amount</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="total_line_amount">
                            </td>

                            <td style="padding:5px">Difference</td>
                            <td style="padding:5px">
                                <input value="0" type="text" disabled id="difference" style="width:250px">
                            </td>
                        </tr>
                    </table>*@
                <div>

                    <strong>Payee:</strong><span id="payee"></span><br />
                    <strong>Payee Code:</strong><span id="payee_code"></span>


                    <div class="row" style="padding-top:1%;padding-bottom:1%">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <div class="search-container " style="float:right">
                                <i class="fa fa-search search-icon"></i>
                                <input type="search" name="search" placeholder="Search..." id="search_voucher">
                            </div>
                        </div>
                    </div>
                    <div align="center">
                        <img src="/Media/Images/ajax_loader.gif" class="loadingImg" />
                    </div>
                    <table id="dt_search_voucher4" class="table table-striped table-bordered table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Vourcher Number</th>
                                <th>Description</th>
                                <th>Voucher Amount</th>
                                <th> Balance</th>
                                <th> Amount</th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" id="btn_save_voucher">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button class="btn btn-info" data-dismiss="modal">
                        <i class="fa  fa-times"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------- Search Voucher ----------------->
@section pagespecific {
    <!-- PAGE RELATED PLUGIN(S) -->

    <script type="text/javascript">
         var vouchersCharges = [];
        function SubmitEditCertificate(formData) {

            var url = '@Url.Action("EditCertificate", "Contract")';
            var ajaxConfig = {
                type: "post",
                url: url,
                data: new FormData(formData),
                success: function (result) {
                    if (result == "Success") {

                        swal("Changed successfully", { icon: "Success" })
                            .then((value) => {
                                      $('#edit_certificate').modal('hide');
                                        location.reload();
                                    });
                    }
                    else if (result == "Exceed") {
                      swal("Certificate amount can not be less than the amount previous received");
                    }
                    else if (result == "ScheduleExceed") {
                      swal("Certificate amount can not exceed balance in payment schedule");
                    }
                    else {
                        swal("Failed  due to DbException");
                    }
                }
            }

            if ($(formData).attr('enctype') == "multipart/form-data") {
                ajaxConfig["contentType"] = false;
                ajaxConfig["processData"] = false;
            }
            $.ajax(ajaxConfig);
            return false;
        }
        // =========== End Payment Certificate ====================
        $(document).ready(function () {
            $(function(){
              $('input[type="checkbox"][name="advancePayment"]').click(function(){
                  if ($(this).is(':checked')) {
                         $("#advance_payment").show();
                  } else {
                      $('#advance_payments').empty();
                       vouchersCharges = [];
                      $("#advance_payment").hide();

                  }
              });
            });
             $(function(){
              $('input[type="checkbox"][name="advancePayment2"]').click(function(){
                  if ($(this).is(':checked')) {
                         $("#advance_payment2").show();
                  } else {
                      $('#advance_payments2').empty();
                       vouchersCharges = [];
                      $("#advance_payment2").hide();

                  }
              });
             });
             $(function(){
              $('input[type="checkbox"][name="advancePayment3"]').click(function(){
                  if ($(this).is(':checked')) {
                         $("#contract_payment #advance_payment").show();
                  } else {
                      $('#contract_payment #advance_payments').empty();
                       vouchersCharges = [];
                      $("#contract_payment #advance_payment").hide();

                  }
              });
             });

            $(function(){
              $('input[type="checkbox"][name="advancePayment4"]').click(function(){
                  if ($(this).is(':checked')) {
                         $("#advance_payment4").show();
                  } else {
                      $('#advance_payments4').empty();
                       vouchersCharges = [];
                      $("#advance_payment4").hide();

                  }
              });
             });
            var dt_search_voucher = $('#dt_search_voucher').dataTable();
                $("#dt_search_voucher_wrapper .dt-toolbar").remove();
               $(".search_vouchers #search_voucher").on("keyup search input paste cut", function () {
                dt_search_voucher.DataTable().search(this.value).draw();
               });

              var dt_search_voucher2 = $('#dt_search_voucher2').dataTable();
                $("#dt_search_voucher2_wrapper .dt-toolbar").remove();
               $(".search_vouchers2 #search_voucher2").on("keyup search input paste cut", function () {
                dt_search_voucher2.DataTable().search(this.value).draw();
               });

                var dt_search_voucher3 = $('#dt_search_voucher3').dataTable();
                $("#dt_search_voucher3_wrapper .dt-toolbar").remove();
               $(".search_vouchers3 #search_voucher3").on("keyup search input paste cut", function () {
                dt_search_voucher3.DataTable().search(this.value).draw();
               });
               var dt_search_voucher4 = $('#dt_search_voucher4').dataTable();
                $("#dt_search_voucher4_wrapper .dt-toolbar").remove();
               $(".search_vouchers4 #search_voucher4").on("keyup search input paste cut", function () {
                dt_search_voucher4.DataTable().search(this.value).draw();
               });

            $(".search_vouchers").on('click', function () {
                    var payee = $(".search_vouchers#PayeeName").val();
                    var payee_code = $("#PayeeCode").val();
                    $("#search_vouchers #payee").text(payee);
                    $("#search_vouchers #payee_code").text(payee_code);
                    vouchersCharges = [];
                    var url = '@Url.Action("GetVouchers", "Contract")';
                    var payeeCodeParams = { "payeeCode": payee_code };
                    $.ajax({
                        type: "get",
                        url: url,
                        data: payeeCodeParams,
                        contenttype: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (response) {
                            if (response == "NoVourcher") {
                              swal("No any paid voucher to this payee");
                            }
                            else if (response == "DbException") {
                              swal("Db Exception,Please contact technical supporter ");
                            }
                            else {
                                data = response.data;
                                dt_search_voucher.fnClearTable();
                                for (var i = 0; i < data.length; i++) {

                                    dt_search_voucher.fnAddData([i + 1,
                                    data[i]["PVNo"],
                                    data[i]["Narration"],
                                    toLabel(data[i]["Amount"]),
                                    toLabel(data[i]["Balance"]),
                                    '<amount-input placeholder="Amount" max="' + data[i]["Balance"] + '"  onkeyup="amountChanged(this)" />'
                                    ]);
                                }
                            }
                        },
                        failure: function (error) {
                            swal(error);
                        }
                    });

              });


            $(".search_vouchers2").on('click', function () {
                    var payee = $("#PayeeName").val();
                    var payee_code = $("#PayeeCode").val();
                    $("#search_vouchers2 #payee").text(payee);
                    $("#search_vouchers2 #payee_code").text(payee_code);
                    vouchersCharges = [];
                    var url = '@Url.Action("GetVouchers", "Contract")';
                    var payeeCodeParams = { "payeeCode": payee_code };
                    $.ajax({
                        type: "get",
                        url: url,
                        data: payeeCodeParams,
                        contenttype: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (response) {
                           if (response == "NoVourcher") {
                              swal("No any paid voucher to this payee");
                            }
                            else if (response == "DbException") {
                              swal("Db Exception,Please contact technical supporter ");
                            }
                            else {
                                data = response.data;
                                dt_search_voucher2.fnClearTable();
                                for (var i = 0; i < data.length; i++) {

                                    dt_search_voucher2.fnAddData([i + 1,
                                    data[i]["PVNo"],
                                    data[i]["Narration"],
                                    toLabel(data[i]["Amount"]),
                                    toLabel(data[i]["Balance"]),
                                    '<amount-input placeholder="Amount" max="' + data[i]["Balance"] + '"  onkeyup="amountChanged2(this)" />'
                                    ]);
                                }
                            }
                        },
                        failure: function (error) {
                            swal(error);
                        }
                    });

              });

            $(".search_vouchers3").on('click', function () {
                    var payee = $("#PayeeName").val();
                    var payee_code = $("#PayeeCode").val();
                    $("#search_vouchers3 #payee").text(payee);
                    $("#search_vouchers3 #payee_code").text(payee_code);
                    vouchersCharges = [];
                    var url = '@Url.Action("GetVouchers", "Contract")';
                    var payeeCodeParams = { "payeeCode": payee_code };
                    $.ajax({
                        type: "get",
                        url: url,
                        data: payeeCodeParams,
                        contenttype: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (response) {
                           if (response == "NoVourcher") {
                              swal("No any paid voucher to this payee");
                            }
                            else if (response == "DbException") {
                              swal("Db Exception,Please contact technical supporter ");
                            }
                            else {
                                data = response.data;
                                dt_search_voucher3.fnClearTable();
                                for (var i = 0; i < data.length; i++) {

                                    dt_search_voucher3.fnAddData([i + 1,
                                    data[i]["PVNo"],
                                    data[i]["Narration"],
                                    toLabel(data[i]["Amount"]),
                                    toLabel(data[i]["Balance"]),
                                    '<amount-input placeholder="Amount" max="' + data[i]["Balance"] + '"  onkeyup="amountChanged3(this)" />'
                                    ]);
                                }
                            }
                        },
                        failure: function (error) {
                            swal(error);
                        }
                    });

            });

                $(".search_vouchers4").on('click', function () {
                    var payee = $("#PayeeName").val();
                    var payee_code = $("#PayeeCode").val();
                    $("#search_vouchers4 #payee").text(payee);
                    $("#search_vouchers4 #payee_code").text(payee_code);
                    vouchersCharges = [];
                    var url = '@Url.Action("GetVouchers", "Contract")';
                    var payeeCodeParams = { "payeeCode": payee_code };
                    $.ajax({
                        type: "get",
                        url: url,
                        data: payeeCodeParams,
                        contenttype: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (response) {
                           if (response == "NoVourcher") {
                              swal("No any paid voucher to this payee");
                            }
                            else if (response == "DbException") {
                              swal("Db Exception,Please contact technical supporter ");
                            }
                            else {
                                data = response.data;
                                dt_search_voucher4.fnClearTable();
                                for (var i = 0; i < data.length; i++) {

                                    dt_search_voucher4.fnAddData([i + 1,
                                    data[i]["PVNo"],
                                    data[i]["Narration"],
                                    toLabel(data[i]["Amount"]),
                                    toLabel(data[i]["Balance"]),
                                    '<amount-input placeholder="Amount" max="' + data[i]["Balance"] + '"  onkeyup="amountChanged4(this)" />'
                                    ]);
                                }
                            }
                        },
                        failure: function (error) {
                            swal(error);
                        }
                    });

              });

            $(function () {
                $("#PaymentScheduleId").change(function (e) {
                    var schedule_id = $("#PaymentScheduleId").val();
                    var receiveType = $("#ReceiveType").val();
                    if (receiveType == "Quantity") {
                        if (schedule_id) {
                            $(".receiving_form").hide();
                            $(".schedule_info").hide();
                            $(".schedule_info2").show();
                            var contract_number = '@(ViewBag.ContractNo)';
                            var form_data = {
                                "contractNo": contract_number,
                                "id": schedule_id
                            }
                            var url = '@Url.Action("GetReceivingItems", "Contract")';
                            $.ajax(
                            {
                                type: "POST", //HTTP POST Method
                                url: url, // Controller/View
                                data: form_data,
                                success: function (data) {
                                    if (data == "DbException") {
                                        swal("Failed to fetch items ,DbException, contact system supporter");

                                    }
                                    else if (data == "Received") {
                                        swal("This payment schedule previously  received By Amount partially");

                                    } else {
                                        $("#items").empty();
                                        $(".save_button").show();
                                        $(".display_advance_payment").show();
                                        $('#advance_payments4').empty();
                                        vouchersCharges = [];
                                        $("#payment_amount2").text(data.schedule.Amount.toLocaleString('en'));
                                        $("#description2").text(data.schedule.Description);
                                        $("#deliverable2").text(data.schedule.Deliverable);

                                        var number = data.Result.length;
                                        var total_quantity = 0;
                                        var total_VAT = 0;
                                        var total_amount = 0;
                                        var total_amount = 0;
                                        var j = 0;
                                        if (number > 0) {
                                            $('<thead>').appendTo('#items');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Schedule Items</th><th style="text-align:center" colspan="3">Receiving Items</th></tr>').appendTo('#items');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:18%">Item</th><th style="text-align:left;width:15%">Unit Of Measure</th><th style="text-align:right;width:8%">Quantity</th><th style="text-align:right;width:9%">Unit Price</th><th style="text-align:right;width:9%">VAT</th><th style="text-align:right;width:10%">Total Amount</th><th style="text-align:center;width:8%">Quantity</th><th style="text-align:center;width:9%">VAT</th><th style="text-align:center;width:10%">Total Amount</th></tr>').appendTo('#items');
                                            $('</thead>').appendTo('#items');
                                            $('<tbody>').appendTo('#items');
                                            $.each(data.Result, function (i, d) {
                                                j++;
                                                $('#CountItems').val(number);
                                                CountItems
                                                var item_id = "item" + j;
                                                var vat_status = "vatstatus" + j;
                                                var vat = "vat" + j;
                                                var amount = "amount" + j;
                                                var price_id = "price" + j;
                                                total_quantity = total_quantity + parseFloat(d.Quantity);
                                                total_VAT = total_VAT + parseFloat(d.VAT);
                                                total_amount = total_amount + parseFloat(d.TotalAmount);
                                                $('<tr><td style="text-align:right">' + j + '</td><td style="text-align:left">' + d.ItemDesc + '</td><td style="text-align:left">' + d.UOM + '</td><td style="text-align:right">' + d.Quantity + '</td><td style="text-align:right">' + d.UnitPrice.toLocaleString('en') + '</td><td style="text-align:right">' + d.VAT.toLocaleString('en') + '</td><td style="text-align:right">' + d.TotalAmount.toLocaleString('en') + '</td><td style="text-align:center"> <input type="text" name="" class="quantity" id="' + j + '" value="" max="' + d.Quantity + '" min="0" required style="width:60px" /><input type="hidden" id="' + item_id + '" name="' + item_id + '" value="' + d.ContractDetailId + '"><input type="hidden" id="' + vat_status + '" name="' + vat_status + '" value="' + d.VatStatus + '"> <input type="hidden" id="' + price_id + '" name="' + price_id + '" value="' + d.UnitPrice + '"></td><td style="text-align:center"><input type="number" name="' + vat + '" id="' + vat + '" value="" readonly style="width:120px;text-align:right" /></td><td style="text-align:center"><input type="number" name="' + amount + '" id="' + amount + '" value="" readonly style="width:120px;text-align:right"/></td></tr>').appendTo('#items');
                                            });
                                            $('<tr><td colspan="3" style="text-align:right"><strong>Total</strong></td><td style="text-align:right"><strong>' + total_quantity + '</strong></td><td style="text-align:right"></td><td style="text-align:right"><strong>' + total_VAT.toLocaleString('en') + '</strong></td><td style="text-align:right"><strong>' + total_amount.toLocaleString('en') + '</strong></td> <td style="text-align:center"><input type="number"  name="total_quantity" id="total_quantity" value=""  style="width:60px" readonly/></td><td style="text-align:center"><input type="number" name="" id="total_vat" value="" readonly style="width:120px;text-align:right" /></td><td style="text-align:center"><input type="number" name="" id="total_amount" value="" readonly style="width:120px;text-align:right" /></td></tr>').appendTo('#items');
                                            $('</tbody>').appendTo('#items');
                                        }
                                    }
                                },
                                error: function (xhr) {
                                    //console.log(xhr.responseText);
                                    swal("An error has occured, contact system supporter");

                                },

                            });


                        } else {
                            $("#items").empty();
                            $(".save_button").hide();
                        }
                    }
                    else {
                        $("#items").empty();

                        if (schedule_id) {
                            $(".receiving_form").show();
                            $(".schedule_info").show();
                            $(".schedule_info2").hide();
                            $(".display_advance_payment").hide();
                            $('#advance_payments4').empty();
                            vouchersCharges = [];
                            var form_data = {
                                "id": schedule_id
                            }
                            var url = '@Url.Action("GetReceivingSchedule", "Contract")';
                            $.ajax(
                            {
                                type: "POST", //HTTP POST Method
                                url: url, // Controller/View
                                data: form_data,
                                success: function (data) {
                                    if (data == "DbException") {
                                        swal("Failed to fetch items ,DbException, contact system supporter");

                                    } else if (data == "Received") {
                                        swal("This payment schedule previously received By Quantity partially");

                                    } else {
                                        $("#items").empty();
                                        $(".save_button").show();                         
                                        //Payment Schedule Data
                                        var received = 0;
                                        var balance = data.schedule.Amount;
                                        var schedule_amount = balance;
                                        if (data.schedule.ReceivedAmount > 0) {
                                            received = data.schedule.ReceivedAmount;
                                            balance = balance - received;
                                            $("#certificate_amount").attr({
                                                "max": balance,
                                                "min": 0
                                            });
                                            $("#CertificateAmount").attr({
                                                "max": balance,
                                                "min": 0
                                            });
                                        }
                                     else {
                                        $("#CertificateAmount").attr({
                                            "max": balance,
                                            "min":0
                                        });
                                        }

                                        var percentage = Math.round(received / data.schedule.Amount * 100);
                                        $("#previous_amount").text(received.toLocaleString('en'));
                                        $("#percentage").text(percentage + "%");
                                        $("#payment_amount").text(data.schedule.Amount.toLocaleString('en'));
                                        $("#description").text(data.schedule.Description);
                                        $("#deliverable").text(data.schedule.Deliverable);
                                        $("#balance").text(balance.toLocaleString('en'));

                                        var number = data.Result.length;
                                        var total_quantity = 0;
                                        var total_VAT = 0;
                                        var total_amount = 0;
                                        var total_amount = 0;
                                        var j = 0;
                                        if (number > 0) {
                                            $('<thead>').appendTo('#items');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Schedule Items</th></tr>').appendTo('#items');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:18%">Item</th><th style="text-align:left;width:15%">Unit Of Measure</th><th style="text-align:right;width:8%">Quantity</th><th style="text-align:right;width:9%">Unit Price</th><th style="text-align:right;width:9%">VAT</th><th style="text-align:right;width:10%">Total Amount</th></tr>').appendTo('#items');
                                            $('</thead>').appendTo('#items');
                                            $('<tbody>').appendTo('#items');
                                            var items = data.Result;
                                            $.each(items, function (i, d) {
                                                j++;
                                                $('#CountItems').val(number);
                                                CountItems
                                                var item_id = "item" + j;
                                                var vat_status = "vatstatus" + j;
                                                var vat = "vat" + j;
                                                var amount = "amount" + j;
                                                var price_id = "price" + j;
                                                total_quantity = total_quantity + parseFloat(d.Quantity);
                                                total_VAT = total_VAT + parseFloat(d.VAT);
                                                total_amount = total_amount + parseFloat(d.TotalAmount);
                                                $('<tr><td style="text-align:right">' + j + '</td><td style="text-align:left">' + d.ItemDesc + '</td><td style="text-align:left">' + d.UOM + '</td><td style="text-align:right">' + d.Quantity + '</td><td style="text-align:right">' + d.UnitPrice.toLocaleString('en') + '</td><td style="text-align:right">' + d.VAT.toLocaleString('en') + '</td><td style="text-align:right">' + d.TotalAmount.toLocaleString('en') + '</td></tr>').appendTo('#items');
                                            });
                                            $('<tr><td colspan="3" style="text-align:right"><strong>Total</strong></td><td style="text-align:right"><strong>' + total_quantity + '</strong></td><td style="text-align:right"></td><td style="text-align:right"><strong>' + total_VAT.toLocaleString('en') + '</strong></td><td style="text-align:right"><strong>' + total_amount.toLocaleString('en') + '</strong></td></tr>').appendTo('#items');
                                            $('</tbody>').appendTo('#items');
                                        }
                                        $("#certificate_payment").empty();
                                        var certificate_number = data.contract_payments.length;
                                        var k = 0;
                                        if (certificate_number > 0) {
                                            $(".new_certificate").show();
                                            $(".certificate").hide();
                                            $(".save_button").hide();
                                        } else {
                                            $(".new_certificate").hide();
                                            $(".certificate").show();
                                        }
                                        if (certificate_number > 0) {
                                            $('<thead>').appendTo('#certificate_payment');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Through Certificate</th></tr>').appendTo('#certificate_payment');
                                            $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:21%">Certificate Number</th><th style="text-align:right;width:19%">Certificate Amount</th><th style="text-align:right;width:15%">Amount Paid</th><th style="text-align:right;width:15%">Amount Remaining</th><th style="text-align:center;width:17%">Payment</th><th style="text-align:center;width:12%">Edit</th></tr>').appendTo('#certificate_payment');
                                            $('</thead>').appendTo('#certificate_payment');
                                            $('<tbody>').appendTo('#certificate_payment');
                                            var certificate_amount = 0;
                                            var certificate_items = data.contract_payments;
                                            $.each(certificate_items, function (i, d) {
                                                k++;
                                                certificate_amount = certificate_amount + d.CertificateAmount;
                                                if (d.Balance) {
                                                    $('<tr><td style="text-align:right">' + k + '</td><td style="text-align:left">' + d.CertificateNumber + '</td><td style="text-align:right">' + d.CertificateAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.PaidAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.Balance.toLocaleString('en') + '</td><td style="text-align:center"> <a href="#" data-toggle="modal" data-target="#contract_payment" data-id="' + d.ContractPaymentId + '" data-certificate_no="' + d.CertificateNumber + '" data-certificate="' + d.CertificateAmount + '" data-paid="' + d.PaidAmount + '" data-balance="' + d.Balance + '" class="contract_payment  btn-xs edit"><i class="fa fa-edit"></i>New Payment</a> </td>< td style = "text-align:right" > ' + d.Balance.toLocaleString('en') + '</td > <td style="text-align:center"> <a href="#" data-toggle="modal" data-target="#edit_certificate" data-id="' + d.ContractPaymentId + '" data-certificate_no="' + d.CertificateNumber + '" data-certificate="' + d.CertificateAmount + '" data-paid="' + d.PaidAmount + '" data-balance="' + d.Balance + '" class="edit_certificate"><i class="glyphicon glyphicon-pencil"></i> </td></tr>').appendTo('#certificate_payment');

                                                } else {
                                                    $('<tr><td style="text-align:right">' + k + '</td><td style="text-align:left">' + d.CertificateNumber + '</td><td style="text-align:right">' + d.CertificateAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.PaidAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.Balance.toLocaleString('en') + '</td><td style="text-align:center"> Full Paid </td><td></td></tr>').appendTo('#certificate_payment');

                                                }
                                           });
                                            $('</tbody>').appendTo('#certificate_payment');
                                            if (schedule_amount == certificate_amount) {
                                                $(".new_certificate").hide();
                                            }
                                        }






                                    }
                                },
                                error: function (xhr) {
                                    //console.log(xhr.responseText);
                                    swal("An error has occured, contact system supporter");

                                },

                            });


                        } else {
                            $("#items").empty();
                            $(".save_button").hide();
                        }



                 }


                });

            });
            $("#CertificateAmount").keyup(function () {
                var certificate_amount = parseFloat($(this).val().split(",").join(""));
                var balance = parseFloat($(this).attr('max'));
                if (certificate_amount > balance) {
                    swal("Certificate amount can not exceed " + balance.toLocaleString('en'));
                    $(this).val("");
                }
            });
            $("#AvailableAmount").keyup(function () {
                var receiving_amount = parseFloat($(this).val().split(",").join(""));
                var certificate_amount = parseFloat($("#CertificateAmount").val().split(",").join(""));
                if (receiving_amount > certificate_amount) {
                    swal("Available Amount can not exceed Certificate Amount");
                    $(this).val("");
                }
            });
            $("#certificate_amount").keyup(function () {
                var certificate_amount = parseFloat($(this).val().split(",").join(""));
                var balance = parseFloat($(this).attr('max'));
                if (certificate_amount > balance) {
                    swal("Certificate amount can not exceed " + balance.toLocaleString('en'));
                    $(this).val("");
                }
            });
            $("#available_amount").keyup(function () {
                var receiving_amount = parseFloat($(this).val().split(",").join(""));
                var certificate_amount = parseFloat($("#certificate_amount").val().split(",").join(""));
                if (receiving_amount > certificate_amount) {
                    swal("Available Amount can not exceed Certificate Amount");
                    $(this).val("");
                }
            });
            $("#payment_form #new_amount").keyup(function () {
                var receiving_amount = parseFloat($(this).val().split(",").join(""));
                var balance = parseFloat($("#payment_form #balance_amt").val().split(",").join(""));
                if (receiving_amount > balance) {
                    swal("Amount can not exceed " + balance.toLocaleString('en'));
                    $(this).val("");
                }
            });
            $("#payment_form").on('submit', function (e) {
                e.preventDefault();
                var receiving_amount = parseFloat($("#payment_form #new_amount").val().split(",").join(""));
                var id=$("#payment_form #id").val();
                if (receiving_amount > 0) {
                    $("#btnSubmit").prop('disabled', true);
                    var schedule_id = $("#PaymentScheduleId").val();
                    var form_data = {
                        "PaymentScheduleId": schedule_id,
                        "ContractPaymentId": id,
                        "Amount": receiving_amount,
                        "AdvPaymentReceivingVMs": vouchersCharges
                    }
                    var url = '@Url.Action("ReceiveByAmount", "Contract")';
                    $.ajax(
                    {
                        type: "POST",
                        url: url, // Controller/View
                        data: form_data,
                        success: function (result) {
                            if (result.response == "Success") {
                                $('#contract_payment').modal('hide');
                                swal("Items received successfully", { icon: "success" })
                                               .then((value) => {
                                                   $("#divLoader").hide();
                                                   var url = '@Url.Action("PendingReceiving", "Contract")';
                                                   window.location.replace(url);
                                               });
                            }
                            else if (result.response == "Exceed") {
                                swal("Received Amount can not exceed amount in payment schedule");
                                $("#btnSubmit").prop('disabled', false);
                            }
                            else if (result.response == "AdvanceExceed") {
                                 swal("Received amount should be greater than Advance Payment!");
                                  $('#contract_payment #advance_payments').empty();
                                  $("#btnSubmit").prop('disabled', false);

                            }else {

              //Cancel Incomplete receiving
                            var id = result.id;
                            var url = '@Url.Action("CancelRecByAmount", "Contract")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {
                                       $("#btnSubmit").prop('disabled', true);
                                     swal("Failed to receive,contact technical supporter");

                                    }
                                    else {

                                        swal("Failed to confirm ,DbException");
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                },

                            });

   //End Cancel Incomplete receiving

                            }
                        },
                        error: function (xhr) {
                            //console.log(xhr.responseText);
                            swal("An error has occured, contact system support");
                            $("#btnSubmit").prop('disabled', false);
                        },

                    });


                }

            });
            $(function () {
                $("#ReceiveType").change(function (e) {
                    var schedule_id = $("#PaymentScheduleId").val();
                    if (schedule_id >1) {
                        var receiveType = $("#ReceiveType").val();
                        if (receiveType == "Quantity") {
                            if (schedule_id) {
                                $(".receiving_form").hide();
                                $(".schedule_info").hide();
                                $(".schedule_info2").show();
                                var contract_number = '@(ViewBag.ContractNo)';
                                var form_data = {
                                    "contractNo": contract_number,
                                    "id": schedule_id
                                }
                                var url = '@Url.Action("GetReceivingItems", "Contract")';
                                $.ajax(
                                {
                                    type: "POST", //HTTP POST Method
                                    url: url, // Controller/View
                                    data: form_data,
                                    success: function (data) {
                                        if (data == "DbException") {
                                            swal("Failed to fetch items ,DbException, contact system supporter");

                                        }
                                        else if (data == "Received") {
                                            swal("This payment schedule previously received By Amount partially");

                                        } else {
                                            $("#items").empty();
                                            $(".save_button").show();
                                            $(".display_advance_payment").show();
                                            $('#advance_payments4').empty();
                                            vouchersCharges = [];
                                            $("#payment_amount2").text(data.schedule.Amount.toLocaleString('en'));
                                            $("#description2").text(data.schedule.Description);
                                            $("#deliverable2").text(data.schedule.Deliverable);

                                            var number = data.Result.length;
                                            var total_quantity = 0;
                                            var total_VAT = 0;
                                            var total_amount = 0;
                                            var total_amount = 0;
                                            var j = 0;
                                            if (number > 0) {
                                                $('<thead>').appendTo('#items');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Schedule Items</th><th style="text-align:center" colspan="3">Receiving Items</th></tr>').appendTo('#items');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:18%">Item</th><th style="text-align:left;width:15%">Unit Of Measure</th><th style="text-align:right;width:8%">Quantity</th><th style="text-align:right;width:9%">Unit Price</th><th style="text-align:right;width:9%">VAT</th><th style="text-align:right;width:10%">Total Amount</th><th style="text-align:center;width:8%">Quantity</th><th style="text-align:center;width:9%">VAT</th><th style="text-align:center;width:10%">Total Amount</th></tr>').appendTo('#items');
                                                $('</thead>').appendTo('#items');
                                                $('<tbody>').appendTo('#items');
                                                $.each(data.Result, function (i, d) {
                                                    j++;
                                                    $('#CountItems').val(number);
                                                    CountItems
                                                    var item_id = "item" + j;
                                                    var vat_status = "vatstatus" + j;
                                                    var vat = "vat" + j;
                                                    var amount = "amount" + j;
                                                    var price_id = "price" + j;
                                                    total_quantity = total_quantity + parseFloat(d.Quantity);
                                                    total_VAT = total_VAT + parseFloat(d.VAT);
                                                    total_amount = total_amount + parseFloat(d.TotalAmount);
                                                    $('<tr><td style="text-align:right">' + j + '</td><td style="text-align:left">' + d.ItemDesc + '</td><td style="text-align:left">' + d.UOM + '</td><td style="text-align:right">' + d.Quantity + '</td><td style="text-align:right">' + d.UnitPrice.toLocaleString('en') + '</td><td style="text-align:right">' + d.VAT.toLocaleString('en') + '</td><td style="text-align:right">' + d.TotalAmount.toLocaleString('en') + '</td><td style="text-align:center"> <input type="text" name="" class="quantity" id="' + j + '" value="" max="' + d.Quantity + '" min="0" required style="width:60px" /><input type="hidden" id="' + item_id + '" name="' + item_id + '" value="' + d.ContractDetailId + '"><input type="hidden" id="' + vat_status + '" name="' + vat_status + '" value="' + d.VatStatus + '"> <input type="hidden" id="' + price_id + '" name="' + price_id + '" value="' + d.UnitPrice + '"></td><td style="text-align:center"><input type="number" name="' + vat + '" id="' + vat + '" value="" readonly style="width:120px;text-align:right" /></td><td style="text-align:center"><input type="number" name="' + amount + '" id="' + amount + '" value="" readonly style="width:120px;text-align:right"/></td></tr>').appendTo('#items');
                                                });
                                                $('<tr><td colspan="3" style="text-align:right"><strong>Total</strong></td><td style="text-align:right"><strong>' + total_quantity + '</strong></td><td style="text-align:right"></td><td style="text-align:right"><strong>' + total_VAT.toLocaleString('en') + '</strong></td><td style="text-align:right"><strong>' + total_amount.toLocaleString('en') + '</strong></td> <td style="text-align:center"><input type="number"  name="total_quantity" id="total_quantity" value=""  style="width:60px" readonly/></td><td style="text-align:center"><input type="number" name="" id="total_vat" value="" readonly style="width:120px;text-align:right" /></td><td style="text-align:center"><input type="number" name="" id="total_amount" value="" readonly style="width:120px;text-align:right" /></td></tr>').appendTo('#items');
                                                $('</tbody>').appendTo('#items');
                                            }
                                        }
                                    },
                                    error: function (xhr) {
                                        //console.log(xhr.responseText);
                                        swal("An error has occured, contact system supporter");

                                    },

                                });


                            } else {
                                $("#items").empty();
                                $(".save_button").hide();
                            }
                        }
                        else {
                            $("#items").empty();

                            if (schedule_id) {
                                $(".receiving_form").show();
                                $(".schedule_info").show();
                                $(".schedule_info2").hide();
                                $(".display_advance_payment").hide();
                                $('#advance_payments4').empty();
                                        vouchersCharges = [];
                                var form_data = {
                                    "id": schedule_id
                                }
                                var url = '@Url.Action("GetReceivingSchedule", "Contract")';
                                $.ajax(
                                {
                                    type: "POST", //HTTP POST Method
                                    url: url, // Controller/View
                                    data: form_data,
                                    success: function (data) {
                                        if (data == "DbException") {
                                            swal("Failed to fetch items ,DbException, contact system supporter");

                                        } else if (data == "Received") {
                                            swal("This payment schedule previously received By Quantity partially");

                                        } else {
                                            $("#items").empty();
                                            $(".save_button").show();
                                            //Payment Schedule Data
                                            var received = 0;
                                            var balance = data.schedule.Amount;
                                            var schedule_amount = balance;
                                            if (data.schedule.ReceivedAmount > 0) {
                                                received = data.schedule.ReceivedAmount;
                                                balance = balance - received;
                                                $("#certificate_amount").attr({
                                                    "max": balance,
                                                    "min": 0
                                                });
                                                $("#CertificateAmount").attr({
                                                    "max": balance,
                                                    "min": 0
                                                });

                                            }
                                            else {
                                                $("#CertificateAmount").attr({
                                                    "max": balance,
                                                    "min": 0
                                                });
                                            }

                                            var percentage = Math.round(received / data.schedule.Amount * 100);
                                            $("#previous_amount").text(received.toLocaleString('en'));
                                            $("#percentage").text(percentage + "%");
                                            $("#payment_amount").text(data.schedule.Amount.toLocaleString('en'));
                                            $("#description").text(data.schedule.Description);
                                            $("#deliverable").text(data.schedule.Deliverable);
                                            $("#balance").text(balance.toLocaleString('en'));

                                            var number = data.Result.length;
                                            var total_quantity = 0;
                                            var total_VAT = 0;
                                            var total_amount = 0;
                                            var total_amount = 0;
                                            var j = 0;
                                            if (number > 0) {
                                                $('<thead>').appendTo('#items');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Schedule Items</th></tr>').appendTo('#items');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:18%">Item</th><th style="text-align:left;width:15%">Unit Of Measure</th><th style="text-align:right;width:8%">Quantity</th><th style="text-align:right;width:9%">Unit Price</th><th style="text-align:right;width:9%">VAT</th><th style="text-align:right;width:10%">Total Amount</th></tr>').appendTo('#items');
                                                $('</thead>').appendTo('#items');
                                                $('<tbody>').appendTo('#items');
                                                var items = data.Result;
                                                $.each(items, function (i, d) {
                                                    j++;
                                                    $('#CountItems').val(number);
                                                    CountItems
                                                    var item_id = "item" + j;
                                                    var vat_status = "vatstatus" + j;
                                                    var vat = "vat" + j;
                                                    var amount = "amount" + j;
                                                    var price_id = "price" + j;
                                                    total_quantity = total_quantity + parseFloat(d.Quantity);
                                                    total_VAT = total_VAT + parseFloat(d.VAT);
                                                    total_amount = total_amount + parseFloat(d.TotalAmount);
                                                    $('<tr><td style="text-align:right">' + j + '</td><td style="text-align:left">' + d.ItemDesc + '</td><td style="text-align:left">' + d.UOM + '</td><td style="text-align:right">' + d.Quantity + '</td><td style="text-align:right">' + d.UnitPrice.toLocaleString('en') + '</td><td style="text-align:right">' + d.VAT.toLocaleString('en') + '</td><td style="text-align:right">' + d.TotalAmount.toLocaleString('en') + '</td></tr>').appendTo('#items');
                                                });
                                                $('<tr><td colspan="3" style="text-align:right"><strong>Total</strong></td><td style="text-align:right"><strong>' + total_quantity + '</strong></td><td style="text-align:right"></td><td style="text-align:right"><strong>' + total_VAT.toLocaleString('en') + '</strong></td><td style="text-align:right"><strong>' + total_amount.toLocaleString('en') + '</strong></td></tr>').appendTo('#items');
                                                $('</tbody>').appendTo('#items');
                                            }

                                            $("#certificate_payment").empty();
                                            var certificate_number = data.contract_payments.length;
                                            var k = 0;
                                            if (certificate_number > 0) {
                                                $(".new_certificate").show();
                                                $(".certificate").hide();
                                                $(".save_button").hide();
                                            } else {
                                                $(".new_certificate").hide();
                                                $(".certificate").show();
                                            }
                                            if (certificate_number > 0) {
                                                $('<thead>').appendTo('#certificate_payment');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%"></th><th style="text-align:center" colspan="6">Payment Through Certificate</th></tr>').appendTo('#certificate_payment');
                                                $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align:right;width:4%">#</th><th style="text-align:left;width:16%">Certificate Number</th><th style="text-align:right;width:19%">Certificate Amount</th><th style="text-align:right;width:15%">Amount Paid</th><th style="text-align:right;width:15%">Amount Remaining</th><th style="text-align:center;width:17%">Payment</th><th style="text-align:center;width:12%">Edit</th></tr>').appendTo('#certificate_payment');
                                                $('</thead>').appendTo('#certificate_payment');
                                                $('<tbody>').appendTo('#certificate_payment');
                                                var certificate_amount = 0;
                                                var certificate_items = data.contract_payments;
                                                $.each(certificate_items, function (i, d) {
                                                    k++;
                                                    certificate_amount = certificate_amount + d.CertificateAmount;
                                                   if (d.Balance) {
                                                        $('<tr><td style="text-align:right">' + k + '</td><td style="text-align:left">' + d.CertificateNumber + '</td><td style="text-align:right">' + d.CertificateAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.PaidAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.Balance.toLocaleString('en') + '</td><td style="text-align:center"> <a href="#" data-toggle="modal" data-target="#contract_payment" data-id="' + d.ContractPaymentId + '" data-certificate_no="' + d.CertificateNumber + '" data-certificate="' + d.CertificateAmount + '" data-paid="' + d.PaidAmount + '" data-balance="' + d.Balance + '" class="contract_payment btn-xs edit"><i class="fa fa-edit"></i>New Payment</a> </td>  <td style = "text-align:center"> <a href="#" data-toggle="modal" data-target="#edit_certificate" data-id="' + d.ContractPaymentId + '" data-certificate_no="' + d.CertificateNumber + '" data-certificate="' + d.CertificateAmount + '" data-paid="' + d.PaidAmount + '" data-balance="' + d.Balance + '" class="edit_certificate"><i class="glyphicon glyphicon-pencil"></i> </td></tr ></tr>').appendTo('#certificate_payment');

                                                    } else {
                                                        $('<tr><td style="text-align:right">' + k + '</td><td style="text-align:left">' + d.CertificateNumber + '</td><td style="text-align:right">' + d.CertificateAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.PaidAmount.toLocaleString('en') + '</td><td style="text-align:right">' + d.Balance.toLocaleString('en') + '</td><td style="text-align:center"> Full Paid </td><td></td></tr>').appendTo('#certificate_payment');

                                                    }
                                                });
                                                $('</tbody>').appendTo('#certificate_payment');
                                                if (schedule_amount == certificate_amount) {
                                                    $(".new_certificate").hide();
                                                }
                                            }
                                        }
                                    },
                                    error: function (xhr) {
                                        //console.log(xhr.responseText);
                                        swal("An error has occured, contact system supporter");

                                    },

                                });


                            } else {
                                $("#items").empty();
                                $(".save_button").hide();
                            }
                        }


                }
                });

            });

            var items_number = $("#CountItems").val();

            $(".quantity").keyup(function () {

                    var max_quantity = 0;
                    var entered_quantity = 0;
                    max_quantity = parseFloat($(this).attr('max'));
                    var id = $(this).attr('id');
                    var item_id = "#item" + id;
                    var vat_status_id = "#vatstatus" + id;
                    var amount_id = "#amount" + id;
                    var vat_id = "#vat" + id;
                    var price_id = "#price" + id;
                    var mamb = $(item_id).val()
                    var vat_status = $(vat_status_id).val();
                    var price = parseFloat($(price_id).val());
                    entered_quantity = parseFloat($(this).val());
                    var total = entered_quantity * price;
                    var vat_amount = 0;

                    if (entered_quantity <0) {
                        swal("Received quantity can not be negative !");
                        $(this).val("");
                        $(vat_id).val("");
                        $(amount_id).val("");
                    }
                    else if (entered_quantity > max_quantity) {
                        swal("Received quantity can not exceed ordered quantity " + max_quantity + " !");
                        $(this).val("");
                        $(vat_id).val("");
                        $(amount_id).val("");
                    } else {
                        if (vat_status == "Applicable") {
                            vat_amount = total * 0.18;
                            $(vat_id).val(vat_amount);
                            var total_amount = total + vat_amount;
                            $(amount_id).val(total_amount);
                        } else if (vat_status == "Excempted") {
                            $(vat_id).val(vat_amount);
                            $(amount_id).val(total);
                        }
                    }
                    var i = 1;
                    var sum_quantity = 0;
                    var sum_vat = 0;
                    var sum_total = 0;
                    while (i <= items_number) {
                        var col8_id = "#" + i;
                        var col9_id = "#vat" + i;
                        var col10_id = "#amount" + i;
                        var quantity = parseFloat($(col8_id).val());
                        var vat = parseFloat($(col9_id).val());
                        var amount = parseFloat($(col10_id).val());
                        if (quantity > 0) {
                            sum_quantity = sum_quantity + quantity;
                            sum_vat = sum_vat + vat;
                            sum_total = sum_total + amount;

                        }
                        i++;
                    }
                    $("#total_quantity").val(sum_quantity);
                    $("#total_vat").val(sum_vat);
                    $("#total_amount").val(sum_total);
                });

                $("#ReceivingItems2").on('submit', function (e) {
                    e.preventDefault();
                    var i = 1;
                    var count = 0;
                    var receivingDetails = [];
                    while (i <= items_number) {
                        var col8_id = "#" + i;
                        var col10_id = "#amount" + i;
                        var item_id = "#item" + i;
                        var quantity = parseFloat($(col8_id).val());
                        if (quantity > 0) {
                            var amount = parseFloat($(col10_id).val());
                            var itemid = parseFloat($(item_id).val());
                            receivingDetails.push({
                                "PurchaseOrderDetailId":itemid,
                                "Quantity": quantity,
                                "Amount": amount
                            });
                            count++;
                        }
                        i++;
                    }
                    var lpo_id = $("#PurchaseOrderId").val();

                    var form_data = {
                        "PurchaseOrderId": lpo_id,
                        "ItemsReceived": receivingDetails,
                        "AdvPaymentReceivingVMs":vouchersCharges
                    }
                    var url = '@Url.Action("ReceiveItems", "Contract")';
                    $.ajax(
                    {
                        type: "POST", //HTTP POST Method
                        url: url, // Controller/View
                        data: form_data,
                        success: function (result) {
                            if (result.response == "Success") {

                                swal("Items received successfully", { icon: "success" })
                                               .then((value) => {
                                                   var url = '@Url.Action("ReceivingList", "Contract")';
                                                   window.location.replace(url);
                                               });
                            }
                            else if (result.response == "AdvanceExceed") {
                                 swal("Received amount should be greater than Advance Payment!");
                                  $('#advance_payments4').empty();
                                  $(".save_button").prop('disabled', false);
                            }
                            else {



                              var id = result.id;
                              var url = '@Url.Action("CancelInReceiving", "Contract")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {

                                     swal("Failed to receive,contact technical supporter");

                                    }
                                    else {

                                        swal("DbException,contact technical supporter");
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                },

                            });





                            }
                        },
                        error: function (xhr) {
                            //console.log(xhr.responseText);
                            swal("An error has occured, contact system support");

                        },

                    });


                });

        });
        $(document).on('keyup', '.quantity', function () {
            var items_number = $("#CountItems").val();
            var id = $(this).attr('id');
            var max_quantity = 0;
            var entered_quantity = 0;
            max_quantity = parseFloat($(this).attr('max'));

            var id = $(this).attr('id');
            var item_id = "#item" + id;
            var vat_status_id = "#vatstatus" + id;
            var amount_id = "#amount" + id;
            var vat_id = "#vat" + id;
            var price_id = "#price" + id;
            var mamb = $(item_id).val()
            var vat_status = $(vat_status_id).val();
            var price = parseFloat($(price_id).val());

            entered_quantity = parseFloat($(this).val());

            var total = entered_quantity * price;
            var vat_amount = 0;

            if (entered_quantity < 0) {
                swal("Received quantity can not be negative !");
                $(this).val("");
                $(vat_id).val("");
                $(amount_id).val("");
            }
            else if (entered_quantity > max_quantity) {
                swal("Received quantity can not exceed ordered quantity " + max_quantity + " !");
                $(this).val("");
                $(vat_id).val("");
                $(amount_id).val("");
            } else {
                if (vat_status == "Applicable") {
                    vat_amount = total * 0.18;
                    var total_amount = total + vat_amount;
                    var vatAmount = vat_amount.toFixed(2);
                    $(vat_id).val(vatAmount);
                    var totalAmount = total_amount.toFixed(2);
                    $(amount_id).val(totalAmount);
                } else if (vat_status == "Excempted") {
                    $(vat_id).val(vat_amount);
                    var totalAmount = total.toFixed(2);
                    $(amount_id).val(totalAmount);
                }
            }
            var i = 1;
            var sum_quantity = 0;
            var sum_vat = 0;
            var sum_total = 0;
            while (i <= items_number) {
                var col8_id = "#" + i;
                var col9_id = "#vat" + i;
                var col10_id = "#amount" + i;
                var quantity = parseFloat($(col8_id).val());
                var vat = parseFloat($(col9_id).val());
                var amount = parseFloat($(col10_id).val());
                if (quantity > 0) {
                    sum_quantity = sum_quantity + quantity;
                    sum_vat = sum_vat + vat;
                    sum_total = sum_total + amount;

                }
                i++;
            }
            $("#total_quantity").val(sum_quantity);
            $("#total_vat").val(sum_vat);
            $("#total_amount").val(sum_total);

        });

        $(document).on('click', '.save_button', function () {
            var receiveType = $("#ReceiveType").val();
            if (receiveType == "Quantity") {
                var i = 1;
                var count = 0;
                var items_number = $("#CountItems").val();
                var receivingDetails = [];
                while (i <= items_number) {
                    var col8_id = "#" + i;
                    var col10_id = "#amount" + i;
                    var item_id = "#item" + i;
                    var quantity = parseFloat($(col8_id).val());
                    if (quantity > 0) {
                        var amount = parseFloat($(col10_id).val());
                        var itemid = parseInt($(item_id).val());
                        receivingDetails.push({
                            "ContractDetailId": itemid,
                            "Quantity": quantity,
                            "Amount": amount
                        });
                        count++;
                    }
                    i++;
                }
                var contract_id = $("#ContractId").val();
                var schedule_id = $("#PaymentScheduleId").val();
                var form_data = {
                    "ContractId": contract_id,
                    "PaymentScheduleId": schedule_id,
                    "ItemsReceived": receivingDetails,
                    "AdvPaymentReceivingVMs":vouchersCharges
                }
                if (count > 0) {
                    $(".save_button").prop('disabled', true);
                    var url = '@Url.Action("ReceiveItems", "Contract")';
                    $.ajax(
                    {
                        type: "POST", //HTTP POST Method
                        url: url, // Controller/View
                        data: form_data,
                        success: function (result) {
                            if (result.response == "Success") {

                                swal("Items received successfully", { icon: "success" })
                                               .then((value) => {
                                                   var url = '@Url.Action("PendingReceiving", "Contract")';
                                                   window.location.replace(url);
                                               });
                            }
                            else if (result.response == "AdvanceExceed") {
                                 swal("Received amount should be greater than Advance Payment!");
                                  $('#advance_payments4').empty();
                                  $(".save_button").prop('disabled', false);
                            }
                            else {
                      $(".save_button").prop('disabled', true);
                         var id = result.id;
                         var url = '@Url.Action("CancelInReceiving", "Contract")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {

                                     swal("Failed to receive,contact technical supporter");

                                    }
                                    else {

                                        swal("DbException,contact technical supporter");
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                },

                            });





                            }
                        },
                        error: function (xhr) {
                            //console.log(xhr.responseText);
                            swal("An error has occured, contact system support");
                        },

                    });
                } else {
                    swal("Please enter items")
                }
            } else {
                var receiving_amount = parseFloat($("#AvailableAmount").val().split(",").join(""));
                var certificate_amount = parseFloat($("#CertificateAmount").val().split(",").join(""));
                var certificate_number = $("#CertificateNumber").val();
                if (!certificate_number) {
                    swal("Enter Certificate Number");
                    return false;
                }
                if (!certificate_amount) {
                    swal("Enter Certificate Amount");
                    return false;
                }
                if (!receiving_amount) {
                    swal("Enter Available Amount");
                    return false;
                }
                if (receiving_amount > 0) {
                    $(".save_button").prop('disabled', true);
                    var schedule_id = $("#PaymentScheduleId").val();
                    var form_data = {
                        "PaymentScheduleId": schedule_id,
                        "CertificateNumber": certificate_number,
                        "CertificateAmount":certificate_amount,
                        "Amount": receiving_amount,
                        "AdvPaymentReceivingVMs":vouchersCharges
                    }
                    var url = '@Url.Action("ReceiveByAmount", "Contract")';
                    $.ajax(
                    {
                        type: "POST",
                        url: url, // Controller/View
                        data: form_data,
                        success: function (result) {
                            if (result.response == "Success") {

                                swal("Items received successfully", { icon: "success" })
                                               .then((value) => {
                                                   var url = '@Url.Action("PendingReceiving", "Contract")';
                                                   window.location.replace(url);
                                               });
                            }
                            else if (result.response == "Exceed") {
                                swal("Received Amount can not exceed amount in payment schedule");
                                $(".save_button").prop('disabled', false);
                            }
                            else if (result.response == "AdvanceExceed") {
                                 swal("Received amount should be greater than Advance Payment!");
                                  $('#advance_payments').empty();
                                  $(".save_button").prop('disabled', false);
                            }else {

                                //Cancel Incomplete receiving
                          var id = result.id;
                          var url = '@Url.Action("CancelRecByAmount", "Contract")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {
                                           $(".save_button").prop('disabled', true);
                                     swal("Failed to receive,contact technical supporter");

                                    }
                                    else {

                                        swal("Failed to confirm ,DbException");
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                },

                            });

                             //End Cancel Incomplete receiving

                                $(".save_button").prop('disabled', false);
                            }
                        },
                        error: function (xhr) {
                            //console.log(xhr.responseText);
                            swal("An error has occured, contact system support");
                            $(".save_button").prop('disabled', false);
                        },

                    });


                    }
            }

        });

        $(document).on('click', '.save_payment', function () {
            var receiving_amount = parseFloat($("#available_amount").val().split(",").join(""));
            var certificate_amount = parseFloat($("#certificate_amount").val().split(",").join(""));
            var certificate_number = $("#certificate_number").val();
            if (!certificate_number) {
                swal("Enter Certificate Number");
                return false;
            }
                if (!certificate_amount) {
                    swal("Enter Certificate Amount");
                    return false;
                }
                if (!receiving_amount) {
                    swal("Enter Available Amount");
                    return false;
                }
            if (receiving_amount > 0) {
                    $(".save_payment").prop('disabled', true);
                    var schedule_id = $("#PaymentScheduleId").val();
                    var form_data = {
                        "PaymentScheduleId": schedule_id,
                        "CertificateNumber": certificate_number,
                        "CertificateAmount": certificate_amount,
                        "Amount": receiving_amount,
                        "AdvPaymentReceivingVMs":vouchersCharges
                    }
                    var url = '@Url.Action("ReceiveByAmount", "Contract")';
                    $.ajax(
                    {
                        type: "POST",
                        url: url, // Controller/View
                        data: form_data,
                        success: function (result) {
                            if (result.response == "Success") {

                                swal("Items received successfully", { icon: "success" })
                                               .then((value) => {
                                                   var url = '@Url.Action("PendingReceiving", "Contract")';
                                                   window.location.replace(url);
                                               });
                            }
                            else if (result.response == "Exceed") {
                                      swal("Received Amount can not exceed amount in payment schedule");
                                     $("#btnSubmit").prop('disabled', false);

                            }
                            else if (result.response == "AdvanceExceed") {
                                   swal("Received amount should be greater than Advance Payment!");
                                   $('#advance_payments2').empty();
                                   $(".save_payment").prop('disabled', false);

                            }
                            else {

                  //Cancel Incomplete receiving
                              var id = result.id;
                              var url = '@Url.Action("CancelRecByAmount", "Contract")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {
                                         $(".save_payment").prop('disabled', true);
                                     swal("Failed to receive,contact technical supporter");

                                    }
                                    else {

                                        swal("Failed to confirm ,DbException");
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                },

                            });

                //End Cancel Incomplete receiving

                            }
                        },
                        error: function (xhr) {
                            //console.log(xhr.responseText);
                            swal("An error has occured, contact system support");
                            $(".save_payment").prop('disabled', false);
                        },

                    });


                }


        });
        $(document).on('click', '.contract_payment', function () {
            var id = $(this).data('id');
            $("#payment_form #id").val(id);
            var certificate_no = $(this).data('certificate_no');
            $("#payment_form #certificate_no").val(certificate_no);
            var certificate = $(this).data('certificate');
            $("#payment_form #certificate_amt").val(certificate);
            var paid = $(this).data('paid');
            $("#payment_form #previous_amt").val(paid);
            var balance = $(this).data('balance');
            $("#payment_form #balance_amt").val(balance);
            $("#payment_form #new_amount").val("");
        });

        $(document).on('click', '.edit_certificate', function () {
            var id = $(this).data('id');
            $("#certificate_form #ContractPaymentId").val(id);
            var certificate_no = $(this).data('certificate_no');
            $("#certificate_form #CertificateNumber").val(certificate_no);
            var certificate = $(this).data('certificate');
            $("#certificate_form #CertificateAmount").val(certificate);

        });
            //$("#items .quantity").keyup(function () {
            //    alert("OOoh My Lord");
            //});
            //$(document).ready(function () {
            //    $(".quantity").keyup(function () {
            //        alert("OOoh My Lord");
            //    });
            //});
        //SHOW LOADER ICON

        function amountChanged(e) {
               var max_value = parseFloat(e.max);
            var entered_value = parseFloat(e.value.split(",").join(""));
              if (!entered_value) {
                entered_value = 0;
            }
            if (entered_value >= 0) {
                if (entered_value <= max_value) {
                    var i = 0;
                    $("#dt_search_voucher tr").each(function () {

                                 if (i > 0) {
                            var value = $(this).children().eq(5).find("input").val().trim().split(",").join("");

                            if (value !="") {

                                var expense_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                var amount = parseFloat(value);

                                //INSERT INTO ARRAY
                                var voucher = "";
                                voucher = $(this).children().eq(1).text();
                                var description = $(this).children().eq(2).text();
                                var voucher_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                if (vouchersCharges.length > 0) {

                                    //CHECK IF EXIST IN THE ARRAY
                                    var found = false;
                                    for (var j = 0; j < vouchersCharges.length; j++) {
                                        if (vouchersCharges[j].Vourcher == voucher) {
                                            vouchersCharges[j].ExpenseAmount = amount;
                                            found = true;
                                        }

                                    }

                                    if (!found) {

                                        vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                    }


                                } else {

                                      vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                }




                            }
                        }


                        i++;



                             });
                }else {
                    swal("Amount can not exceed balance i.e " + max_value.toLocaleString('en'));
                    e.value = "";


                }
            }

        }



        function amountChanged2(e) {
               var max_value = parseFloat(e.max);
            var entered_value = parseFloat(e.value.split(",").join(""));
              if (!entered_value) {
                entered_value = 0;
            }
            if (entered_value >= 0) {
                if (entered_value <= max_value) {
                    var i = 0;
                    $("#dt_search_voucher2 tr").each(function () {

                                 if (i > 0) {
                            var value = $(this).children().eq(5).find("input").val().trim().split(",").join("");

                            if (value !="") {

                                var expense_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                var amount = parseFloat(value);

                                //INSERT INTO ARRAY
                                var voucher = "";
                                voucher = $(this).children().eq(1).text();
                                var description = $(this).children().eq(2).text();
                                var voucher_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                if (vouchersCharges.length > 0) {

                                    //CHECK IF EXIST IN THE ARRAY
                                    var found = false;
                                    for (var j = 0; j < vouchersCharges.length; j++) {
                                        if (vouchersCharges[j].Vourcher == voucher) {
                                            vouchersCharges[j].ExpenseAmount = amount;
                                            found = true;
                                        }

                                    }

                                    if (!found) {

                                        vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                    }


                                } else {

                                      vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                }




                            }
                        }


                        i++;



                             });
                }else {
                    swal("Amount can not exceed balance i.e " + max_value.toLocaleString('en'));
                    e.value = "";


                }
            }

        }

             function amountChanged3(e) {
               var max_value = parseFloat(e.max);
            var entered_value = parseFloat(e.value.split(",").join(""));
              if (!entered_value) {
                entered_value = 0;
            }
            if (entered_value >= 0) {
                if (entered_value <= max_value) {
                    var i = 0;
                    $("#dt_search_voucher3 tr").each(function () {

                                 if (i > 0) {
                            var value = $(this).children().eq(5).find("input").val().trim().split(",").join("");

                            if (value !="") {

                                var expense_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                var amount = parseFloat(value);

                                //INSERT INTO ARRAY
                                var voucher = "";
                                voucher = $(this).children().eq(1).text();
                                var description = $(this).children().eq(2).text();
                                var voucher_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                if (vouchersCharges.length > 0) {

                                    //CHECK IF EXIST IN THE ARRAY
                                    var found = false;
                                    for (var j = 0; j < vouchersCharges.length; j++) {
                                        if (vouchersCharges[j].Vourcher == voucher) {
                                            vouchersCharges[j].ExpenseAmount = amount;
                                            found = true;
                                        }

                                    }

                                    if (!found) {

                                        vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                    }


                                } else {

                                      vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                }




                            }
                        }


                        i++;



                             });
                }else {
                    swal("Amount can not exceed balance i.e " + max_value.toLocaleString('en'));
                    e.value = "";


                }
            }

        }
          function amountChanged4(e) {
               var max_value = parseFloat(e.max);
            var entered_value = parseFloat(e.value.split(",").join(""));
              if (!entered_value) {
                entered_value = 0;
            }
            if (entered_value >= 0) {
                if (entered_value <= max_value) {
                    var i = 0;
                    $("#dt_search_voucher4 tr").each(function () {

                                 if (i > 0) {
                            var value = $(this).children().eq(5).find("input").val().trim().split(",").join("");

                            if (value !="") {

                                var expense_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                var amount = parseFloat(value);

                                //INSERT INTO ARRAY
                                var voucher = "";
                                voucher = $(this).children().eq(1).text();
                                var description = $(this).children().eq(2).text();
                                var voucher_amount = parseFloat($(this).children().eq(3).text().split(",").join(""));

                                if (vouchersCharges.length > 0) {

                                    //CHECK IF EXIST IN THE ARRAY
                                    var found = false;
                                    for (var j = 0; j < vouchersCharges.length; j++) {
                                        if (vouchersCharges[j].Vourcher == voucher) {
                                            vouchersCharges[j].ExpenseAmount = amount;
                                            found = true;
                                        }

                                    }

                                    if (!found) {

                                        vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                    }


                                } else {

                                      vouchersCharges.push({
                                            "Vourcher": voucher,
                                            "Description": description,
                                            "VoucherAmount": voucher_amount,
                                            "ExpenseAmount": amount
                                        });


                                }




                            }
                        }


                        i++;



                             });
                }else {
                    swal("Amount can not exceed balance i.e " + max_value.toLocaleString('en'));
                    e.value = "";


                }
            }

        }

             //SAVE Voucher
        $("#search_vouchers #btn_save_voucher").click(function () {
            if (vouchersCharges.length == 0) {
                swal("Please Enter Amount to Voucher !!!");
            } else {
                   $('#search_vouchers').modal('hide');
                      $('#advance_payments').empty();
                       $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align: center;width:5%">No</th><th>Voucher Number</th><th>Description</th><th>Voucher Amount</th><th style="text-align:right;width:12%">Amount</th></tr>').appendTo('#advance_payments');
                var j = 0;
                var sum = 0;
                         $.each(vouchersCharges, function (i, d) {
                            j++;
                             sum = sum + parseFloat(d.ExpenseAmount);
                          $('<tr><td align="center">' + j + '</td><td>' + d.Vourcher + '<td>' + d.Description + '</td><td>' + d.VoucherAmount.toLocaleString('en') + '</td><td align="right">' + d.ExpenseAmount.toLocaleString('en') + '</td></tr>').appendTo('#advance_payments');

                         });
                     $('<tr><td colspan="4" align="right"><strong>Total Advance Payment</strong></td><td align="right"><strong>' + sum.toLocaleString('en') + '/=</strong></td></tr>').appendTo('#advance_payments');

            }
        });

                 //SAVE Voucher
        $("#search_vouchers2 #btn_save_voucher").click(function () {
            if (vouchersCharges.length == 0) {
                swal("Please Enter Amount to Voucher !!!");
            } else {
                   $('#search_vouchers2').modal('hide');
                      $('#advance_payments2').empty();
                       $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align: center;width:5%">No</th><th>Voucher Number</th><th>Description</th><th>Voucher Amount</th><th style="text-align:right;width:12%">Amount</th></tr>').appendTo('#advance_payments2');
                var j = 0;
                var sum = 0;
                         $.each(vouchersCharges, function (i, d) {
                            j++;
                             sum = sum + parseFloat(d.ExpenseAmount);
                          $('<tr><td align="center">' + j + '</td><td>' + d.Vourcher + '<td>' + d.Description + '</td><td>' + d.VoucherAmount.toLocaleString('en') + '</td><td align="right">' + d.ExpenseAmount.toLocaleString('en') + '</td></tr>').appendTo('#advance_payments2');

                         });
                     $('<tr><td colspan="4" align="right"><strong>Total Advance Payment</strong></td><td align="right"><strong>' + sum.toLocaleString('en') + '/=</strong></td></tr>').appendTo('#advance_payments2');

            }
        });

                         //SAVE Voucher
        $("#search_vouchers3 #btn_save_voucher").click(function () {
            if (vouchersCharges.length == 0) {
                swal("Please Enter Amount to Voucher !!!");
            } else {
                   $('#search_vouchers3').modal('hide');
                      $('#contract_payment #advance_payments').empty();
                       $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align: center;width:5%">No</th><th>Voucher Number</th><th>Description</th><th>Voucher Amount</th><th style="text-align:right;width:12%">Amount</th></tr>').appendTo('#contract_payment #advance_payments');
                var j = 0;
                var sum = 0;
                         $.each(vouchersCharges, function (i, d) {
                            j++;
                             sum = sum + parseFloat(d.ExpenseAmount);
                          $('<tr><td align="center">' + j + '</td><td>' + d.Vourcher + '<td>' + d.Description + '</td><td>' + d.VoucherAmount.toLocaleString('en') + '</td><td align="right">' + d.ExpenseAmount.toLocaleString('en') + '</td></tr>').appendTo('#contract_payment #advance_payments');

                         });
                     $('<tr><td colspan="4" align="right"><strong>Total Advance Payment</strong></td><td align="right"><strong>' + sum.toLocaleString('en') + '/=</strong></td></tr>').appendTo('#contract_payment #advance_payments');

            }
        });

                                 //SAVE Voucher
        $("#search_vouchers4 #btn_save_voucher").click(function () {
            if (vouchersCharges.length == 0) {
                swal("Please Enter Amount to Voucher !!!");
            } else {
                   $('#search_vouchers4').modal('hide');
                      $('#advance_payments4').empty();
                       $('<tr style="background:#f5f5f5; color:#000000"><th style="text-align: center;width:5%">No</th><th>Voucher Number</th><th>Description</th><th>Voucher Amount</th><th style="text-align:right;width:12%">Amount</th></tr>').appendTo('#advance_payments4');
                var j = 0;
                var sum = 0;
                         $.each(vouchersCharges, function (i, d) {
                            j++;
                             sum = sum + parseFloat(d.ExpenseAmount);
                          $('<tr><td align="center">' + j + '</td><td>' + d.Vourcher + '<td>' + d.Description + '</td><td>' + d.VoucherAmount.toLocaleString('en') + '</td><td align="right">' + d.ExpenseAmount.toLocaleString('en') + '</td></tr>').appendTo('#advance_payments4');

                         });
                     $('<tr><td colspan="4" align="right"><strong>Total Advance Payment</strong></td><td align="right"><strong>' + sum.toLocaleString('en') + '/=</strong></td></tr>').appendTo('#advance_payments4');

            }
                     });

        $(document).ajaxStart(function () {
            $(".loadingImg").show();

        });
        //HIDE LOADER ICON
        $(document).ajaxStop(function () {
            $(".loadingImg").hide();
        });
        $("#CertificateAmount").autoNumeric('init');
        $("#AvailableAmount").autoNumeric('init');
        $("#certificate_amount").autoNumeric('init');
        $("#available_amount").autoNumeric('init');
        $("#payment_form #new_amount").autoNumeric('init');
        $("#certificate_form #CertificateAmount").autoNumeric('init');
    </script>
}


