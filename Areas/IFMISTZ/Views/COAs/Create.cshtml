@model IFMIS.Areas.IFMISTZ.Models.COA

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .input[type="text"], select {
        border: 1px solid lightgray;
        width: 100%;
        height: 35px;
    }
      .input {
        border: 1px solid lightgray;
        width: 100%;
        height: 35px;
    }
    .textarea {
        border: 1px solid lightgray;
        width: 100%;
    }

    .input[type="text"]:focus {
        border: 1px solid lightblue;
    }
</style>

<div id="content" style="margin: 5px; padding-top: 50px">

    <section id="widget-grid" class="">
        <div class="row">

            <article class="col-sm-12 col-md-12 col-lg-12">

                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>

                        <h2 style="color:black;">Chart of Account</h2>

                    </header>
                    <div>
                        <div class="widget-body " style="padding-top:10px; width:100%;">
                         
                            <table style="width:100%;">
                                <tr>
                                    <td colspan="1">
                                        @using (Html.BeginForm(null, null, FormMethod.Post, new { @class = "form-horizontal" }))
                                        {
                                            @Html.AntiForgeryToken()
                                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Vote:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("Vote", ViewBag.vote as SelectList, "", new { @Class = "input", name = "Vote", style = "width:300px;", required="required" })
                                                
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Sub Vote:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("SubVote", ViewBag.subvote as SelectList, "", new { @Class = "input", name = "SubVote", style = "width:300px;",required = "required" })
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">TR/COUNCIL:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.TextBoxFor(model => model.TR, new { @Class = "input",id="TR", placeholder = "Search Tr", style = "width:300px;", required = "required" })
                                                        @*@Html.DropDownList("TR", ViewBag.ttrr as SelectList, "", new { @Class = "input", name = "TR", style = "width:300px;" })*@
                                                       
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Cost Centre:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("CostCentre", ViewBag.CostCentre as SelectList, "", new { @Class = "input", name = "CostCentre", style = "width:300px;", required = "required" })
                                                        
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Geographical Location:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("GeographicalLocation", ViewBag.geographical as SelectList, "", new { @Class = "input", style = "width:300px",required = "required" })
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Facility:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("Facility", ViewBag.facility as SelectList, "", new { @Class = "input", style = "width:300px",required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Sub Budget Class:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("SubBudgetClass", ViewBag.subbudget as SelectList, "", new { @Class = "input", style = "width:300px",  required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Project:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.TextBoxFor(model => model.Project, new { @Class = "input", placeholder = "Search Project code", style = "width:300px;", required = "required" })

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Service Output:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("ServiceOutput", ViewBag.service as SelectList, "", new { @Class = "input", style = "width:300px;", required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Activity:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.TextBoxFor(model => model.Activity, new { @Class = "input", placeholder = "Search Activity", style = "width:300px;", required = "required" })

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Fund Type:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("FundType", ViewBag.fund as SelectList, "", new { @Class = "input", style = "width:300px;", required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">COFOG:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("COFOG", ViewBag.cofog as SelectList, "", new { @Class = "input", style = "width:300px;", required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">Funding Source:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.DropDownList("FundingSource", ViewBag.source as SelectList, "", new { @Class = "input", style = "width:300px;", required = "required" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">GFS Code:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        @Html.TextBoxFor(model => model.GfsCode, new { @Class = "input", placeholder = "Search Gfs code", style = "width:300px;", required = "required" })

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">GFSCode Description:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        <textarea name="GFSDesc" readonly rows="3" id="GFSDesc" cols="40"></textarea>
                                                        @*@Html.TextAreaFor(model => model.GFSDesc, new { @Class = "input", name= "GFSDesc", rows = "3", style = "width:300px;", disabled = "disabled" })*@

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-4 control-label" style="text-align:right">GL Account:</label>
                                                <div class="col-md-8 inputGroupContainer">
                                                    <div class="input-group">
                                                        <textarea name="GlAccount" readonly rows="3" id="GlAccount" cols="40"></textarea>
                                                        @*@Html.TextAreaFor(model => model.GlAccount, new { @Class = "input",name= "GlAccount", @ReadOnly="Readonly", rows = "3", cols = "55", id = "GlAccount", style = "width:300px;"})*@
                                                    </div>
                                                </div>
                                            </div>

                                            @*<input type="hidden" id="InstitutionId" name="InstitutionId" value="@ViewBag.vote.InstitutionId" />*@
                                            <div class="form-actions">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <a href='@Url.Action("CoaList", "COAs")' class="btn btn-info" style=" width:80px;border-radius:1px;color:black">
                                                            <i class="glyphicon glyphicon-arrow-left"></i>
                                                            Back
                                                        </a>
                                                        <button type="submit" class="btn action-btn btn btn-info" id="submit">
                                                            <i class="fa fa-save"></i>
                                                            <img src="~/Content/img/loading.gif" id="saveLoader" />
                                                            Save
                                                        </button>

                                                    </div>
                                                </div>
                                            </div>

                                        }
                                    </td>
                                    <td colspan="1"></td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </div>
            </article>
        </div>
    </section>
</div>

@section pagespecific{
    <script>

        $("form").submit(function () {
            $("#saveLoader").toggle(true);
            $('#submit').attr("disabled", true);
        });

        $("#saveLoader").toggle(false);
        $("#submit").prop('disabled', false);


                if ('@TempData["Success"]' == 'Success') {
                    swal("Saved Successfully!", { icon: 'success' })
                         .then(Ok=> {
                             window.location.href = '@Url.Action("CoaList", "COAs")';
                         });
                } else if ('@TempData["Success"]' == 'No') {

                    swal("This COA  Exists !!");

                } else if ('@TempData["Success"]' == 'No2') {

                    swal("This GlAccount is Invalid Contains  'xxx'!!");

                } else if ('@TempData["Success"]' == 'Wrong') {
                    swal("This COA  Does not Contain all Segment !!");
                }

        var coaStringArray = ['xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', ];
        function generateCoaString(val, index) {
            coaStringArray[index] = val;
            var coastring = coaStringArray.toString();
            var coastring = coastring.split(",").join("|").replace("[", "").replace("]", "");
            $("#GlAccount").val(coastring);
        }

        $("#TR").on("keyup input paste cut", function () {
            var val = this.value
            if (val.length > 5) {
                $("#TR").val(val.substring(0, 5));
            }
        });
        $("#Project").on("keyup input paste cut", function () {
            var val = this.value
            if (val.length > 4) {
                $("#Project").val(val.substring(0, 4));
            }
        });
        $("#Activity").on("keyup input paste cut", function () {
            var val = this.value
            if (val.length > 6) {
                $("#Activity").val(val.substring(0, 6));
            }
        });
        $("#GfsCode").on("keyup input paste cut", function () {
            var val = this.value
            if (val.length > 8) {
                $("#GfsCode").val(val.substring(0, 8));
            }
        });

        $("#Vote").change(function () {
            var vvt = $(this).val();
            var vot = vvt.split("--")[0].trim();
            generateCoaString(vot, 0);
        });

        $("#SubVote").change(function () {
            var vvt = $(this).val();
            var vot = vvt.split("--")[0].trim();
            generateCoaString(vot, 1);
        });

        $("#TR").change(function () {
            var tr = $(this).val();
            var newtr = tr.split(" -")[0].trim();
            generateCoaString(newtr, 2);
        });
        $("#CostCentre").change(function () {
            var cs = $(this).val();
            var newcs = cs.split("--")[0].trim();
            generateCoaString(newcs, 3);
        });

        $("#GeographicalLocation").change(function () {
            generateCoaString($(this).val().trim(), 4);
        });


        $("#Facility").change(function () {
            generateCoaString($(this).val().trim(), 5);
        });

        $("#SubBudgetClass").change(function () {
            generateCoaString($(this).val().trim(), 6);
        });

        $("#Project").change(function () {
            var proj = $(this).val();
            projet = proj.split(" -")[0].trim();
            generateCoaString(projet, 7);
        });

        $("#ServiceOutput").change(function () {
            generateCoaString($(this).val().trim(), 8);
        });

        $("#Activity").change(function () {
            generateCoaString($(this).val().trim(), 9);
        });

        $("#FundType").change(function () {
            generateCoaString($(this).val().trim(), 10);
        });

        $("#COFOG").change(function () {
            var cofog = $(this).val();
            cofo = cofog.split("--")[0].trim();
            generateCoaString(cofo, 11);
        });

        $("#FundingSource").change(function () {
            generateCoaString($(this).val().trim(), 12);
        });

        $("#GfsCode").change(function () {
            var gfs = $(this).val();
            gfscod = gfs.split("-")[0].trim();
            $("#GFSDesc").val(gfs.split("-")[1]);
            generateCoaString(gfscod, 13);
        });

        $(document).ready(function () {
            $("#TR").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("autotr", "COAs")',
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Text, value: item.Vote };
                            }))
                        }
                    })
                },
            });
        });

        $(document).ready(function () {
            $("#Project").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("autopro", "COAs")',
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Text, value: item.Vote };
                            }))
                        }
                    })
                },
            });
        });
        //AUTO GFS
        //$(document).ready(function () {
        //    //var country = ["Australia", "Bangladesh", "Denmark", "Hong Kong", "Indonesia", "Netherlands", "New Zealand", "South Africa"];
        //    $("#GfsCode").select2({
        //        data: GfsCode
        //    });
        //});



        $(document).ready(function () {
            $("#GfsCode").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("autogfs", "COAs")',
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Text, value: item.Vote };
                            }))
                        }
                    })
                },
            });
        });
        //Get Documents
        $(document).ready(function () {
            $("#Activity").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("autoact", "COAs")',
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Text, value: item.value };
                            }))
                        }
                    })
                },
            });
        });

    </script>
}
