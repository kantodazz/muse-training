@model IFMIS.Areas.IFMISTZ.Models.ReceivingSummaryVM
@{
    ViewBag.Title = "Preview Receiving";

}
<style>
    .searchContainer {
        background-color: white;
        color: black;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 3px;
        padding-right: 10px;
    }

    input[type=search] {
        padding: 4px;
        border: hidden;
        border-radius: 4px;
    }

    .info-box {
        padding: 8px;
        background-color: #ECF3F8;
        /*padding-top:10px;*/
        /*text-align: center;*/
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .payee-entry {
        border: 1px solid #ccc;
        border-radius: 10px;
        padding-bottom: 10px;
    }

    .entry-label {
        position: relative;
        top: -12px;
        background-color: white;
        width: 200px;
        left: 15px;
        padding-left: 5px;
        padding-right: 5px;
        padding-bottom: 5px;
        text-align: center;
        font-weight: bold;
        color: #2196F3;
    }

    .title {
        text-align: center;
        width: 100%;
        padding-top: 10px;
        font-weight: bold;
        font-family: Cambria, Cochin, Georgia, Times, Times New Roman, serif;
    }

    .detail-section {
        padding: 10px;
    }

    .section-title {
        font-family: Cambria, Cochin, Georgia, Times, Times New Roman, serif;
        font-size: 18px;
        font-weight: bold;
    }

    .sect-label {
        width: 250px;
        font-size: 15px;
        font-weight: 600;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    td {
        padding: 5px;
        text-align: left;
        border-bottom: 1px dashed #ccc;
    }

    .row-align {
        display: flex;
        flex-wrap: nowrap;
        justify-content: space-evenly;
    }

    .row-align-1 {
        display: flex;
        flex-wrap: wrap;
        align-content: center;
    }

    .ico {
        margin-right: 5px;
    }

    .btn-size {
        width: 90px;
    }

    .speech-bubble {
        position: relative;
        background: #efebe9;
        border-radius: .4em;
        color: white;
        padding: 10px;
    }

        .speech-bubble:after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 9px solid transparent;
            border-right-color: #efebe9;
            border-left: 0;
            margin-top: -9px;
            margin-left: -9px;
        }

    .speech-bubble-r {
        position: relative;
        background: #eeeeee;
        border-radius: .4em;
        color: white;
        padding: 10px;
    }

        .speech-bubble-r:after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 9px solid transparent;
            border-left-color: #eeeeee;
            border-right: 0;
            margin-top: -9px;
            margin-right: -9px;
        }

    .chart-box {
        padding: 8px;
        border-radius: 5px;
        min-height: 150px;
    }

    /*  //tunkete.mwamsojo@hazina.go.tz;*/

</style>


<div id="content" style="margin: 5px; padding-top: 30px">

    <div class="row">


    </div>


    <!-- widget grid -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                    <br />
                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2>@ViewBag.Title</h2>

                    </header>


                    <div>
                        <div class="widget-body " style="padding-top:10px;width:100%">
                            <div class="payee-entry">
                                <div class="entry-label">LPO Receiving Details</div>
                                <table>
                                    @if (Model.EOfficeRefence != null)
                                    {
                                        <tr>
                                            <th>@Html.DisplayNameFor(model => model.EOfficeRefence)</th>
                                            <td><a href="@Url.Action("eofficedetails","dfundapprovals",new { id = @Model.EOfficeRefenceId })" title="Click to View " data-toggle="tooltip" target="_parent"><b>@Html.DisplayFor(model => model.EOfficeRefence)</b></a></td>
                                            <th>@Html.DisplayNameFor(model => model.EOfficeTitle)</th>
                                            <td>@Html.DisplayFor(model => model.EOfficeTitle)</td>
                                        </tr>
                                    }
                                    @if (Model.DfundRefence != null)
                                    {
                                        <tr>
                                            <th>@Html.DisplayNameFor(model => model.DfundRefence)</th>
                                            <td><a href="@Url.Action("eofficedetails", "dfundapprovals", new { id = @Model.DfundRefenceId })" title="Click to View " data-toggle="tooltip" target="_parent"><b>@Html.DisplayFor(model => model.DfundRefence)</b></a></td>
                                            <th>@Html.DisplayNameFor(model => model.DfundTitle)</th>
                                            <td>@Html.DisplayFor(model => model.DfundTitle)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <th>@Html.DisplayNameFor(model => model.ReceivingNumber): </th>
                                        <td>@Html.DisplayFor(model => model.ReceivingNumber)</td>
                                        <th>@Html.DisplayNameFor(model => model.PurchaseOrderNo): </th>
                                        <td>@Html.DisplayFor(model => model.PurchaseOrderNo)</td>
                                    </tr>
                                    <tr>
                                        <th>@Html.DisplayNameFor(model => model.SubBudgetClass): </th>
                                        <td>@Html.DisplayFor(model => model.SubBudgetClass)</td>
                                        <th>@Html.DisplayNameFor(model => model.PayerAccount)</th>
                                        <td>@Html.DisplayFor(model => model.PayerAccount)</td>
                                    </tr>
                                    <tr>
                                        <th>@Html.DisplayNameFor(model => model.PayeeAccountName): </th>
                                        <td>@Html.DisplayFor(model => model.PayeeAccountName)</td>
                                        <th>@Html.DisplayNameFor(model => model.PayeeAccountNo)</th>
                                        <td>@Html.DisplayFor(model => model.PayeeAccountNo)</td>
                                    </tr>
                                    <tr>
                                        <th>@Html.DisplayNameFor(model => model.TransactionAmount): </th>
                                        <td>@Html.DisplayFor(model => model.TransactionAmount) @Html.DisplayFor(model => model.EOfficeCurrency)</td>
                                        <th>@Html.DisplayNameFor(model => model.TransactionExchangeRate)</th>
                                        <td>@Html.DisplayFor(model => model.TransactionExchangeRate)</td>
                                    </tr>
                                    <tr>
                                        <th>@Html.DisplayNameFor(model => model.OperationAmount): </th>
                                        <td>@Html.DisplayFor(model => model.OperationAmount) @Html.DisplayFor(model => model.OperationCurrency)</td>
                                    </tr>
                                    @if (Model.OverallStatus == "Rejected")
                                    {
                                        if (Model.RejectionReason != null)
                                        {
                                            <tr>
                                                <th>@Html.DisplayNameFor(model => model.RejectionReason)</th>
                                                <td>@Html.DisplayFor(model => model.RejectionReason)</td>
                                            </tr>
                                        }
                                    }
                                    @if (Model.OverallStatus == "Rejected from Payment Voucher")
                                    {
                                        if (Model.RejectionReason != null)
                                        {
                                            <tr>
                                                <th>@Html.DisplayNameFor(model => model.RejectionReason)</th>
                                                <td>@Html.DisplayFor(model => model.RejectionReason)</td>
                                            </tr>
                                        }
                                    }
                                    @if (Model.OverallStatus.ToUpper() == "CONFIRMED")
                                    {
                                        if (Model.RejectionSolution != null)
                                        {
                                            <tr>
                                                @if (Model.RejectionReason != null)
                                                {
                                                    <th>@Html.DisplayNameFor(model => model.RejectionReason): </th>
                                                    <td>@Html.DisplayFor(model => model.RejectionReason)</td>
                                                }
                                                @if (Model.RejectionSolution != null)
                                                {
                                                    <th>@Html.DisplayNameFor(model => model.RejectionSolution)</th>
                                                    <td>@Html.DisplayFor(model => model.RejectionSolution)</td>
                                                }
                                            </tr>
                                        }
                                    }


                                </table>

                            </div>

                            <br />
                            <div class="payee-entry">
                                <div class="entry-label">Attachments</div>
                                @if (Model.InvoiceNumber != null)
                                {
                                    <div class="row">

                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Invoice Number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.InvoiceNumber)
                                        </div>
                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Date&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Convert.ToDateTime(Model.InvoiceDate).ToString("dd/MM/yyyy")
                                        </div>
                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            @if (Model.InvoiceFileName != null)
                                            {
                                                <a href="@Url.Action("InvoiceAttachment","Procurement",new {Filename=Model.InvoiceFileName})">Download</a>
                                            }
                                            else { 
                                            }
                                        </div>
                                    </div>
                                }
                                @if (Model.DeliveryNote != null)
                                {

                                    <div class="row">

                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Delivery Note&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.DeliveryNote)
                                        </div>
                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Date&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Convert.ToDateTime(Model.DeliveryDate).ToString("dd/MM/yyyy")
                                        </div>

                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            <a href="@Url.Action("DeliveryAttachment","Procurement",new {Filename=Model.DeliveryFileName })">Download</a>
                                        </div>

                                    </div>


                                }

                                @if (Model.InspectionReportNo != null)
                                {
                                    <div class="row">

                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Inspection/Report&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.InspectionReportNo)
                                        </div>
                                        <div class="col-sm-3 col-md-3 col-lg-3">
                                            <strong>Date&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;@Convert.ToDateTime(Model.InspectionReportDate).ToString("dd/MM/yyyy")
                                        </div>


                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            <a href="@Url.Action("InspectionAttachment","Procurement",new {Filename=Model.InspReportFileName })">Download</a>
                                        </div>

                                    </div>
                                }

                            </div>
                            <br />
                            @if (Model.PVNo != null)
                            {
                                <div class="payee-entry">
                                    <div class="entry-label">Voucher Details</div>
                                    <div class="row">
                                        @if (Model.PVNo != null)
                                        {
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                <strong>Voucher Number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.PVNo)
                                            </div>
                                        }
                                        @if (Model.VoucherStatus != null)
                                        {
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                <strong>Voucher Status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.VoucherStatus)
                                            </div>
                                        }
                                    </div>
                                    <div class="row">
                                        @if (Model.SubLevelCode != null)
                                        {
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                <strong>Cost Center&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong>&nbsp;&nbsp;&nbsp;&nbsp;@Html.DisplayFor(model => model.SubLevelCode)
                                            </div>
                                        }

                                    </div>
                                </div>
                                <br />
                            }

                            <div class="jarviswidget" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false">

                                <header>
                                    <h2><strong></strong> <i></i></h2>

                                    <ul id="widget-tab-1" class="nav nav-tabs pull-right">

                                        <li class="active">

                                            <a data-toggle="tab" href="#hr1"> <i class="fa fa-lg fa-arrow-circle-o-down"></i> <span class="hidden-mobile hidden-tablet"> Items List<span class="badge inbox-badge margin-right-13" style="background-color:#2196F3">@Model.ReceivingList.Count()</span></span> </a>

                                        </li>
                                        <li>

                                            <a data-toggle="tab" href="#hr2"> <i class="fa fa-lg fa-arrow-circle-o-down"></i> <span class="hidden-mobile hidden-tablet"> GL Account(s)<span class="badge inbox-badge margin-right-13" style="background-color:#2196F3">@Model.ReceivingCoas.Count()</span></span> </a>

                                        </li>
                                    </ul>

                                </header>

                                <!-- widget div-->
                                <div>

                                    <!-- widget edit box -->
                                    <div class="jarviswidget-editbox">
                                        <!-- This area used as dropdown edit box -->

                                    </div>
                                    <!-- end widget edit box -->
                                    <!-- widget content -->
                                    <div class="widget-body no-padding">

                                        <!-- widget body text-->

                                        <div class="tab-content padding-10">
                                            <div class="tab-pane fade in active" id="hr1">
                                                <div class="widget-body no-padding">

                                                    <br />




                                                    <div class="custom-scroll" style="height:130px; overflow-y: scroll;">
                                                        @if (Model.ReceivingList.Count() > 0)
                                                        {
                                                            <table align="center" class="table table-bordered  table-condensed" style="width:97%">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="text-align:center">#</th>
                                                                        <th style="text-align:left">Item</th>
                                                                        <th style="text-align:left">Category</th>
                                                                        <th style="text-align:left">Class</th>
                                                                        <th style="text-align:left">UOM</th>
                                                                        <th style="text-align:center">Quantity</th>
                                                                        <th style="text-align:right">Unit Price (@Html.DisplayFor(model => model.Currency))</th>
                                                                        <th style="text-align:right">Total (@Html.DisplayFor(model => model.Currency))</th>

                                                                    </tr>
                                                                </thead>

                                                                <tbody>
                                                                    @{var i = 0;
                                                                        decimal grandTotal = 0;
                                                                        var item_total = 0;}
                                                                    @foreach (var item in Model.ReceivingList)
                                                                    {
                                                                        grandTotal = grandTotal + Convert.ToDecimal(item.Amount);
                                                                        item_total = item_total + (int)item.ReceivedQuantity;
                                                                        i++;
                                                                        <tr>
                                                                            <td style="text-align:center">
                                                                                @i
                                                                            </td>
                                                                            <td style="text-align:left">
                                                                                @Html.DisplayFor(modelItem => item.ItemDesc)
                                                                            </td>
                                                                            <td style="text-align:left">
                                                                                @Html.DisplayFor(modelItem => item.ItemClassification.ItemCategory)
                                                                            </td>
                                                                            <td style="text-align:left">
                                                                                @Html.DisplayFor(modelItem => item.ItemClassification.ClassificationDesc)
                                                                            </td>
                                                                            <td style="text-align:left">
                                                                                @Html.DisplayFor(modelItem => item.UOM)
                                                                            </td>
                                                                            <td style="text-align:center">
                                                                                @Html.DisplayFor(modelItem => item.ReceivedQuantity)
                                                                            </td>
                                                                            <td style="text-align:right">

                                                                                @Html.DisplayFor(modelItem => item.UnitPrice)

                                                                            </td>
                                                                            <td style="text-align:right">

                                                                                @Html.DisplayFor(modelItem => item.Amount)
                                                                            </td>

                                                                        </tr>

                                                                    }

                                                                </tbody>
                                                            </table>
                                                        }



                                                    </div>



                                                </div>

                                            </div>
                                            <div class="tab-pane fade in" id="hr2">
                                                <div class="widget-body no-padding">

                                                    <br />




                                                    <div class="custom-scroll" style="height:130px; overflow-y: scroll;">
                                                        @if (Model.ReceivingCoas.Count() > 0)
                                                        {
                                                            <table class="table table-bordered table-hover table-condensed" id="items_charge" style="width:100%">
                                                                <thead>
                                                                    <tr style="width:5%">
                                                                        <th>#</th>
                                                                        <th style="text-align:left">GL Account</th>
                                                                        <th style="text-align:left">GL Account Desc</th>
                                                                        <th style="text-align:left">Funding Reference</th>
                                                                        <th style="text-align:right">Amount</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @for (var i = 0; i < Model.ReceivingCoas.Count(); i++)
                                                                    {
                                                                        var j = i + 1;
                                                                        <tr>
                                                                            <td style="text-align:center">@j</td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => Model.ReceivingCoas[i].GLAccount)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => Model.ReceivingCoas[i].GLAccountDesc)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => Model.ReceivingCoas[i].FundingReference)
                                                                            </td>
                                                                            <td style="text-align:right">
                                                                                @Html.DisplayFor(modelItem => Model.ReceivingCoas[i].ExpenseAmount)
                                                                            </td>

                                                                        </tr>
                                                                    }
                                                                    <tr>
                                                                        <td colspan="4" style="text-align:right"><strong>Total</strong></td>
                                                                        <td style="text-align:right"><strong>@Convert.ToDecimal(Model.ReceivingCoas.Select(a => a.ExpenseAmount).DefaultIfEmpty(0).Sum()).ToString("#,##0/=")</strong></td>
                                                                    </tr>

                                                                </tbody>
                                                            </table>
                                                        }




                                                    </div>



                                                </div>

                                            </div>
                                            <div class="form-actions">
                                                <div class="row">
                                                    <div class="col-md-8 col-md-offset-1">
                                                        @if (Model.OverallStatus.ToUpper() == "PENDING" || Model.OverallStatus == "Rejected")
                                                        {
                                                            <a href="@Url.Action("ReceivingList","Procurement")" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                                        }
                                                        else if (Model.OverallStatus.ToUpper() == "CONFIRMED")
                                                        {

                                                            <a href="@Url.Action("ApproveReceivings","Procurement")" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                                        }
                                                        else
                                                        {
                                                            <a href="@Request.UrlReferrer" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                                        }
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <!-- end widget body text-->
                                        <!-- widget footer -->
                                        <!-- end widget footer -->

                                    </div>
                                    <!-- end widget content -->

                                </div>
                                <!-- end widget div -->

                            </div>


                        </div>


                    </div>
                </div>
            </article>

        </div>
    </section>

</div>









