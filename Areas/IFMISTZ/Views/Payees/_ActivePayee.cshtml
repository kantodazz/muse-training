@model IEnumerable<IFMIS.Areas.IFMISTZ.Models.Payee>

<hr class="simple" />
@if (Model.Where(a => a.OverallStatus.ToUpper() == "ACTIVE" && (a.ApprovalStatus == "Approved" || a.ApprovalStatus == "Pending" || a.ApprovalStatus=="Confirmed")).Count() > 0)
{
    <table id="dt_basic1" class="table table-striped table-bordered table-hover table-condensed" width="100%">
        <thead>
            <tr style="background-color: #f5f5f5; color:black">
                <th>#</th>
                <th>Payee Code </th>
                <th>Payee Name </th>
                <th>Approval Status</th>
                <th>Payee Status</th>
                <th>Created By</th>
                <th>Institution Code</th>
                @*<th>Institution Name</th>*@
                <th>Action</th>
            </tr>
        </thead>
        @{
            int i = 0;
        }
        <tbody>
            @foreach (var item in Model.Where(a => a.OverallStatus.ToUpper() == "ACTIVE"))
                {
                    i++;
                <tr>
                    <td>@i</td>
                    <td>
                        @Html.DisplayFor(modelItem => item.PayeeCode)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.PayeeName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ApprovalStatus)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.OverallStatus)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CreatedBy)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InstitutionCode)
                    </td>
                    @*<td>
                        @Html.DisplayFor(modelItem => item.InstitutionName)
                    </td>*@
                    <td style="text-align: center">
                        <div class="btn-group">
                            <button type="button" class="btn btn-info btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu">

                                @if (item.OverallStatus.ToUpper() == "ACTIVE" && this.User.IsInRole("Payee Entry") )
                                {
                                    <li><a href="@Url.Action("EditPayee", "Payees", new { id = item.PayeeId })">Edit</a></li>
                                }
                                @if (item.OverallStatus.ToUpper() == "ACTIVE" && this.User.IsInRole("Payee Entry"))
                                {
                                    <li><a href="@Url.Action("AddPayeeAccount", "Payees", new { id = item.PayeeId })">Add Account</a></li>
                                }
                                <li><a href="@Url.Action("PayeeDetails", "Payees", new { id = item.PayeeId })">Details</a></li>

                                @if ((item.ApprovalStatus=="Pending" || item.ApprovalStatus=="Confirmed") && this.User.IsInRole("Payee Entry"))
                                {
                                    <li><a href="#" onclick="cancelPayee(@item.PayeeId)">Cancel</a></li>
                                }
                                @if (item.OverallStatus.ToUpper() == "ACTIVE" && this.User.IsInRole("Payee Entry"))
                                {
                                    <li><a href="#" onclick="deactivatePayee(@item.PayeeId)">Deactivate</a></li>
                                }
                                @if(item.OverallStatus.ToUpper() == "INACTIVE" && this.User.IsInRole("Payee Entry"))
                                {
                                    <li><a href="#" onclick="activatePayee(@item.PayeeId)">Activate</a></li>
                                }

                                @if (item.OverallStatus.ToUpper() == "ACTIVE" && this.User.IsInRole("Payee Verification"))
                                {
                                    <li><a href="#" onclick="verifyPayee(@item.PayeeId)">Verify</a></li>
                                }
                                @if (item.ApprovalStatus == "Approved" && item.OverallStatus.ToUpper() == "ACTIVE" && item.Attachment != null)
                                {
                                    <li><a href="@Url.Action("PreviewAttachment", "Payees", new { id = item.PayeeId })">Download Attachment</a></li>
                                }
                            </ul>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
            }
            else
            {
                <div class="alert alert-info" role="alert">
                    No Records!
                </div>
            }
<!-- END COL -->
        
<!-- END MAIN CONTENT -->
<!--Start of delete confirmation modal section-->
<div class="modal fade" id="responseModal6" tabindex="-1" role="dialog" aria-labelledby="lblmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert alert-info" style="font:bold 16px Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="lblmodal">Confirm Delete</h4>
            </div>
            <div class="modal-body">
                <p class="success-message">Are you sure you want to delete this record ? </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info delete-confirm">Yes</button>
                <button class="btn btn-info confirm-cancel" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="responseModal7" tabindex="-1" role="dialog" aria-labelledby="lblmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert alert-info" style="font:bold 16px Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="lblmodal">Deactivate Payee</h4>
            </div>
            <div class="modal-body">
                <p class="success-message">Are you sure you want to Deactivate this Payee ? </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info delete-confirm">Yes</button>
                <button class="btn btn-info confirm-cancel" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="responseModal8" tabindex="-1" role="dialog" aria-labelledby="lblmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert alert-info" style="font:bold 16px Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="lblmodal">Activate Payee</h4>
            </div>
            <div class="modal-body">
                <p class="success-message">Are you sure you want to activate this Payee ? </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info delete-confirm">Yes</button>
                <button class="btn btn-info confirm-cancel" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="lblmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert alert-info" style="font:bold 16px Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

                <h4 class="modal-title" id="lblmodal">Cancel Dialog</h4>
            </div>
            <div class="modal-body" id="modal-body">
                <p class="success-message">Are you sure you want to cancel this payee ? </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info approve-confirm">Yes</button>
                <button class="btn btn-info delete-cancel" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="verifyModal" tabindex="-1" role="dialog" aria-labelledby="lblmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert alert-info" style="font:bold 16px Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="lblmodal">Verify Payee</h4>
            </div>
            <div class="modal-body">
                <p class="success-message">Are you sure you want to Verify this Payee ? </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info delete-confirm">Yes</button>
                <button class="btn btn-info confirm-cancel" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<script>
    // DO NOT REMOVE : GLOBAL FUNCTIONS!

    var deletePayee = function (id) {
        $("#responseModal6").modal('show');

        $(".delete-confirm").click(function () {
            if (id != "") {
                var url = '@Url.Action("DeletePayee", "Payees")';
                $.ajax({
                    url: url,
                    data: { id: id },
                    type: "POST",
                    success: function (response) {
                        if (response) {
                            if (response == "Success") {
                                //now re-using the boostrap modal popup to show success message.
                                //dynamically we will change background colour
                                if ($('.modal-header').hasClass('alert-info')) {
                                    $('.modal-header').removeClass('alert-info').addClass('alert-info');
                                    //hide ok button as it is not necessary
                                    $('.delete-confirm').css('display', 'none');
                                    $('.confirm-cancel').html('Ok').click(function () {
                                        location.reload();
                                    });
                                }
                                $('.success-message').html('Record deleted successfully');
                            }
                            else if (response == "DbException") {
                                alert(response);
                            } else {
                                alert(response);
                            }
                        }
                    }, error: function (err) {
                        if (!$('.modal-header').hasClass('alert-info')) {
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            $('.delete-confirm').css('display', 'none');
                        }
                        $('.success-message').html(err.statusText);
                    }
                });
            }
        });
    };

    var deactivatePayee = function (id) {
        $("#responseModal7").modal('show');

        $(".delete-confirm").click(function () {
            if (id != "") {
                var url = '@Url.Action("DeactivatePayee", "Payees")';
                $.ajax({
                    url: url,
                    data: { id: id },
                    type: "POST",
                    success: function (response) {
                        if (response) {
                            if (response == "Success") {
                                //now re-using the boostrap modal popup to show success message.
                                //dynamically we will change background colour
                                if ($('.modal-header').hasClass('alert-info')) {
                                    $('.modal-header').removeClass('alert-info').addClass('alert-info');
                                    //hide ok button as it is not necessary
                                    $('.delete-confirm').css('display', 'none');
                                    $('.confirm-cancel').html('Ok').click(function () {
                                        location.reload();
                                    });
                                }
                                $('.success-message').html('Payee is deactivated!');
                            }
                            else if (response == "DbException") {
                                alert(response);
                            } else {
                                alert(response);
                            }
                        }
                    }, error: function (err) {
                        if (!$('.modal-header').hasClass('alert-info')) {
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            $('.delete-confirm').css('display', 'none');
                        }
                        $('.success-message').html(err.statusText);
                    }
                });
            }
        });
    };

    var activatePayee = function (id) {
        $("#responseModal8").modal('show');

        $(".delete-confirm").click(function () {
            if (id != "") {
                var url = '@Url.Action("ActivatePayee", "Payees")';
                $.ajax({
                    url: url,
                    data: { id: id },
                    type: "POST",
                    success: function (response) {
                        if (response) {
                            if (response == "Success") {
                                //now re-using the boostrap modal popup to show success message.
                                //dynamically we will change background colour
                                if ($('.modal-header').hasClass('alert-info')) {
                                    $('.modal-header').removeClass('alert-info').addClass('alert-info');
                                    //hide ok button as it is not necessary
                                    $('.delete-confirm').css('display', 'none');
                                    $('.confirm-cancel').html('Ok').click(function () {
                                        location.reload();
                                    });
                                }
                                $('.success-message').html('Payee is activated!');
                            }
                            else if (response == "DbException") {
                                alert(response);
                            } else {
                                alert(response);
                            }
                        }
                    }, error: function (err) {
                        if (!$('.modal-header').hasClass('alert-info')) {
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            $('.delete-confirm').css('display', 'none');
                        }
                        $('.success-message').html(err.statusText);
                    }
                });
            }
        });
    };
    var cancelPayee = function (id) {
        $("#modal").modal({
            backdrop: "static",
            keyboard: false
        });

        $(".approve-confirm").click(function () {
            if (id != "") {
                var url = '@Url.Action("CancelPayee", "Payees")';
                $.ajax({
                    url: url,
                    data: { id: id },
                    type: "POST",
                    success: function (response) {
                        if (response == "Success") {
                            //now re-using the boostrap modal popup to show success message.
                            //dynamically we will change background colours
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            //hide ok button as it is not necessary
                            $('.approve-confirm').css('display', 'none');
                            $('.delete-cancel').html('Ok').click(function () {
                                location.reload();
                            });
                            $('.success-message').html('Cancelled successfully');
                        }
                        else {
                            //hide ok button as it is not necessary
                            $('.delete-confirm').css('display', 'none');
                            $('.delete-cancel').html('Close').click(function () {
                                location.reload();
                            });
                            $('.success-message').html(response);
                        }
                    }, error: function (err) {
                        if (!$('.modal-header').hasClass('alert-info')) {
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            $('.delete-confirm').css('display', 'none');
                        }
                        $('.success-message').html(err.statusText);
                    }
                });
            }
        });
    };
    var verifyPayee = function (id) {
        $("#verifyModal").modal('show');

        $(".delete-confirm").click(function () {
            if (id != "") {
                var url = '@Url.Action("VerifyPayee", "Payees")';
                $.ajax({
                    url: url,
                    data: { id: id },
                    type: "POST",
                    success: function (response) {
                        if (response) {
                            if (response == "Success") {
                                //now re-using the boostrap modal popup to show success message.
                                //dynamically we will change background colour
                                if ($('.modal-header').hasClass('alert-info')) {
                                    $('.modal-header').removeClass('alert-info').addClass('alert-info');
                                    //hide ok button as it is not necessary
                                    $('.delete-confirm').css('display', 'none');
                                    $('.confirm-cancel').html('Ok').click(function () {
                                        location.reload();
                                    });
                                }
                                $('.success-message').html('Payee is Verified Successfully!');
                            }
                            else if (response == "DbException") {
                                alert(response);
                            } else {
                                alert(response);
                            }
                        }
                    }, error: function (err) {
                        if (!$('.modal-header').hasClass('alert-info')) {
                            $('.modal-header').removeClass('alert-info').addClass('alert-info');
                            $('.delete-confirm').css('display', 'none');
                        }
                        $('.success-message').html(err.statusText);
                    }
                });
            }
        });
    };

</script>


