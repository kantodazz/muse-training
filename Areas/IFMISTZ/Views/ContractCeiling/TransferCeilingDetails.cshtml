@model IFMIS.Areas.IFMISTZ.Models.CeilingSummaryVM
@{
    ViewBag.Title = "Ceiling Details";
    var i = 0;


}
<style>
    .pull-right {
        margin-top: 10px;
    }

    ul .header-dropdown-list, .hidden-xs {
        margin-top: 10px;
    }
</style>
<div id="content">

    <!-- widget grid -->
    <section id="widget-grid">


        <!-- START ROW -->

        <div>

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header class="margin-top-10">
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2>Ceiling Details </h2>

                    </header>


                    <div>

                        <div class="widget-body">
                            <div align="center">
                                <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" style="display:none" />
                            </div>
                            <div class="row mx-1  p-5" style="font-size:15px;">
                                <div class="col-md-6 ">
                                    <div class="row fs-3">
                                        <div class="control-label col-sm-12 fw-bold ">
                                            <span style="color:#2276cf;margin-bottom:10px">TRENSFERING INSTITUTION</span>
                                        </div>
                                        </div>
                                    <div class="row py-2">
                                        <div class="control-label col-sm-12  col-md-4 col-lg-3 fw-bold ">Institution Name</div>
                                        <div class="col-sm-12 col-md-8 col-lg-9">
                                            <span style="font-weight:bold">:</span>  @Html.DisplayFor(model => model.InstitutionName)
                                        </div>
                                    </div>

                                    <div class="row py-2">
                                        <div class="control-label  col-md-4 col-lg-3 fw-bold">Institution Code</div>
                                        <div class="col-md-8 col-lg-9">
                                            <div>
                                                <span class="">
                                                    <span style="font-weight:bold">:</span>   @Html.DisplayFor(model => model.InstitutionCode)
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row py-2">
                                        <div class="control-label  col-md-4 col-lg-3 fw-bold">Cost Center Name</div>
                                        <div class="col-md-8 col-lg-9">
                                            <div>
                                                <span class="">
                                                    <span style="font-weight:bold">:</span>   @Html.DisplayFor(model => model.CostCenterNameFrom)
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row py-2">
                                        <div class="control-label  col-md-4 col-lg-3 fw-bold ">Fund Category </div>
                                        <div class="col-md-8 col-lg-9">
                                            <div>
                                                <span class="">
                                                    <span style="font-weight:bold">:</span>    @Html.DisplayFor(model => model.FundCategoryDescription)
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row py-2">
                                        <div class="control-label  col-md-4 col-lg-3 fw-bold ">Amount </div>
                                        <div class="col-md-8 col-lg-9">
                                            <div>
                                                <span class="">
                                                    <span style="font-weight:bold">:</span>    @Html.DisplayFor(model => model.TotalAmount)
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row py-2">
                                        <div class="control-label  col-md-4 col-lg-3 fw-bold">Description</div>
                                        <div class="col-md-8 col-lg-9">
                                            <div>
                                                <span class="text-muted">
                                                    <span style="font-weight:bold">:</span>  @Html.DisplayFor(model => model.CeilingDescription)
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="row fs-3">
                                        <div class="control-label col-sm-12 fw-bold ">
                                            <span style="color:#2276cf;margin-bottom:10px">RECEIVING INSTITUTION</span>
                                        </div>
                                        </div>
                                        <div class="row py-2">
                                            <div class="control-label col-sm-12  col-md-4 col-lg-3 fw-bold ">Institution Name</div>
                                            <div class="col-sm-12 col-md-8 col-lg-9">
                                                <span style="font-weight:bold">:</span>  @Html.DisplayFor(model => model.InstitutionNameTo)
                                            </div>
                                        </div>

                                        <div class="row py-2">
                                            <div class="control-label  col-md-4 col-lg-3 fw-bold">Institution Code</div>
                                            <div class="col-md-8 col-lg-9">
                                                <div>
                                                    <span class="">
                                                        <span style="font-weight:bold">:</span>   @Html.DisplayFor(model => model.InstitutionCodeTo)
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row py-2">
                                            <div class="control-label  col-md-4 col-lg-3 fw-bold">Cost Center Name</div>
                                            <div class="col-md-8 col-lg-9">
                                                <div>
                                                    <span class="">
                                                        <span style="font-weight:bold">:</span>   @Html.DisplayFor(model => model.CostCenterNameTo)
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row py-2">
                                            <div class="control-label  col-md-4 col-lg-3 fw-bold ">Fund Category </div>
                                            <div class="col-md-8 col-lg-9">
                                                <div>
                                                    <span class="">
                                                        <span style="font-weight:bold">:</span>    @Html.DisplayFor(model => model.FundCategoryDescription)
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row py-2">
                                            <div class="control-label  col-md-4 col-lg-3 fw-bold ">Amount </div>
                                            <div class="col-md-8 col-lg-9">
                                                <div>
                                                    <span class="">
                                                        <span style="font-weight:bold">:</span>    @Html.DisplayFor(model => model.TotalAmount)
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                    </div>


                            </div>
                            <hr class="py-3" />
                            <div class="row">
                                <div class="row  py-4">
                                    <div class="col-md-offset-1">
                                        @if (Model.OverallStatus == "Pending")
                                        {
                                           <a href="@Url.Action("TransferCeiling","ContractCeiling")" class="btn btn-info"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                            <button type="button" onclick="confirmEntry(@Model.CeilingSummaryId)" class="btn btn-info">
                                                <i class="glyphicon glyphicon-floppy-disk"></i> Confirm
                                            </button>
                                        }
                                        @if (Model.OverallStatus == "Confirmed")
                                        {
                                            <a href="@Url.Action("ApproveCeiling","ContractCeiling")" class="btn btn-info"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>

                                            <button type="button" onclick="approveEntry(@Model.CeilingSummaryId,'APPROVED')" class="btn btn-info">
                                                <i class="glyphicon glyphicon-floppy-disk"></i> Approve
                                            </button>

                                            <button type="button" onclick="cancelEntry(@Model.CeilingSummaryId,'CANCELED')" class="btn btn-secondary">
                                                <i class="glyphicon glyphicon-floppy-disk"></i> Cancel
                                            </button>
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <div class="row">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>

        </div>
    </section>

</div>
@section pagespecific {

    <script>
       var isReadOnly = true;
       function requestEdit(id) {

           if (isReadOnly) {
               isReadOnly = false;
               document.getElementById(id).readOnly = false;
           } else {
               isReadOnly = true;
               document.getElementById(id).readOnly = true;
           }

       }

         var confirmEntry = function (id) {
                                  swal({
                                    title: 'Confirmation',
                                    text: "Do you what to confirm this entry",
                                    buttons: [
                                      'No',
                                      'Yes'
                                    ],
                                }).then(function (isConfirm) {
                                    if (isConfirm) {
                                        var url = '@Url.Action("ConfirmEntry", "ContractCeiling")';
                                        $.ajax(
                            {
                                type: "POST",
                                url: url,
                                data: { id: id },
                                success: function (response) {
                                    if (response == "Success") {

                                        swal("Confirmed successfully!", { icon: "success" })
                                                  .then((value) => {
                                                     var url = '@Url.Action("ApproveCeiling", "ContractCeiling")';
                                                                    window.location.replace(url);
                                                  });


                                    }
                                    else {

                                        swal(response);
                                    }
                                },
                                error: function (xhr) {
                                    swal(error);
                                    $("#divLoader").hide();
                                },

                            });
                                    } else {
                                        swal("Cancelled", "No change was made");
                                    }
                                });


        };

        function cancelEntry(id) {
             swal({
                        title: 'Confirmation',
                        text: "Do you what to cancel this entry ?",
                        buttons: [
                          'No',
                          'Yes'
                        ],
                    }).then(function (isConfirm) {
                        if (isConfirm) {
                            var url = '@Url.Action("CancelEntry", "ContractCeiling")';
                            $.ajax(
                {
                    type: "POST",
                    url: url,
                    data: { id: id },
                    success: function (response) {
                        if (response == "Success") {
                            swal("Cancelled  successfully!", { icon: "success" })
                                         .then((value) => {
                                             location.reload();
                                         });
                        }
                        else {
                            alert(response);
                        }
                    },
                    error: function (xhr) {
                        //console.log(xhr.responseText);
                        swal("An error has occured, contact system support");

                    },

                });
                        } else {
                            swal("Cancelled", "No change was made");
                        }
                    });

        };
        function approveEntry(id,action) {
                                  swal({
                                    title: 'Confirmation',
                                    text: "Do you what to approve this entry",
                                    buttons: [
                                      'No',
                                      'Yes'
                                    ],
                                }).then(function (isConfirm) {
                                    if (isConfirm) {
                                        var url = '@Url.Action("ApproveEntry", "ContractCeiling")';
                                        $.ajax(
                                        {
                                            type: "POST",
                                            url: url,
                                                data: { id: id, action: action },
                                            success: function (response) {
                                                if (response == "Success") {

                                                    swal("Approved successfully!", { icon: "success" })
                                                              .then((value) => {
                                                                  var url = '@Url.Action("ApproveCeiling", "ContractCeiling")';
                                                                    window.location.replace(url);
                                                              });


                                                }
                                                else {

                                                    swal(response);
                                                }
                                            },
                                            error: function (xhr) {
                                                swal(error);
                                                $("#divLoader").hide();
                                            },

                                        });
                                    } else {
                                        swal("Cancelled", "No change was made");
                                    }
                                });


        };


        function edit(formData, id, uuid) {
            $("#save_button").prop('disabled', true);
            var url = '@Url.Action("PostCeiling", "ContractCeiling")';
            debugger;
            var cid = id;
            var Amount =  $("#" + uuid).val();
            var am = parseFloat(Amount);
            $.ajax({
                type: "post",
                url: url,
                data: { ContractCeilingId: cid, Amount: am },

                success: function (response) {
                    $("#save_button").prop('disabled', false);
                    if (response.Response == "Success") {
                        swal("Data saved successfully", { icon: "success" })
                            .then((value) => {
                                var url = '@Url.Action("PendingCeiling", "ContractCeiling")';
                                window.location.replace(url);
                            });
                    }
                    else {
                        swal(response.ResponseDescription);
                    }
                }
            });
            return false;
        }

        function ApproveSingleEntry(id, action) {

            swal({
                title: 'Confirmation',
                text: "Do you what to approve this entry",
                buttons: ['No', 'Yes'],
            }).then(function (isConfirm) {
                if (isConfirm) {
                    var url = '@Url.Action("ApproveSingleEntry", "ContractCeiling")';
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: { id: id, action: action },
                        success: function (response) {
                            if (response == "Success") {
                                swal("Approved successfully!", { icon: "success" })
                                    .then((value) => {
                                        location.reload();
                                    });
                            }
                            else {
                                swal(response);
                            }
                        },
                        error: function (xhr) {
                            swal(error);
                            $("#divLoader").hide();
                        },
                    });
                } else {
                    swal("Cancelled", "No change was made");
                }
            });
        };


    </script>
}


