@model IFMIS.Areas.IFMISTZ.Models.CreateDummySalaryVM

@{
    ViewBag.Title = "Create";
}


<div id="content" style="margin: 5px; padding-top: 50px">
    <div class="row">
        <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
        </div>
    </div>
    <section id="widget-grid" class="">
        <div class="row">
            <article class="col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2> Create Dummy</h2>
                    </header>
                    <div>
                        <div class="jarviswidget-editbox">
                        </div>
                        <iv class="widget-body">
                            <form method="post" class="form-horizontal" id="proformaForm" enctype="multipart/form-data">
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="form-group">
                                    @Html.LabelFor(model => model.VoteCode, "Vote Code", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                        @Html.EditorFor(model => model.VoteCode, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.VoteCode, "", new { @class = "text-danger" })
                                    </div>
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.VoteName, "Vote Name", htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-3">
                                            @Html.EditorFor(model => model.VoteName, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.VoteName, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(model => model.InstitutionAccount, "Institution Account", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                        @Html.EditorFor(model => model.InstitutionAccount, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.InstitutionAccount, "", new { @class = "text-danger" })
                                    </div>
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.NetAmount, "Amount", htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-3">
                                            @Html.EditorFor(model => model.NetAmount, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.NetAmount, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(model => model.SubBudgetClass, "Sub Budget Class", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                        @*@Html.EditorFor(model => model.SubBudgetClass, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.SubBudgetClass, "", new { @class = "text-danger" })*@
                                        <select id="SubBudgetClass" style="width:300px">
                                            <option value="Please choose sub budget class" selected="selected">Please choose sub budget class</option>
                                            @foreach (var subBudgetClass in ViewBag.subBudgetClassList)
                                            {
                                                <option value='@subBudgetClass.SubBudgetClass;
                                                              @subBudgetClass.OperationalCurrencyCode;
                                                              @subBudgetClass.OperationalExchangeRate;
                                                              @subBudgetClass.BaseCurrencyCode'>
                                                    @subBudgetClass.SubBudgetClassSubBudgetClassDesc
                                                </option>}
                                        </select>

                                    </div>
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.ReferenceNo, "Reference No", htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-3">
                                            @Html.EditorFor(model => model.ReferenceNo, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.ReferenceNo, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(model => model.PaymentCategory, "Payment Category", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                        @Html.DropDownList("FundingSource",
                                                     new SelectList(new List<SelectListItem> {
                                                     new SelectListItem { Text = "Net Salay", Value = "Net"},
                                                     new SelectListItem { Text = "At Source Deduction", Value = "Deductions"},
                                                     new SelectListItem { Text = "Unpaid Salary", Value = "Unpaid"},
                                                     new SelectListItem { Text = "RAS Transfer", Value = "RAS"}
                                                                        }, "Value", "Text"),
                                                     "--Select Type--", new { @class = "form-control" })
                                    </div>
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.GL, "GL", htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-3">
                                            <a class="search-btn" onclick="SearchGl()" href="#" style="display:block;width:300px">
                                                    <i class="fa fa-search search-icon"></i>
                                                    Search...
                                                </a>
                                            @Html.ValidationMessageFor(model => model.GL, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                            Description
                                            <i class="fa fa-times" style="color:white" id="Description_1" maxlength="250"></i><br />
                                            (Remained characters: <i id="maxchars_c">250</i>)
                                        <div>
                                            <textarea rows="2" id="Description" style="width:300px;"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group" id="ApplyDate">
                                        @Html.LabelFor(model => model.ApplyDate, "Apply Date", htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-3">
                                            @Html.EditorFor(model => model.ApplyDate, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.ApplyDate, "", new { @class = "text-danger" })
                                        </div>
                                        </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <input type="submit" value="Save" class="btn btn-info" />
                                    </div>
                                </div>
                            </form>
                    </div>

                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
                <!-- end widget -->
            </article>
            <!-- END COL -->
            <!-- END ROW -->
        </div>
    </section>
    <!-- end widget grid -->
</div>

<div class="modal fade" id="glItemsModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Search Gl Item</h3>
            </div>
            <div class="modal-body">
                <table>
                    <tr>
                        <td style="padding:5px">Total Voucher Amount</td>
                        <td style="padding:5px">
                            <input type="text" disabled id="total_voucher_amount2">
                        </td>

                        <td style="padding:5px">Total Line Amount</td>
                        <td style="padding:5px">
                            <input value="0" type="text" disabled id="total_line_amount">
                        </td>

                        <td style="padding:5px">Difference</td>
                        <td style="padding:5px">
                            <input value="0" type="text" disabled id="difference" style="width:250px">
                        </td>
                    </tr>
                </table>
                <div>
                    <div class="row-align" style="padding-top:1%;padding-bottom:1%">
                        @*<div class="col-md-6">
                        </div>*@
                        <div>
                            Currency: <strong class="currency"></strong>
                        </div>
                        <div class="col-md-6">
                            <div class="search-container submit-btn" style="float:right">
                                <i class="fa fa-search search-icon"></i>
                                <input type="search" name="search" placeholder="Search..." id="searchbox2">
                            </div>
                        </div>
                    </div>
                    <table id="dt_search_gl_item" class="table table-striped table-bordered table-hover table-condensed" width="100%">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Expenditure Line Item</th>
                                <th>Item Description</th>
                                <th>Fund Balance</th>
                                <th>Funding Reference</th>
                                <th>Expense Amount</th>
                            </tr>
                        </thead>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" id="btn_save_gl_items">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button class="btn btn-info" data-dismiss="modal">
                        <i class="fa  fa-times"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@section pagespecific{
    <script>
$("#Description").on("keyup", function (e) {
        $("#maxchars_c").text(250 - this.value.length)

        if (this.value.length>250) {
            swal("Maximum Characters reached!");
        }
});
$(function () {
    $('#ApplyDate').val(new Date().toDateInputValue());
    
});
        //---SEARCH GL----//

var dt_search_gl_item = $('#dt_search_gl_item').dataTable();

$("#searchbox2").on("keyup search input paste cut", function () {
    dt_search_gl_item.DataTable().search(this.value).draw();
});
var SubBudgetClassOld = $("#SubBudgetClass").val();

$("#SubBudgetClass").change(function () {

    var _data = dt_voucher_detail.DataTable().rows().data();
    if (_data.length > 0) {
        confirmSubBudgetClassChange(SubBudgetClassOld, $(this).val());
    } else {
        updateSearchGITable($(this).val());
    }
    SubBudgetClassOld = $(this).val();
});

function updateSearchGITable(subBudgetClassList) {
    subBudgetClassList = subBudgetClassList.split(";");
    var subBudgetClass = subBudgetClassList[0].trim();
    var url = '@Url.Action("GetFundbalance", "PaymentVoucher")';
    var fundBalanceParams = { "subBudgetClass": subBudgetClass };

    $(".currency").text(subBudgetClassList[1].trim());

    $.ajax({
        type: "post",
        url: url,
        data: fundBalanceParams,
        contenttype: "application/json; charset=utf-8",
        datatype: "json",
        success: function (response) {
            //=== UPDATE SEARCH GI TABLE ====
            data = response.data;
            dt_search_gl_item.fnClearTable();
            for (var i = 0; i < data.length; i++) {
                dt_search_gl_item.fnAddData([i + 1,
                    data[i]["GlAccount"].split("|").join("-"),
                    data[i]["GlAccountDesc"],
                    data[i]["FundBalance"],
                    data[i]["FundingRefNo"],
                    '<amount-input placeholder="Amount" id="Id-' + i + '" onkeyup="amountChanged(' + i + ')" />'
                    //'<input type="number" placeholder="Amount" id="Id-' + i + '" onkeyup="amountChanged(' + i + ')"/>'

                ]);
            }
        },
        failure: function (error) {
            swal(error);
        }
    });
}

var TotalAmountOld = $("#total_voucher_amount").val().split(",").join("");
function clearVochaDetailsTable() {
    var _data = dt_voucher_detail.DataTable().rows().data();

    if (_data.length > 0) {
        confirmTotalAmountChange(TotalAmountOld, $("#total_voucher_amount").val().split(",").join(""));
    }
    TotalAmountOld = $("#total_voucher_amount").val().split(",").join("");
}

function resetVochaDetailsTable() {
    $("#total_amount").text("0.00");
    dt_voucher_detail.fnClearTable();
}

function SearchGl() {
    if (voucherSummaryFormValidation()) {
        $('#glItemsModal').modal('show');
        $('#total_voucher_amount2').val($("#total_voucher_amount").val());
        computeTotalAmount();
    } else {
        swal("Please provide the missing details.!");
    }
}
    </script>
}