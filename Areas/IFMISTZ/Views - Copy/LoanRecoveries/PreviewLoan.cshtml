@model IFMIS.Areas.IFMISTZ.Models.LoanRecoveryVM
@{
    ViewBag.Title = "Preview Loan Recovery";
    decimal? amount, amountt = 0;
    decimal? amount2, amountt2 = 0;
    decimal? total, total2 = 0;
}
<style type="text/css">
    .loadingImg {
        display: none;
    }
</style>
<!-- MAIN CONTENT -->

<div id="content" style="margin: 5px; padding-top: 30px">

    <div class="row">


    </div>



    <!-- widget grid -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2> Loan Recovery Information</h2>

                    </header>
                    <div class="jarviswidget" id="wid-id-12" data-widget-colorbutton="false" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false">
                        @*<div align="center">
                                <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                            </div>*@
                        <table class="table  table-hover table-condensed">

                            <tbody>
                                <tr>
                                    <td style="width:20%">
                                        Loan Number
                                    </td>
                                    <td>
                                        <strong>@Html.DisplayFor(model => model.LoanCode)</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Description
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.LoanDescription)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Payee Name
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.CustomerName)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Payee Code
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.CustomerCode)
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:20%">
                                        Recovery Status
                                    </td>
                                    <td>
                                        @if (Model.RecoveryStatus == null)
                                        {
                                            <p>Partial</p>
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(model => model.RecoveryStatus)
                                        }


                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Financial Year
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.FinancialYear)
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:20%">
                                        Loan Amount
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.AmountDue)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Monthly Deducted Amount
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.MonthlyDeduction)
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:20%">
                                        Recovery Amount
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.TotalDeductedAmount)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Remaining Amount
                                    </td>
                                    <td>
                                        @{
                                            amountt = Model.AmountDue;
                                            amountt2 = Model.TotalDeductedAmount;
                                            total2 = amountt - amountt2;
                                        }
                                        @string.Format("{0:#,0.00}", total2)
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:20%">
                                        Interest rate
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.InterestRate)
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:20%">
                                        Recovery Period in Months
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.RecoveryPeriod)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%">
                                        Payee Type
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.PayeeType)
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <span>Attachments</span>
                        <table class="table  table-bordered table-hover table-condensed" id="dt_loanattachment">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Attachment</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.LoanRecoveryAttachment != null)
                                {
                                    int n = 0;
                                    foreach (var attach in ViewBag.LoanRecoveryAttachment)
                                    {
                                        n++;
                                        <tr>
                                            <td>@n</td>
                                            <td>@attach.Title</td>
                                            <td>@attach.Description</td>
                                            <td> <a href="@Url.Action("LoanAttachmentView", "PrePayment", new { Filename = attach.FileName, PathName = "uploads" })" target="_blank"><i class="fa fa-file-pdf-o"></i></a></td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>

                        <table class="table  table-bordered table-hover table-condensed" id="dt_loanattachment">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Recovery date</th>
                                    <th>Principal Amount</th>
                                    <th>Interest Amount</th>
                                    <th>Received Amount</th>
                                    <th>Status</th>
                                    <th>Remark</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.summary != null)
                                {
                                    int i = 0;
                                    foreach (var item in ViewBag.summary)
                                    {
                                        i++;
                                        <tr>
                                            <td>@i</td>
                                            <td>@item.RecoveryDate.ToString("MM/dd/yyyy")</td>
                                            <td align='right'> @string.Format("{0:#,0.00}", item.MonthlyRecoveryAmtPrincipal)</td>
                                            <td>@item.MonthlyRecoveryAmtInterest</td>
                                            <td align='right'>
                                                @{
                                                    amount = item.MonthlyRecoveryAmtPrincipal;
                                                    amount2 = item.MonthlyRecoveryAmtInterest;
                                                    total = amount + amount2;
                                                }
                                                @string.Format("{0:#,0.00}", total)
                                            </td>
                                            <td>@item.OverAllStatus</td>
                                            <td>
                                                @if (item.Remarks != null && (item.OverAllStatus == IFMIS.Libraries.Constants.REJECTED || item.OverAllStatus == IFMIS.Libraries.Constants.CANCELLED))
                                                {
                                                    @item.Remarks
                                                }

                                            </td>
                                        </tr>
                                                        }
                                                    }

                            </tbody>
                        </table>

                        <a class="btn btn-info" href='#' onclick="history.go(-1); return false;" style="margin-right:5px">
                            <i class="glyphicon glyphicon-arrow-left"></i>Back
                        </a>

                    </div>

                </div>
            </article>

        </div>
    </section>

</div>

@section pagespecific {
    <!-- PAGE RELATED PLUGIN(S) -->

    <script type="text/javascript">
                        //SHOW LOADER ICON
                        $(document).ajaxStart(function () {
                            $(".loadingImg").show();

                        });
                        //HIDE LOADER ICON
                        $(document).ajaxStop(function () {
                            $(".loadingImg").hide();
                        });

                        /* BASIC ;*/
                        var responsiveHelper_dt_loanattachment = undefined;
                        var responsiveHelper_datatable_fixed_column = undefined;
                        var responsiveHelper_datatable_col_reorder = undefined;
                        var responsiveHelper_datatable_tabletools = undefined;

                        var breakpointDefinition = {
                            tablet: 1024,
                            phone: 480
                        };

                        $('#dt_loanattachment').dataTable({
                            "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-12 hidden-xs'l>r>" +
                                "t" +
                                "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                            "autoWidth": true,
                            "preDrawCallback": function () {
                                // Initialize the responsive datatables helper once.
                                if (!responsiveHelper_dt_loanattachment) {
                                    responsiveHelper_dt_loanattachment = new ResponsiveDatatablesHelper($('#dt_loanattachment'), breakpointDefinition);
                                }
                            },
                            "rowCallback": function (nRow) {
                                responsiveHelper_dt_loanattachment.createExpandIcon(nRow);
                            },
                            "drawCallback": function (oSettings) {
                                responsiveHelper_dt_loanattachment.respond();
                            }
                        });

                        /* END BASIC *?
    </script>
}


