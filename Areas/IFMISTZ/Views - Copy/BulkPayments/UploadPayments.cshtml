@model IFMIS.Areas.IFMISTZ.Models.UploadPaymentsVM
@{
    ViewBag.Title = "Upload Payment";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div style="padding:1em;padding-top:4em">
    <section id="widget-grid">
        <div class="row">
            <article class="col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget " id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                        <h2>Import Upload Payment</h2>
                    </header>
                    <div class="widget-body " style="padding-top:10px">
                        <div class="panel-body">
                            @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", id = "paymentForm" }))
                            {
                                @Html.AntiForgeryToken()
                            <div class="form-horizontal">
                                @Html.HiddenFor(model => model.PaymentBatchId)
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="row" style="padding:12px">
                                    @Html.LabelFor(model => model.PaymentBatchId, htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-4">
                                        @*@Html.DropDownListFor(model => model.PaymentBatchId, Model.PaymentBatches, "Select Payment Batch", new { @class = "form-control" })*@
                                        @Html.DropDownList("PaymentBatchID", null, htmlAttributes: new { @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.PaymentBatchId, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="row" style="padding:12px">
                                    @Html.LabelFor(model => model.FileName, htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-4">
                                        @Html.TextBoxFor(model => model.FileName, new { type = "file", @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.FileName, "", new { @class = "text-danger" })
                                    </div>
                                </div>


                                <!-- Start of div loader-->
                                <div align="center" id="divLoader" style="text-align: center; display: none">
                                    <img src="~/Media/Images/loader.gif" width="100" height="100" />
                                </div>
                                <!-- End of div loader-->

                                <br />
                                <br />
                                <table>
                                    <tr>
                                        <td class="form-label">
                                            Bulky Payment Template
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <a href="~/Media/Templates/BulkyPaymentTemplate/BulkyPayment template.xlsx"><i class="glyphicon glyphicon-download-alt"></i>Download</a>
                                        </td>
                                    </tr>
                                </table>
                                <br />
                                <table>
                                    <tr>
                                        <td class="form-label">
                                            Bulky Payment Template with Sample Data
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <a href="~/Media/Templates/BulkyPaymentTemplate/BulkyPayment Template with Sample Data.xlsx"><i class="glyphicon glyphicon-download-alt"></i>Download</a>
                                        </td>
                                    </tr>
                                </table>
                                <div class="form-actions">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-3">
                                            <a href="@Url.Action("PaymentBatchList","PaymentBatches")" class="btn btn-info">
                                                <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                                                Back
                                            </a>

                                            <button type="button" class="btn btn-info" style="text-align:left" onclick="upload()">
                                                <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
                                                Upload
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            }

                        </div>
                    </div>

                </div>
              
            </article>
        </div>
    </section>
</div>


@section pagespecific{
    <script>
       
           function uploadPayments() {

               if (window.FormData !== undefined) {
                if (!$("#paymentForm").valid()) {
                    return false;
                }

                var data = new FormData();
                var file = $("#FileName").get(0).files;

                if (file.length > 0) {
                    data.append("PaymentBatchId", $("#PaymentBatchId").val());
                    data.append("FileName", file[0]);
                }

                var url = '@Url.Action("UploadPaymentData", "BulkPayments")';
             
                $("#divLoader").show();
                   $.ajax({
                       url: url,
                       type: "POST",
                       processData: false,
                       contentType: false,
                       data: data,
                       success: function (response) {
                   
                           if (response == "Success") {
                               $("#divLoader").hide();
                               swal("Uploaded Successfully!", { icon: "success" }).then((e) => {
                                   window.location.href = '@Url.Action("PaymentBatchlist", "PaymentBatches")';
                               });
                           }
                           else {
                               $("#divLoader").hide();
                               swal(response, { icon: "warning" }).then((e) => {
                               });
                           };

                       },
                       error: function (err) {
                           console.log(err);
                           swal(err.statusText)
                           $("#saveLoader").toggle(false);
                       }
                   });
            };
        };

  


        function upload() {

            swal({
                title: "Upload",
                text: "Are you sure you want to Upload the Payments? ",
                buttons: [
                  'Yes',
                  'No'
                ],
                closeOnClickOutside: false,
            }).then(function (isConfirm) {
                if (isConfirm) {
                    swal("Cancelled", "No change was made");
                } else {

                    uploadPayments();
                }
            });
            $('#confirmModal').modal('hide');

        }


    </script>
}

