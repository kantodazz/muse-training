
@model GEFTP.Models.Payroll

@{
    ViewBag.Title = "Run Payroll";
}

<div id="content">
    <div class="panel panel-default">
        <div class="panel-heading">Run Payroll</div>
        <div class="panel-body">
            <div class="form-horizontal">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="button" value="Update" class="btn btn-default" onclick="runPayroll()" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="divLoader" style="text-align: center; display: none">
                <img src="~/Media/Images/ajax_loader.gif" />
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>

        var runPayroll = function () {

            if (window.FormData !== undefined) {

                debugger

                var data = new FormData();
                // var file = $("#FileName").get(0).files;

                // if (file.length > 0) {
                data.append("CURRENT_MONTH", $("#CURRENT_MONTH").val());
                //data.append("FileName", file[0]);
                // }

                var url = '@Url.Action("RunPayroll", "Payrolls")';

                if (!$("#paymentForm").valid()) {
                    return false;
                }

                $("#divLoader").show();

                $.ajax({
                    url: url,
                    type: "post",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                        if (response == "Success") {
                            alert("Successfully updated!");
                            $("#divLoader").hide();
                            window.location = '@Url.Action("Index")';
                        } else if (response == "InvalidFormat") {
                            alert("Invalid file format, file format should be MS Excel!");
                            $("#divLoader").hide();
                            location.reload();
                        } else if (response == "InvalidSize") {
                            alert("Invalid file size, file size should be less than 2MB!");
                            $("#divLoader").hide();
                            location.reload();
                        }
                        else {
                            alert("Unknown error, contact system admin!");
                            $("#divLoader").hide();
                            location.reload();
                        };
                    },
                    error: function (response) {
                        alert(response);
                        $("#divLoader").hide();
                        location.reload();
                    }
                });
            };
        };

    </script>
}





