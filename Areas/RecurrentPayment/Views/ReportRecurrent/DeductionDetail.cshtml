@model IEnumerable<IFMIS.Areas.RecurrentPayment.Models.DeductionDetail>

@{
    ViewBag.Title = "";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    tr:nth-of-type(odd) {
        background-color: #f5f5f5;
    }

    table {
        border-collapse: separate;
        border-spacing: 0;
        color: #4a4a4d;
        font: 12px/1.4 "Helvetica Neue", Helvetica, Arial, sans-serif;
        width: 100%;
    }

    th,
    td {
        padding: 5px 11px;
        vertical-align: middle;
    }

    td {
        border-bottom: 1px solid #cecfd5;
        border-right: 1px solid #cecfd5;
        width: auto;
    }

        td:first-child {
            border-left: 1px solid #cecfd5;
        }

    thead {
        background: #395870;
        color: #fff;
    }

    tfoot {
        background-color: #b4fabc;
        color: #000000;
    }
</style>


<div id="content">
    <div class="panel panel-default">
        <!-- Default panell contents -->

        <div class="panel-heading">Loan Balance Report</div>
        <div class="panel-body">
            <br />
            @using (Html.BeginForm(null, null, FormMethod.Get))
            {
                <div class="col-xs-6">
                    <div class="input-group">
                        <input type="text" id="searchQuery" name="searchQuery" class="form-control" placeholder="Search..." />
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="submit">
                                <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                            </button>
                        </span>

                    </div><!-- /input-group -->
                </div><!-- /.col-lg-6 -->
                <br /><br />
            }
            <div class="panel-body">
                <table class="table">
                    <tr style="background-color: #395870; color: whitesmoke">

                        @{
                            int i = 0;
                            decimal? totalAmount1 = 0, totalAmount2 = 0, totalLoanAmt = 0;
                        }

                        @foreach (var group in Model.GroupBy(a => a.DedCode))
                        {
                            totalAmount1 = 0;
                            totalAmount2 = 0;
                            totalLoanAmt = 0;
                            i = 0;
                        <tr>
                            <td colspan="8">
                                <b>@group.Key - @Model.Where(a => a.DedCode == group.Key).Select(a => a.DedDescription).FirstOrDefault()</b> &nbsp;&nbsp;
                                <a href="#" onclick="viewriport(@group.Select(a=>a.DedCode).FirstOrDefault())">
                                    Preview Report
                                    <span class="glyphicon glyphicon-print"></span>
                                </a>
                                &nbsp;&nbsp;
                            </td>
                        </tr>

                        <tr style="background-color: #395870; color: whitesmoke">
                            <th style="text-align: center">
                                #
                            </th>
                            <th>Check No</th>
                            <th>Full Name</th>
                            <th style="text-align:right">Loan Amount</th>
                            <th style="text-align:right">Deduction Amount</th>
                            <th style="text-align:right">Current Balance Amount</th>
                            <th>Check Date</th>
                        </tr>

                        foreach (var item in group)
                        {
                            i++;
                            totalAmount1 += item.DeductionAmount;
                            totalAmount2 += item.CurrentMonthBalanceAmount;
                            totalLoanAmt += item.LoanAmount;

                            <tr>
                                <td>@i</td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.BeneficiaryCode)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.BeneficiaryName)
                                </td>
                                <td style="text-align: right">
                                    @Html.DisplayFor(modelItem => item.LoanAmount)
                                </td>
                                <td style="text-align: right">
                                    @Html.DisplayFor(modelItem => item.DeductionAmount)
                                </td>
                                <td style="text-align: right">
                                    @Html.DisplayFor(modelItem => item.CurrentMonthBalanceAmount)
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.CheckDate)</td>
                            </tr>
                        }

                        <tr style="background-color:#F5F5F5">
                            <td></td>
                            <td></td>
                            <td style="text-align: left">Sub Total Amount</td>
                            <td style="text-align: right"><b>@string.Format("{0:#,0.00}", totalLoanAmt)</b></td>
                            <td style="text-align: right"><b>@string.Format("{0:#,0.00}", totalAmount1)</b></td>
                            <td style="text-align: right"><b>@string.Format("{0:#,0.00}", totalAmount2)</b></td>
                            <td></td>
                        </tr>
                    }
                    </table>
                </div>
            </div>
        </div>
    </div>
