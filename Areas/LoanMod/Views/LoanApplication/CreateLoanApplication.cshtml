@model IFMIS.Areas.LoanMod.Models.LoanApplicationVM
@{
    ViewBag.Title = "Loan Application";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    body {
        margin-top: 40px;
    }

    .stepwizard-step p {
        margin-top: 10px;
    }

    .stepwizard-row {
        display: table-row;
    }

    .stepwizard {
        display: table;
        width: 100%;
        position: relative;
    }

    .stepwizard-step button[disabled] {
        opacity: 1 !important;
        filter: alpha(opacity=100) !important;
    }

    .stepwizard-row:before {
        top: 14px;
        bottom: 0;
        position: absolute;
        content: " ";
        width: 100%;
        height: 1px;
        background-color: #ccc;
        z-order: 0;
    }

    .stepwizard-step {
        display: table-cell;
        text-align: center;
        position: relative;
    }

    .loadingImg {
        display: none;
    }

    .search-btn {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 5px;
        padding-right: 10px;
    }

    .search-container {
        display: inline-flex;
        flex: 1 1 300px;
        position: relative;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
        padding-left: 10px;
    }

    .name-input-container {
        display: inline-flex;
        flex: 1 1 300px;
        position: relative;
        overflow: hidden;
    }

    .search-icon {
        padding: 0.5rem;
    }

    .search-button {
        background: #538AC5;
        border: 0;
        color: white;
        padding: 8px;
        border-radius: 0;
    }

    input[type=number] {
        padding: 8px;
        border: 1px solid #ccc;
        width: 205px;
    }

    input[type=text] {
        padding: 5px;
        border: 1px solid #ccc;
    }

    input[type=search] {
        padding: 4px;
        border: hidden;
        border-radius: 4px;
    }

    textarea {
        border: 1px solid #ccc;
    }

    select {
        padding: 8px;
        border: 1px solid #ccc;
        resize: vertical;
        width: 230px;
    }

    .action-btn {
        width: 100px;
        color: white;
    }

    .form-label {
        text-align: right;
    }

    td {
        padding: 5px;
    }

    .info-box {
        padding: 10px;
        background-color: #ECF3F8;
        text-align: center;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    #itemUL li {
        margin-left: -40px;
        border-bottom: 1px solid silver;
        height: 26px;
        padding-left: 5px;
        padding-top: 8px;
        cursor: pointer;
    }
    .redStar{
        color:red;
        font-size:15px;
    }

 .myContentx {display:none;}
 .overlayx { 
    width:500px;
    height: 500px;
    position: fixed;
    top: 200px;
    left: 200px;
}
</style>
<div id="content" class="myContent" style="margin: 5px; padding-top: 30px">
    @*<div class="overlay">
        <img src="~/Media/Images/ajax_loader.gif" class="overlay"/>
    </div>*@
    <div class="row"></div>
    <!-- widget grid -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2>@ViewBag.Title </h2>

                    </header>

                    <div>
                        <div class="widget-body " style="padding-top:10px;width:100%">

                            <!----WIZARD HEADING -->

                            <div class="stepwizard">
                                <div class="stepwizard-row setup-panel">
                                    <div class="stepwizard-step">
                                        <a href="#step-1" type="button" class="btn btn-primary btn-circle" >1</a>
                                        <p><strong>Applicant Information </strong></p>
                                    </div>

                                    <div class="stepwizard-step">
                                        @*<a href="#step-2" type="button" class="btn btn-default btn-circle" disabled="disabled">2</a>*@
                                        <a href="#step-2" type="button" class="btn btn-default btn-circle">2</a>
                                        <p><strong>Loan Information</strong></p>
                                    </div>

                                    <div class="stepwizard-step">
                                        <a href="#step-3" type="button" class="btn btn-default btn-circle">3</a>
                                        <p><strong>Collateral Information</strong></p>
                                    </div>
                                    <div class="stepwizard-step">
                                        <a href="#step-4" type="button" class="btn btn-default btn-circle">4</a>
                                        <p><strong>Attachments</strong></p>
                                    </div>
                                </div>
                            </div>
                            <br />
                            <br />
                            @*--------------------BEGINNING OF STEP ONE-------------------------*@
                            <div class="form-horizontal">
                                <div class="row setup-content" id="step-1">
                                    <div class="col-xs-12">
                                        <div align="center">
                                            <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                        </div>
                                        <div class="col-md-12">
                                        
                                            @Html.AntiForgeryToken()
                                            @if (ViewBag.LoanApplicationId != 0)
                                            {
                                                <input type="hidden" name="LoanApplicationId" value="@ViewBag.LoanApplicationId" id="LoanApplicationId" />
                                            }
                                            <input type="hidden" name="Customers" id="Customers" />
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Customer Type<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @if(ViewBag.LoanApplicationId != 0) {
                                                    <select id="customerTypeId" disabled  class="form-control select2">
                                                        @foreach (var customerType in ViewBag.CustomerTypeList)
                                                        {
                                                            if (ViewBag.CustomerTypeLabel == customerType.Label)
                                                            {
                                                                <option value='@customerType.Label' selected>@customerType.CustomerName</option>
                                                            }
                                                            else
                                                            {
                                                                <option value='@customerType.CustomerTypeId'>
                                                                    @customerType.CustomerName
                                                                </option>
                                                            }
                                                        }
                                                    </select>
                                                    }else{
                                                    <select name="CustomerTypeId" id="customerTypeId" required  onchange="CustomerTypeChange()" class="form-control select2">
                                                        @if (ViewBag.CustomerTypeList != null)
                                                        {
                                                            <option>Select Customer Type</option>
                                                            foreach (var customerType in ViewBag.CustomerTypeList)
                                                            {
                                                                <option value='@customerType.Label'>@customerType.CustomerName</option>
                                                            }
                                                        }
                                                        }

                                                    </select>
                                                    }

                                                </div>

                                            </div>
                                            
                                        </div>
                                    </div>
                                    <div class="col-xs-12">

                                        @*BEGINNING OF APPLICANT INFORMATION*@
                                        <div class="col-md-12 applicationInfo">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Fullname<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.CustomerName, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Gender<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.DropDownList("Gender", new List<SelectListItem>{
                                                            new SelectListItem{ Text="Select Gender", Value = "" },
                                                            new SelectListItem{ Text="Male", Value = "Male" },
                                                            new SelectListItem{ Text="Female", Value = "Female" },
                                                   }, new { @class = "form-control select2", @required = "required", id = "Gender", style = "width:100%;" })

                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Principal Activity<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextArea("Occupation", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:100%;" })
                                                </div>
                                                <label class="control-label col-md-2">Date Of Birth<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                @if (ViewBag.LoanApplicationId != 0)
                                                                {

                                                                    @Convert.ToDateTime(ViewBag.DateOfBirth).ToString("dd/MM/yyyy")
                                                                    <div class="flatpickr date-group">
                                                                        <input type="text" placeholder="Select Date.."
                                                                               data-input
                                                                               style="width:100px;border:none"
                                                                               autocomplete="off" name="DateOfBirth"  id="DateOfBirth">
                                                                        <a class="input-button" title="open" data-toggle href="#">
                                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                        </a>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                <div class="flatpickr date-group">
                                                                    <input type="text" placeholder="Select Date.."
                                                                           data-input
                                                                           style="width:100px;border:none"
                                                                           autocomplete="off" name="DateOfBirth" id="DateOfBirth">
                                                                    <a class="input-button" title="open" data-toggle href="#">
                                                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                    </a>
                                                                </div>
                                                                }
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Physical Address<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                 @Html.TextBoxFor(model => model.PhysicalAddress, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Phone Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.PhoneNo, new { @Class = "input", @required = "required", style = "width:100%; ", type = "number", min = "0" })
                                                </div>

                                            </div>


                                            <div class="form-group">
                                                <label class="control-label col-md-2">Fax</label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.Fax, new { @Class = "input", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Plot No<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.PlotNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Customer ID Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.DropDownList("CategoryNo", new List<SelectListItem>{
                                                        new SelectListItem{ Text="Select Customer ID", Value = "" },
                                                        new SelectListItem{ Text="Tin Number", Value = "TinNo" },
                                                        new SelectListItem{ Text="Check Number", Value = "CheckNo" },
                                                        new SelectListItem{ Text="National ID Number", Value = "NationalIDNo" },
                                                   }, new { @class = "form-control select2", @required = "required", id = "CategoryNo", style = "width:100%;" })
                                                </div>
                                            </div>
                                            
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Customer Number<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.TinNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Email</label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.Email, new { @Class = "input", style = "width:100%; " })
                                                    </div>

                                                </div>


                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Project Location<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.Location, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                    <label class="control-label col-md-2">Region of Project<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.RegionId != null)
                                                        {
                                                            <select id="RegionId" class="form-control select2">
                                                                @foreach (var region in ViewBag.PreviewRegionList)
                                                                {
                                                                    if (ViewBag.RegionId == region.RegionId)
                                                                    {
                                                                        <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@region.RegionId'>
                                                                            @region.RegionName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("RegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }
                                                    </div>

                                                </div>


                                                <div class="form-group">
                                                    
                                                    <label class="control-label col-md-2">District of Project<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.DistrictId != null)
                                                        {
                                                            <select id="DistrictId" class="form-control select2">
                                                                @foreach (var district in ViewBag.PreviewDistrictList)
                                                                {
                                                                    if (ViewBag.DistrictId == district.DistrictId)
                                                                    {
                                                                        <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@district.DistrictId'>
                                                                            @district.DistrictName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("DistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }

                                                    </div>
                                                    <label class="control-label col-md-2">Ward of Project<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("WardId", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                    </div>

                                                </div>


                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Village /Street<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.Village, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Hamlet<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.Hamlet, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Applicant Photo<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.PhotoUrl, new { @Class = "input", type = "file", style = "width:100%; " })
                                                        @if (ViewBag.LoanApplicationId != 0)
                                                        {
                                                            <a href="#" data-toggle="modal" data-target="#ApplicantPhoto" class="btn-xs edit">View Applicant Photo</a>
                                                        }
                                                    </div>
                                                    <label class="control-label col-md-2 titleAttachment">Affidavit<span class="redStar">*</span></label>
                                                    <div class="col-md-3 titleAttachment">
                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.MaritalStatus != "Married" && ViewBag.IndividualAttachmentUrl != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.IndividualAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".IndividualAttachmentUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.IndividualAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }
                                                    </div>

                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Marital Status<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @*@if (ViewBag.LoanApplicationId != 0)
                                                        {
                                                            @Html.DropDownList("MaritalStatus", new List<SelectListItem>{
                                                            new SelectListItem{ Text="Select Marital Status", Value = "" },
                                                            new SelectListItem{ Text="Single", Value = "Single" },
                                                            new SelectListItem{ Text="Married", Value = "Married" },
                                                            new SelectListItem{ Text="Divorce", Value = "Divorce" },
                                                            new SelectListItem{ Text="Widow", Value = "Widow" },
                                                            new SelectListItem{ Text="Widower", Value = "Widower" },
                                                             }, new { @class = "form-control select2", @disabled = "disabled", @required = "required", id = "MaritalStatus", onchange = "maritalStatusChange()", style = "width:100%;" })
                                                        }

                                                        @if (ViewBag.LoanApplicationId == 0)
                                                        {*@
                                                            @Html.DropDownList("MaritalStatus", new List<SelectListItem>{
                                                            new SelectListItem{ Text="Select Marital Status", Value = "" },
                                                            new SelectListItem{ Text="Single", Value = "Single" },
                                                            new SelectListItem{ Text="Married", Value = "Married" },
                                                            new SelectListItem{ Text="Divorce", Value = "Divorce" },
                                                             new SelectListItem{ Text="Widow", Value = "Widow" },
                                                            new SelectListItem{ Text="Widower", Value = "Widower" },
                                                             }, new { @class = "form-control select2", @required = "required", id = "MaritalStatus", onchange = "maritalStatusChange()", style = "width:100%;" })
                                                            @*}*@

                                                    </div>

                                                </div>


                                            </div>
                                        @* END OF APPLICANT INFORMATION*@

                                        @* BEGINNING OF SPOUSE INFORMATION *@

                                        <div class="col-md-12 spouseInfo">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Spouse Full Name<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpouseName, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Spouse Principal Activity<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextArea("SpouseOccupation", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:100%;" })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Spouse Date Of Birth<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    <table>
                                                        <tr>
                                                            <td>

                                                                @if (ViewBag.LoanApplicationId != 0)
                                                                {

                                                                    @Convert.ToDateTime(ViewBag.SpouseDateOfBirth).ToString("dd/MM/yyyy")
                                                                    <div class="flatpickr date-group">
                                                                        <input type="text" placeholder="Select Date.."
                                                                               data-input
                                                                               style="width:100px;border:none"
                                                                               autocomplete="off" name="SpouseDateOfBirth" id="SpouseDateOfBirth">
                                                                        <a class="input-button" title="open" data-toggle href="#">
                                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                        </a>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <div class="flatpickr date-group">
                                                                        <input type="text" placeholder="Select Date.."
                                                                               data-input
                                                                               style="width:100px;border:none"
                                                                               autocomplete="off" name="SpouseDateOfBirth" id="SpouseDateOfBirth">
                                                                        <a class="input-button" title="open" data-toggle href="#">
                                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                        </a>
                                                                    </div>
                                                                }

                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <label class="control-label col-md-2">Spouse Physical Address<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpousePhysicalAddress, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Spouse Phone Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpousePhoneNumber, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                @*<label class="control-label col-md-2">Spouse Fax</label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpouseFax, new { @Class = "input", style = "width:100%; " })
                                                </div>*@
                                                <label class="control-label col-md-2">Spouse Plot No<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpousePlotNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                            </div>


                                            <div class="form-group">
                                                
                                                <label class="control-label col-md-2">Spouse Location<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpouseLocation, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Spouse Email</label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.SpouseEmail, new { @Class = "input", style = "width:100%; " })
                                                </div>
                                            </div>

                                            <div class="form-group">
                                               
                                                <label class="control-label col-md-2">Spouse Photo<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @*@Html.TextBoxFor(model => model.SpousePhotoUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })*@
                                                    @if (ViewBag.LoanApplicationId != 0)
                                                    {
                                                        @Html.TextBoxFor(model => model.SpousePhotoUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        <a href="#" data-toggle="modal" data-target="#SpousePhoto" class="btn-xs edit">View Spouse Photo</a>
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.SpousePhotoUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                    }
                                                </div>

                                            </div>

                                        </div>
                                        @* END OF SPOUSE INFORMATION *@

                                        @*BEGINNING OF INSTITUTION INFORMATION*@
                                        <div class="col-md-12 institutionInfo">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Fullname<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationFullname, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Registration Date<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                @if (ViewBag.LoanApplicationId != 0)
                                                                {

                                                                    @Convert.ToDateTime(ViewBag.OrganisationRegistrationDate).ToString("dd/MM/yyyy")
                                                                    <div class="flatpickr date-group">
                                                                        <input type="text" placeholder="Select Date.."
                                                                               data-input
                                                                               style="width:100px;border:none"
                                                                               autocomplete="off" name="OrganisationRegistrationDate" id="OrganisationRegistrationDate">
                                                                        <a class="input-button" title="open" data-toggle href="#">
                                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                        </a>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <div class="flatpickr date-group">
                                                                        <input type="text" placeholder="Select Date.."
                                                                               data-input
                                                                               style="width:100px;border:none"
                                                                               autocomplete="off" name="OrganisationRegistrationDate" id="OrganisationRegistrationDate">
                                                                        <a class="input-button" title="open" data-toggle href="#">
                                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                        </a>
                                                                    </div>
                                                                }
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Physical Address<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationPhysicalAddress, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Location<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationLocation, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Phone Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationPhoneNumber, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Fax</label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationFax, new { @Class = "input", style = "width:100%; " })
                                                </div>

                                            </div>
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Customer ID Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.DropDownList("OrganisationCategoryNo", new List<SelectListItem>{
                                                        new SelectListItem{ Text="Select Customer ID", Value = "" },
                                                        new SelectListItem{ Text="Tin Number", Value = "TinNo" },
                                                        new SelectListItem{ Text="Check Number", Value = "CheckNo" },
                                                        new SelectListItem{ Text="National ID Number", Value = "NationalIDNo" },
                                                   }, new { @class = "form-control select2", @required = "required", id = "OrganisationCategoryNo", style = "width:100%;" })
                                                </div>
                                                <label class="control-label col-md-2">Customer Number<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationTinNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="control-label col-md-2">Registration No<span class="redStar">*</span> </label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationRegistrationNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                
                                                <label class="control-label col-md-2">Plot No</label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationPlotNo, new { @Class = "input", style = "width:100%; " })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                               
                                                <label class="control-label col-md-2">Registration Certificate<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @if (ViewBag.LoanApplicationId != 0)
                                                    {
                                                        @Html.TextBoxFor(model => model.RegistrationCertificate, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        <a href="#" data-toggle="modal" data-target=".RegistrationCertificate" class="btn-xs edit">View Attachment</a>
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.RegistrationCertificate, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                    }

                                                </div>
                                                <label class="control-label col-md-2">Email </label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationEmail, new { @Class = "input", style = "width:100%; " })
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Place Of Registration<span class="redStar">*</span> </label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.PlaceOfRegistration, new { @Class = "input", style = "width:100%; " })
                                                </div>

                                                <label class="control-label col-md-2">Project Region<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @if (ViewBag.OrganisationRegionId != null)
                                                    {
                                                        <select id="OrganisationRegionId" class="form-control select2">
                                                            @foreach (var region in ViewBag.OrganisationPreviewRegionList)
                                                            {
                                                                if (ViewBag.OrganisationRegionId == region.RegionId)
                                                                {
                                                                    <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                }
                                                                else
                                                                {
                                                                    <option value='@region.RegionId'>
                                                                        @region.RegionName
                                                                    </option>
                                                                }
                                                            }
                                                        </select>
                                                    }
                                                    else
                                                    {
                                                        @Html.DropDownList("OrganisationRegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                    }

                                                </div>

                                            </div>

                                            <div class="form-group">
                                                
                                                <label class="control-label col-md-2">Project District<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @if (ViewBag.OrganisationDistrictId != null)
                                                    {
                                                        <select id="OrganisationDistrictId" class="form-control select2">
                                                            @foreach (var district in ViewBag.OrganisationPreviewDistrictList)
                                                            {
                                                                if (ViewBag.OrganisationDistrictId == district.DistrictId)
                                                                {
                                                                    <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                }
                                                                else
                                                                {
                                                                    <option value='@district.DistrictId'>
                                                                        @district.DistrictName
                                                                    </option>
                                                                }
                                                            }
                                                        </select>
                                                    }
                                                    else
                                                    {
                                                        @Html.DropDownList("OrganisationDistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                    }
                                                </div>
                                                <label class="control-label col-md-2">Project Ward<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.DropDownList("OrganisationWardId", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">Village /Street<span class="redStar">*</span> </label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationVillage, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                                <label class="control-label col-md-2">Hamlet<span class="redStar">*</span></label>
                                                <div class="col-md-3">
                                                    @Html.TextBoxFor(model => model.OrganisationHamlet, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                </div>
                                            </div> 

                                        </div>
                                        @*END OF INSTITUTION INFORMATION*@
                                          @if (ViewBag.LoanApplicationId != 0)
                                          {
                                            <div class="col-md-offset-2 btnSaveBack">
                                                <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                <button type="submit" class="btn btn-info" onclick="saveForm()" id="saveForm">
                                                    <i class="fa fa-save"></i>Update
                                                    <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                </button>
                                            </div>
                                          }
                                          else
                                          {
                                            <div class="col-md-offset-2 btnSaveBack">
                                                <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                <button type="submit" class="btn btn-info" onclick="saveForm()" id="saveForm">
                                                    <i class="fa fa-save"></i>Save
                                                    <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                </button>
                                            </div>
                                          }
                                        
                                    </div>
                                   
                                </div>
                            </div>
                            @*--------------------END OF STEP ONE--------------------*@

                            @*--------------------BEGINNING OF STEP TWO---------------*@
                            <div class="row setup-content" id="step-2">
                                <form>
                                    <div class="form-horizontal">
                                        <div align="center">
                                            <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                        </div>
                                        <div class="col-xs-12">
                                           
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Loan Purpose<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="LoanPurpose_1"></i>(<span style="font-weight:bold;" id="LoanPurposeCount">350</span>)</label>
                                                    <div class="col-md-10">

                                                        @Html.TextArea("LoanPurpose", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;", maxlength = "300" })
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Loan Products<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="LoanProductId_1"></i></label>
                                                    <div class="col-md-3">
                                                       @if (ViewBag.OverAllStatus == IFMIS.Libraries.Constants.INITIAL && ViewBag.LoanApplicationId != 0)
                                                        {
                                                            if (ViewBag.LoanProductId != null)
                                                            {
                                                                <select id="LoanProductId" style="width:300px" class="form-control select2">
                                                                    @foreach (var loanProduct in ViewBag.LoanProductDataList)
                                                                    {
                                                                        if (ViewBag.LoanProductId == loanProduct.LoanProductId)
                                                                        {
                                                                            <option value='@loanProduct.LoanProductId' selected>@loanProduct.ProductName</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value='@loanProduct.LoanProductId'>
                                                                                @loanProduct.ProductName
                                                                            </option>
                                                                        }
                                                                    }
                                                                </select>
                                                           }
                                                           else
                                                           {

                                                            @Html.DropDownList("LoanProductId", ViewBag.LoanProductList as SelectList, "Select Loan Product", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                           }
                                                       }
                                                       else
                                                       {
                                                            @Html.DropDownList("LoanProductId", ViewBag.LoanProductList as SelectList, "Select Loan Product", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                        }

                                                    </div>
                                                    <label class="control-label col-md-2">Loan Sub Products<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="LoanSubProductId_1"></i></label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("LoanSubProductId", ViewBag.LoanSubProductList as SelectList, "Select Loan Sub Product", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                    </div>

                                                </div>

                                                <div class="form-group SubProductQuantity">
                                                    <input type="hidden" name="QuantityData" id="QuantityData" />
                                                    <label class="control-label col-md-2">Quantity<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.Quantity, new { @Class = "input", @required = "required", style = "width:100%; ", type = "number", min = "0" })
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Loan Declaration<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="LoanDeclaration_1"></i></label>
                                                    <div class="col-md-3">
                                                        @if (
                                                         ViewBag.CustomerTypeLabel == IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper() ||
                                                         ViewBag.CustomerTypeLabel == IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper() ||
                                                         ViewBag.CustomerTypeLabel == IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper())
                                                        {
                                                            
                                                            <input type="text" name="LoanDeclaration" value="Private" readonly style = "width:100%;"/>
                                                        }

                                                        else if (ViewBag.CustomerTypeLabel == IFMIS.Libraries.Constants.CO_OPERATIVE_SOCIETY.ToUpper())
                                                        {
                                                            <input type="text" name="LoanDeclaration" value="General Meeting" readonly style="width:100%;" />
                                                        }
                                                        else
                                                        {
                                                            <input type="text" name="LoanDeclaration" value="Board Resolution" readonly style="width:100%;" />
                                                        }

                                                    </div>

                                                    @if ( (ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()) && (ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()) && (ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()))
                                                    {
                                                    <label class="control-label col-md-2 loanDeclarationInfo">Loan Declaration Date<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="LoanDeclarationDate_1"></i></label>
                                                    <div class="col-md-3 loanDeclarationInfo">
                                                        <table>
                                                            <tr>
                                                                <td>
                                                                    @if ((ViewBag.LoanApplicationId != 0 )&& (ViewBag.LoanPurpose != null) && (ViewBag.LoanDeclaration !="Private"))
                                                                    {

                                                                        @Convert.ToDateTime(ViewBag.LoanDeclarationDate).ToString("dd/MM/yyyy")
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="LoanDeclarationDate" id="LoanDeclarationDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="LoanDeclarationDate" id="LoanDeclarationDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                    }
                                                </div>
                                                @if (ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper() && ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper() && ViewBag.CustomerTypeLabel != IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper())
                                                {
                                                <div class="form-group loanDeclaration">
                                                    <label class="control-label col-md-2 loanDeclarationInfo">Declaration Attachment<span class="redStar">*</span></label>
                                                    <div class="col-md-3 loanDeclarationInfo">

                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.LoanDeclaration != "Private" && ViewBag.LoanPurpose != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.LoanDeclarationUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".LoanDeclarationUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.LoanDeclarationUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }
                                                    </div>

                                                    </div>
                                                }

                                                    <div class="form-group">

                                                        <label class="control-label col-md-2">Applied Amount<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="AppliedLoanAmount_1"></i></label>
                                                        <div class="col-md-3">
                                                            <amount-input id="AppliedLoanAmount" style="width:100%;" class="input" />
                                                        </div>

                                                        <label class="control-label col-md-2">Application Date<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="ApplyDate_1"></i></label>
                                                        <div class="col-md-3">
                                                            <table>
                                                                <tr>
                                                                    <td>
                                                                     @if (ViewBag.LoanApplicationId != 0 && ViewBag.LoanPurpose != null && ViewBag.ApplyDate != null)
                                                                     {

                                                                            @Convert.ToDateTime(ViewBag.ApplyDate).ToString("dd/MM/yyyy")
                                                                            <div class="flatpickr date-group">
                                                                                <input type="text" placeholder="Select Date.."
                                                                                       data-input
                                                                                       style="width:100px;border:none"
                                                                                       autocomplete="off" name="ApplyDate" id="ApplyDate">
                                                                                <a class="input-button" title="open" data-toggle href="#">
                                                                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                                </a>
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            <div class="flatpickr date-group">
                                                                                <input type="text" placeholder="Select Date.."
                                                                                       data-input
                                                                                       style="width:100px;border:none"
                                                                                       autocomplete="off" name="ApplyDate" id="ApplyDate">
                                                                                <a class="input-button" title="open" data-toggle href="#">
                                                                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                                </a>
                                                                            </div>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>

                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Recovery Source<span class="redStar">*</span><i class="fa fa-times" style="color:white" id="RepaymentSource_1"></i>(<span style="font-weight:bold;" id="RepaymentSourceCount">250</span>)</label>
                                                        <div class="col-md-10">

                                                            @Html.TextArea("RepaymentSource", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;", maxlength = "300" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">

                                                        <label class="control-label col-md-2">Payee<span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            <div class="name-input-container submit-btn">
                                                                <input type="text" readonly id="PayeeName" placeholder="No Payee Selected" class="form-control" />
                                                                <input type="hidden" id="PayeeDetailId" name="PayeeDetailId" />
                                                                <a class="search-btn" onclick="SearchPayee()"
                                                                   href="#" style="float:right">
                                                                    <i class="fa fa-search search-icon"></i>
                                                                </a>
                                                            </div>
                                                        </div>

                                                        <label class="control-label col-md-2 management">
                                                            Management<span class="redStar">*</span>
                                                            <i class="fa fa-times" style="color:white"></i>
                                                        </label>
                                                        <div class="col-md-3 management">
                                                            <a class="search-btn" onclick="AddManagement()"
                                                               href="#">
                                                                <i class="fa fa-plus"></i>
                                                            </a>
                                                            @if (ViewBag.LoanManagementCount > 0)
                                                            {
                                                                <strong>@ViewBag.LoanManagementCount</strong>
                                                            }
                                                           
                                                        </div>
                                                    </div>

                                                </div>
                                           <hr style="border: 1px solid white;"/>
                                            @if (ViewBag.LoanPayeeCount != 0 && ViewBag.LoanApplicationId != 0)
                                            {
                                                <div class="row">
                                                    <div class="col-md-1"></div>
                                                    <div class="col-md-10 col-sm-10 col-xs-10">
                                                        List of Payee
                                                        <hr style="border: 1px solid #eee;" />
                                                        <table class="table  table-hover">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Payee Code</th>
                                                                    <th>Payee Name</th>
                                                                    <th>Payee Bank Account</th>
                                                                    <th>Payee Bank Name</th>
                                                                    <th>Payee Account Name</th>
                                                                    <th>Payee Address</th>
                                                                    <th>Payee BIC</th>
                                                                    <th>Action</th>
                                                                </tr>

                                                            </thead>
                                                            <tbody>
                                                                @if (ViewBag.LoanPayee != null)
                                                                {
                                                                    foreach (var payee in ViewBag.LoanPayee)
                                                                    {
                                                                        <tr>
                                                                            <td></td>
                                                                            <td>@payee.PayeeCode</td>
                                                                            <td>@payee.PayeeName</td>
                                                                            <td>@payee.PayeeBankAccount</td>
                                                                            <td>@payee.PayeeBankName</td>
                                                                            <td>@payee.PayeeAccountName</td>
                                                                            <td>@payee.PayeeAddress</td>
                                                                            <td>@payee.PayeeBIC</td>
                                                                            <td><a href="#" data-toggle="modal" class="loanPayeeCancellation   delete" data-id=@payee.LoanPayeeId data-name='@payee.PayeeName'><i class="fa fa-trash-o"></i></a></td>
                                                                        </tr>
                                                                    }

                                                                }

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="col-md-1"></div>
                                                </div>  

                                                @*<div class="row">
                                                    <div class="col-md-2"></div>
                                                    <div class="col-md-8">
                                                        List of Payee to be Added
                                                        <table id="dt_updated_payee" class="table table-striped table-bordered table-hover table-condensed" width="100%"></table>
                                                    </div>
                                                    <div class="col-md-2"></div>
                                                </div>*@
                                            }
                                            else if (ViewBag.LoanPayeeCount == 0 && ViewBag.LoanApplicationId != 0)
                                            {
                                                <div class="row">
                                                    <div class="col-md-2"></div>
                                                    <div class="col-md-8">
                                                        List of Payee to be Added
                                                        <table id="dt_updated_payee" class="table table-striped table-bordered table-hover table-condensed" width="100%"></table>
                                                    </div>
                                                    <div class="col-md-2"></div>
                                                </div>
                                            }
                                            else
                                            {

                                                <div class="row">
                                                <div class="col-md-2"></div>
                                                <div class="col-md-8">
                                                    <table id = "dt_selected_payee" class="table table-striped table-bordered table-hover table-condensed" width="100%"></table>
                                                </div>
                                                <div class="col-md-2"></div>
                                                </div>
                                            }

                                            @if(ViewBag.LoanManagementCount != 0 && ViewBag.LoanApplicationId != 0)
                                            {
                                               
                                                <div class="row">
                                                    <div class="col-md-1"></div>
                                                    <div class="col-md-10">
                                                        <hr />
                                                        List of Management
                                                        <hr style="border: 1px solid #eee;" />
                                                        <table class="table  table-hover">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Full Name</th>
                                                                    <th>Title</th>
                                                                    <th>Contact</th>
                                                                    <th>Location</th>
                                                                    <th>Photo</th>
                                                                    <th>Introduction Letter</th>
                                                                    <th>Action</th>
                                                                </tr>

                                                            </thead>
                                                            <tbody>
                                                                @if (ViewBag.LoanManagement != null)
                                                                {
                                                                    foreach (var mnt in ViewBag.LoanManagement)
                                                                    {
                                                                        <tr>
                                                                            <td></td>
                                                                            <td>@mnt.ManagementFullname</td>
                                                                            <td>@mnt.ManagementTitle</td>
                                                                            <td>@mnt.ManagementContact</td>
                                                                            <td>@mnt.ManagementLocation</td>
                                                                            <td><a href="@Url.Action("LoanAttachmentView", "LoanApplication", new { Filename = mnt.ManagementPhotoUrl, PathName = "Application" })" target="_blank"><i class="fa fa-picture-o"></i></a></td>
                                                                            <td><a href="@Url.Action("LoanAttachmentView", "LoanApplication", new { Filename = mnt.IntroductionLetterUrl, PathName = "Application" })" target="_blank"><i class="fa fa-file-pdf-o"></i></a></td>
                                                                            <td><a href="#" data-toggle="modal" class="managementCancellation   delete" data-id=@mnt.OrganisationManagementId data-name='@mnt.ManagementFullname'><i class="fa fa-trash-o"></i></a></td>
                                                                        </tr>
                                                                    }

                                                                }

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="col-md-1"></div>
                                                    </div>
                                            }
                                            else
                                            {
                                                <div class="row">
                                                    <div class="col-md-2"></div>
                                                    <div class="col-md-8">
                                                        <table id="dt_management" class="table table-striped table-bordered table-hover table-condensed" width="100%"></table>
                                                    </div>
                                                    <div class="col-md-2"></div>
                                                    </div>
                                                    }

                                                </div>
                                    </div>
                                </form>

                                 @if (ViewBag.LoanApplicationId != 0 && ViewBag.ApplyDate != null)
                                 {
                                    <div class="col-md-offset-2 btnSaveBack">
                                        <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                        <button type="submit" class="btn btn-info" onclick="saveApplicationForm()" id="saveApplicationForm">
                                            <i class="fa fa-save"></i>Update
                                            <img src="~/Content/img/loading.gif" class="saveLoader" />
                                        </button>
                                    </div>
                                 }
                                 else
                                 {
                                    <div class="col-md-offset-2 btnSaveBack">
                                        <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                        <button type="submit" class="btn btn-info" onclick="saveApplicationForm()" id="saveApplicationForm">
                                            <i class="fa fa-save"></i>Save
                                            <img src="~/Content/img/loading.gif" class="saveLoader" />
                                        </button>
                                    </div>
                                 }
                                
                            </div>
                            @*---------------------BEGINNING OF STEP THREE--------------------------*@
                            <div class="row setup-content" id="step-3">

                                <form>
                                    <div class="form-horizontal">
                                        <div class="col-xs-12">
                                            <div align="center">
                                                <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Collateral Type<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @if (ViewBag.Stage == 5 || ViewBag.Stage == 6 || ViewBag.Stage == 7)
                                                        {
                                                            <select id="CollateralTypeId" disabled class="form-control select2">
                                                                @foreach (var collateralType in ViewBag.CollateralTypeList)
                                                                {
                                                                    if (ViewBag.CollateralTypeId == collateralType.CollateralTypeId)
                                                                    {
                                                                        <option value='@collateralType.CollateralName' selected>@collateralType.CollateralName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="">Select Collateral Type</option>
                                                                        <option value='@collateralType.CollateralName'>
                                                                            @collateralType.CollateralName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            <select name="CollateralTypeId" id="CollateralTypeId" required onchange="CollateralTypeChange()" class="form-control select2">
                                                                @if (ViewBag.CollateralTypeList != null)
                                                                {
                                                                    <option>Select Collateral Type</option>
                                                                    foreach (var collateralType in ViewBag.CollateralTypeList)
                                                                    {
                                                                        <option value='@collateralType.CollateralName'>@collateralType.CollateralName</option>
                                                                    }
                                                                }
                                                                }

                                                            </select>
                                                        }
                                                    </div>
                                                    <label class="control-label col-md-2 collateralUsage">Collateral Usage<span class="redStar">*</span></label>
                                                    <div class="col-md-3 collateralUsage">
                                                        @Html.DropDownList("CollateralUsageId", ViewBag.CollateralUsageList as SelectList, "Select Collateral Usage", new { @Class = "input form-control select2", style = "width:300px" })
                                                    </div>

                                                </div>

                                                <div class="form-group normalCollateral">
                                                    <label class="control-label col-md-2">Registration No<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.CollateralRegistrationNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Plot No<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.CollateralPlotNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                </div>

                                                <div class="form-group normalOwnerCollateral">
                                                    <label class="control-label col-md-2">Owner<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.Owner, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Block No<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.BlockNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                </div>

                                                <div class="form-group normalCollateral">
                                                    <label class="control-label col-md-2">Region<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.CollateralRegionId != null)
                                                        {
                                                            <select id="CollateralRegionId" class="form-control select2">
                                                                @foreach (var region in ViewBag.CollateralPreviewRegionList)
                                                                {
                                                                    if (ViewBag.CollateralRegionId == region.RegionId)
                                                                    {
                                                                        <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@region.RegionId'>
                                                                            @region.RegionName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("CollateralRegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }

                                                    </div>
                                                    <label class="control-label col-md-2">District<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.CollateralDistrictId != null)
                                                        {
                                                            <select id="CollateralDistrictId" class="form-control select2">
                                                                @foreach (var district in ViewBag.CollateralPreviewDistrictList)
                                                                {
                                                                    if (ViewBag.CollateralDistrictId == district.DistrictId)
                                                                    {
                                                                        <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@district.DistrictId'>
                                                                            @district.DistrictName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("CollateralDistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }
                                                    </div>

                                                </div>

                                                <div class="form-group normalCollateral">
                                                    
                                                    <label class="control-label col-md-2">Ward<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("CollateralWardId", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                    </div>
                                                    <label class="control-label col-md-2">Village /Street<span class="redStar">*</span> </label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.CollateralVillage, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                </div>

                                                <div class="form-group normalCollateral">
                                                    <label class="control-label col-md-2">Hamlet<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.CollateralHamlet, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Attachment<span class="redStar">*</span> </label>
                                                    <div class="col-md-3">

                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.Stage == 5 && ViewBag.CollateralAttachmentUrl != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.CollateralAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".CollateralAttachmentUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.CollateralAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }
                                                    </div>
                                                    <label class="control-label col-md-2"></label>
                                                    <div class="col-md-3">

                                                    </div>

                                                </div>

                                                @*BEGINNING OF GUARANTORSHIP*@

                                                <div class="form-group guarantorshipCollateral">
                                                    <label class="control-label col-md-2">Guarantor Name<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.Name, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                    <label class="control-label col-md-2">Physical Address<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.GuarantorPhysicalAddress, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                </div>
                                                <div class="form-group guarantorshipCollateral">
                                                    <label class="control-label col-md-2">Meeting No<span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.MeetingNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>
                                                    <label class="control-label col-md-2">Meeting Date<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        <table>
                                                            <tr>
                                                                <td>

                                                                    @if (ViewBag.LoanApplicationId != 0 && ViewBag.MeetingDate != "0")
                                                                    {

                                                                        @Convert.ToDateTime(ViewBag.MeetingDate).ToString("dd/MM/yyyy")
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="MeetingDate" id="MeetingDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="MeetingDate" id="MeetingDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>

                                                </div>

                                                <div class="form-group guarantorshipCollateral">
                                                    <label class="control-label col-md-2">Region<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.GuarantorshipRegionId != null)
                                                        {
                                                            <select id="GuarantorshipRegionId" class="form-control select2">
                                                                @foreach (var region in ViewBag.GuarantorPreviewRegionList)
                                                                {
                                                                    if (ViewBag.GuarantorshipRegionId == region.RegionId)
                                                                    {
                                                                        <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@region.RegionId'>
                                                                            @region.RegionName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("GuarantorshipRegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }

                                                    </div>
                                                    <label class="control-label col-md-2">District<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @if (ViewBag.GuarantorshipDistrictId != null)
                                                        {
                                                            <select id="GuarantorshipDistrictId" class="form-control select2">
                                                                @foreach (var district in ViewBag.GuarantorPreviewDistrictList)
                                                                {
                                                                    if (ViewBag.GuarantorshipDistrictId == district.DistrictId)
                                                                    {
                                                                        <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@district.DistrictId'>
                                                                            @district.DistrictName
                                                                        </option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            @Html.DropDownList("GuarantorshipDistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                        }
                                                    </div>

                                                </div>


                                                <div class="form-group guarantorshipCollateral">
                                                    <label class="control-label col-md-2">Attachment <span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.Stage == 7 && ViewBag.GuarantorshipUrl != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.GuarantorshipAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".GuarantorshipUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.GuarantorshipAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }
                                                    </div>
                                                    <label class="control-label col-md-2">Agenda No<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.AgendaNo, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                    </div>

                                                </div>
                                                @*END OF GUARANTORSHIP*@
                                                <div class="form-group salaryCollateral">
                                                    <label class="control-label col-md-2">Basic Salary <span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @*@Html.TextBoxFor(model => model.BasicSalary, new { @Class = "input", @required = "required", type = "number", min = "0", style = "width:100%;", onkeyup = "computeBasicSalary()" })*@
                                                        <amount-input id="BasicSalary" style="width:100%;" required class="input" onkeyup = "computeBasicSalary()" />
                                                    </div>
                                                    <label class="control-label col-md-2">Net Amount <span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @*@Html.TextBoxFor(model => model.NetAmount, new { @Class = "input", @required = "required", type = "number", min = "0", style = "width:100%; " })*@
                                                       

                                                         @if (ViewBag.LoanApplicationId != 0 && ViewBag.Stage == 6 && ViewBag.RequiredDeduction != 0)
                                                         {
                                                            <amount-input id="NetAmount" style="width:100%;" required class="input" onkeyup="updateDeduction()" />
                                                         }
                                                         else
                                                         {
                                                            <amount-input id="NetAmount" style="width:100%;" required class="input" onkeyup="checkDeduction()" />
                                                         }

                                                    </div>
                                                   
                                                </div>

                                                <div class="form-group salaryCollateral">
                                                    <label class="control-label col-md-2">Maximum Allowed Deduction <span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @Html.TextBoxFor(model => model.MaxAllowedDeduction, new { @Class = "input", @readonly = "readonly", @required = "required", type = "text", min = "0", style = "width:100%; ", maxlength = "15" })
                                                        <span id="errorMessage"></span>
                                                    </div>
                                                    <label class="control-label col-md-2">Required Deduction <span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.RequiredDeduction, new { @Class = "input", @required = "required", maxlength = "15", min = "0", type = "text",style = "width:70%;", Value ="0", onkeyup = "CheckNegative()" })
                                                        <button type="button" class="btn btn-info" onclick="CalculateEMIDeduction()"  id="calculateDeduction">
                                                           Calculate
                                                        </button>
                                                    </div>
                                                    <span id="errorNetAmount"></span>
                                                </div>

                                                <div class="form-group salaryCollateral">
                                                    <label class="control-label col-md-2">Salary Slip Month <span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        <div>
                                                            @Html.DropDownList("SalarySlipMonth", new List<SelectListItem>{
                                                            new SelectListItem{ Text="January", Value = "0" },
                                                            new SelectListItem{ Text="February", Value = "1" },
                                                            new SelectListItem{ Text="March", Value = "2" },
                                                            new SelectListItem{ Text="April", Value = "3" },
                                                            new SelectListItem{ Text="May", Value = "4" },
                                                            new SelectListItem{ Text="June", Value = "5" },
                                                            new SelectListItem{ Text="July", Value = "6" },
                                                            new SelectListItem{ Text="August", Value = "7" },
                                                            new SelectListItem{ Text="September", Value = "8" },
                                                            new SelectListItem{ Text="October", Value = "9" },
                                                            new SelectListItem{ Text="November", Value = "10" },
                                                            new SelectListItem{ Text="December", Value = "11" },
                                                             }, new { @required = "required", style = "width:35% !important", id = "SalarySlipMonth" })

                                                        </div>

                                                    </div>

                                                    <label class="control-label col-md-2">Retirement Date <span class="redStar">*</span></label>

                                                    <div class="col-md-3">
                                                        <table>
                                                            <tr>
                                                                <td>
                                                                    @if (ViewBag.Stage == 6)
                                                                    {
                                                                        @Convert.ToDateTime(ViewBag.RetirementDate).ToString("dd/MM/yyyy")
                                                                        <div class="flatpickr2 date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="RetirementDate" id="RetirementDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <div class="flatpickr2 date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="RetirementDate" id="RetirementDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <span id="errorRetirementDate"></span>
                                                    </div>

                                                </div>

                                                <div class="form-group salaryCollateral">
                                                    <label class="control-label col-md-2">Salary Slip Year <span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        @Html.TextBoxFor(model => model.SalarySlipYear, new { @Class = "input", @required = "required", type = "number", min="0", onkeyup = "validateSalarySlipYear()", pattern = "[1-9]{1}[0-9]{3}" })
                                                      <span id="errorSalarySlip"></span>
                                                    </div>
                                                </div>

                                                <div class="form-group salaryCollateral">
                                                    <label class="control-label col-md-2">Salary Slip Attachment <span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.Stage == 6 && ViewBag.SalarySlipAttachmentUrl != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.SalarySlipAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".SalarySlipAttachmentUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.SalarySlipAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }
                                                    </div>
                                                    <label class="control-label col-md-2">Guarantorship Attachment <span class="redStar">*</span></label>
                                                    <div class="col-md-3">

                                                        @if (ViewBag.LoanApplicationId != 0 && ViewBag.Stage == 6 && ViewBag.GuarantorAttachmentUrl != null)
                                                        {
                                                            @Html.TextBoxFor(model => model.GuarantorAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                            <a href="#" data-toggle="modal" data-target=".GuarantorAttachmentUrl" class="btn-xs edit">View Attachment</a>
                                                        }
                                                        else
                                                        {
                                                            @Html.TextBoxFor(model => model.GuarantorAttachmentUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                        }


                                                    </div>

                                                </div>

                                                <div class="form-group endorsement">
                                                    <label class="control-label col-md-2">
                                                        Endorsement
                                                        <i class="fa fa-times" style="color:white"></i>
                                                        <span class="redStar">*</span>
                                                    </label>
                                                    <div class="col-md-3">
                                                        <a class="search-btn" onclick="AddEndorsement()"
                                                           href="#">
                                                            <i class="fa fa-plus"></i>
                                                        </a>
                                                        @if (ViewBag.LoanEndorsementCount > 0)
                                                        {
                                                           <span id="countLoanEndorsement">&nbsp;&nbsp;@ViewBag.LoanEndorsementCount</span>
                                                        }
                                                    </div>
                                                    @if (ViewBag.LoanCollateralCount > 0)
                                                    {
                                                    <label class="control-label col-md-2">
                                                        More Collateral
                                                        <i class="fa fa-times" style="color:white"></i>
                                                    </label>
                                                    <div class="col-md-3">
                                                        <a class="search-btn" onclick="AddCollateral()"
                                                           href="#">
                                                            <i class="fa fa-plus"></i>
                                                        </a>&nbsp;&nbsp;
                                                        <span id="countLoanCollateral"></span>
                                                    </div>
                                                    }
                                                </div>

                                            </div>
                                            @*@if (ViewBag.LoanEndorsementCount != 0 && ViewBag.LoanApplicationId != 0)
                                            {

                                                <div class="row">
                                                    <div class="col-md-1"></div>
                                                    <div class="col-md-10">
                                                        <hr />
                                                        List of Endorsement
                                                        <hr style="border: 1px solid #eee;" />
                                                        <table class="table  table-hover">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Full Name</th>
                                                                    <th>Title</th>
                                                                    <th>Location</th>
                                                                    <th>Date</th>
                                                                    <th>Action</th>
                                                                </tr>

                                                            </thead>
                                                            <tbody>
                                                                @if (ViewBag.LoanEndorsement != null)
                                                                {
                                                                    foreach (var endorsement in ViewBag.LoanEndorsement)
                                                                    {
                                                                        <tr>
                                                                            <td></td>
                                                                            <td>@endorsement.EndorsementFullName</td>
                                                                            <td>@endorsement.EndorsementTitle</td>
                                                                            <td>@endorsement.EndorsementLocation</td>
                                                                            <td>@Convert.ToDateTime(endorsement.EndorsementDate).ToString("dd/MM/yyyy") </td>
                                                                            <td><a href="#" data-toggle="modal" class="endorsementCancellation   delete" data-id=@endorsement.LoanEndorsementId data-name='@endorsement.EndorsementFullName'><i class="fa fa-trash-o"></i></a></td>
                                                                        </tr>
                                                                    }

                                                                }

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="col-md-1"></div>
                                                </div>
                                            }
                                            else
                                            {*@
                                                <div class="row">
                                                    <div class="col-md-2"></div>
                                                    <div class="col-md-8">
                                                        <table  class="table table-striped table-bordered table-hover table-condensed" width="100%"></table>
                                                    </div>
                                                    <div class="col-md-2"></div>
                                                </div>
                                            @*}*@


                                        </div>
                                    </div>
                                </form>
                                @if (ViewBag.LoanApplicationId != 0 && (ViewBag.SalarySlipAttachmentUrl != null || ViewBag.MeetingNo != "0" || ViewBag.CollateralRegistrationNo != "0"))
                                {
                                    <div class="col-md-offset-2 btnSaveBack">
                                        <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                        <button type="submit" class="btn btn-info" onclick="saveCollateralForm()" id="saveCollateralForm">
                                            <i class="fa fa-save"></i>Update
                                            <img src="~/Content/img/loading.gif" class="saveLoader" />
                                        </button>
                                    </div>
                                }
                                else
                                {
                                    <div class="col-md-offset-2 btnSaveBack">
                                        <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                        <button type="submit" class="btn btn-info" onclick="saveCollateralForm()" id="saveCollateralForm">
                                            <i class="fa fa-save"></i>Save
                                            <img src="~/Content/img/loading.gif" class="saveLoader" />
                                        </button>
                                    </div>
                                }
                               
                            </div>
                            @*------------------------------END OF STEP THREE-----------------------------*@
                            @*------------------------------BEGINNING OF STEP FOUR------------------------*@
                            <div class="row setup-content uploadInformation" id="step-4">
                                <div class="col-xs-12">
                                    <div align="center">
                                        <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                    </div>
                                    @if (ViewBag.AttachmentName == null && (ViewBag.Stage == 5 || ViewBag.Stage == 6 || ViewBag.Stage == 7) )
                                    {

                                        <div class="col-md-12">

                                            @using (Html.BeginForm("LoanAttachment", "LoanApplication", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return validateForm(this);" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                <div class="row">
                                                    <div class="col-md-2"></div>
                                                    <div class="col-md-8">


                                                        <input type="hidden" name="LoanApplicationId" value="@ViewBag.LoanApplicationId" id="LoanApplicationId" />
                                                        <table class="table  table-hover table-condensed">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Document Name</th>
                                                                    <th>File Name</th>
                                                                </tr>

                                                            </thead>

                                                            @{var num = 1;}
                                                            @if (ViewBag.GeneralAttachmentList != null)
                                                            {
                                                                foreach (var generalList in ViewBag.GeneralAttachmentList)
                                                                {
                                                                    <tr>
                                                                        <td>@num <input type="hidden" name="DocumentId[]" value="@generalList.AttachmentTypeId" id="DocumentId" /></td>
                                                                        <td>@generalList.AttachmentName <input type="hidden" name="DocumentName[]" value="@generalList.AttachmentName" id="DocumentName" /></td>
                                                                        <td>
                                                                            <input type="file" name="FileName" id="FileName" required />
                                                                        </td>
                                                                    </tr>
                                                                    num++;
                                                                }
                                                            }

                                                            @if (ViewBag.CustomerTypeAttachmentList != null)
                                                            {
                                                                foreach (var custTypeList in ViewBag.CustomerTypeAttachmentList)
                                                                {
                                                                    <tr>
                                                                        <td>@num <input type="hidden" name="DocumentId[]" value="@custTypeList.CustomerTypeAttachmentId" id="DocumentId" /></td>
                                                                        <td>@custTypeList.AttachmentName <input type="hidden" name="DocumentName[]" value="@custTypeList.AttachmentName" id="DocumentName" /></td>
                                                                        <td>
                                                                            <input type="file" name="FileName" id="FileName" required />
                                                                        </td>
                                                                    </tr>
                                                                    num++;
                                                                }
                                                            }

                                                            @if (ViewBag.LoanProductAttachmentList != null)
                                                            {
                                                                foreach (var lnSubList in ViewBag.LoanProductAttachmentList)
                                                                {

                                                                    <tr>
                                                                        <td>@num<input type="hidden" name="DocumentId[]" value="@lnSubList.LoanProductId" id="LoanProductId" /></td>
                                                                        <td>@lnSubList.AttachmentName <input type="hidden" name="DocumentName[]" value="@lnSubList.AttachmentName" id="DocumentName" /></td>

                                                                        <td>
                                                                            <input type="file" name="FileName" id="FileName" required />
                                                                        </td>
                                                                    </tr>
                                                                    num++;
                                                                }
                                                            }

                                                            @if (ViewBag.LoanSubProductAttachmentList != null)
                                                            {
                                                                foreach (var lnSubList in ViewBag.LoanSubProductAttachmentList)
                                                                {

                                                                    <tr>
                                                                        <td>@num<input type="hidden" name="DocumentId[]" value="@lnSubList.LoanSubProductId" id="LoanSubProductId" /></td>
                                                                        <td>@lnSubList.AttachmentName <input type="hidden" name="DocumentName[]" value="@lnSubList.AttachmentName" id="DocumentName" /></td>
                                                                        <td>
                                                                            <input type="file" name="FileName" id="FileName" required />
                                                                        </td>
                                                                    </tr>
                                                                    num++;
                                                                }
                                                            }

                                                            @if (ViewBag.CollateralAttachmentList != null)
                                                            {
                                                                foreach (var colAttList in ViewBag.CollateralAttachmentList)
                                                                {

                                                                    <tr>
                                                                        <td>@num<input type="hidden" name="DocumentId[]" value="@colAttList.CollateralAttachmentId" id="DocumentId" /></td>
                                                                        <td>@colAttList.AttachmentName <input type="hidden" name="DocumentName[]" value="@colAttList.AttachmentName" id="DocumentName" /></td>
                                                                        <td>
                                                                            <input type="file" name="FileName" id="FileName" required />
                                                                        </td>
                                                                    </tr>
                                                                    num++;
                                                                }
                                                            }

                                                            @if (ViewBag.GeneralAttachmentList == null || ViewBag.LoanSubProductAttachmentList == null || ViewBag.CollateralAttachmentList == null)
                                                            {
                                                                <div class="row">
                                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                                    <div class="col-lg-6 col-sm-6 col-xs-6">

                                                                        <div class="alert alert-block alert-info">
                                                                            <a class="close" data-dismiss="alert" href="#">×</a>
                                                                            <h4 class="alert-heading">Attachments</h4>
                                                                            <center><span>No Attachment Available,Contact Administratot to Add Attachments</span></center>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                                </div>

                                                            }

                                                        </table>
                                                        
                                                    </div>
                                                    <div class="col-md-2"></div>
                                                </div>
                             
                                                                    <div class="col-md-offset-2">
                                                                        <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                                        <button type="button" class="btn btn-info cancel_lpo" style="margin-right:2px;display:none">
                                                                            <i class="glyphicon revicon-cancel"></i> Back
                                                                        </button>
                                                                        <button type="submit" name="submit" id="btnSubmit" class="btn btn-info" style="margin-right:2px">
                                                                            <i class="glyphicon glyphicon-floppy-disk"></i> Finish
                                                                            <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                                        </button>
                                                                    </div>

                                                                }
                                        </div>
                                                                }
                                                               @if (ViewBag.Stage != 5 && ViewBag.Stage != 6 && ViewBag.Stage != 7)
                                                                           {

                                                                    <div class="row">
                                                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                                        <div class="col-lg-6 col-sm-6 col-xs-6">

                                                                            <div class="alert alert-block alert-info">
                                                                                <a class="close" data-dismiss="alert" href="#">×</a>
                                                                                <h4 class="alert-heading">Attachments</h4>
                                                                                <center><span>Fill Loan and Collateral Informations First</span></center>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                                    </div>
                                                                }



                                    @if (ViewBag.LoanApplicationId != 0 && ViewBag.AttachmentName != null)
                                    {
                                        using (Html.BeginForm("EditLoanAttachment", "LoanApplication", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return validateForm(this);" }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="LoanApplicationId" value="@ViewBag.LoanApplicationId" id="LoanApplicationId" />
                                    <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-md-8">
                                            <captin>Uploaded Attachments</captin>
                                            <table class="table  table-hover table-condensed">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Name</th>
                                                        <th>
                                                            View Attachment
                                                        </th>
                                                        <th>Attachment</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @{var num = 1;}
                                                    @foreach (var attach in ViewBag.AttachmentName)
                                                    {
                                                        <tr>
                                                            <td>@num</td>
                                                            <td>@attach.AttachmentTitle 
                                                            <input type="hidden" name="DocumentId[]" value="@attach.LoanAttachmentId" id="DocumentId" />
                                                            </td>
                                                            @if (attach.AttachmentName == "NULL")
                                                            {
                                                            <td><span style="color:red">Attachment Not Found</span></td>
                                                            }else{
                                                            <td><a href="@Url.Action("LoanAttachmentView", "LoanApplication", new { Filename = attach.AttachmentName, PathName = "Attachments" })" target="_blank"><i class="fa fa-file-pdf-o"></i></a></td>
                                                            }
                                                            @if(attach.AttachmentName == "NULL"){
                                                            <td><input type="file" name="FileName" id="FileName" required /></td>
                                                            }else{
                                                            <td><input type="file" name="FileName" id="FileName"/></td>
                                                            }
                                                           
                                                            <td>
                                                            @if (attach.AttachmentName != "NULL") {                                                             
                                                            <a href="#" data-toggle="modal" class="attachmentCancellation   delete" data-id=@attach.LoanAttachmentId data-name='@attach.AttachmentTitle'><i class="fa fa-trash-o"></i></a>
                                                            }
                                                            </td>
                                                        </tr>
                                                        num++;
                                                    }

                                                </tbody>
                                            </table>

                                            <div class="col-md-offset-2">
                                                <a href="@Url.Action("LoanApplicationList", "LoanApplication")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                <button type="button" class="btn btn-info cancel_lpo" style="margin-right:2px;display:none">
                                                    <i class="glyphicon revicon-cancel"></i> Back
                                                </button>
                                                <button type="submit" name="submit" class="btn btn-info" style="margin-right:2px">
                                                    <i class="glyphicon glyphicon-floppy-disk"></i> Update
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-2"></div>

                                    </div>
                                        }
                                    }

                                </div>

                            </div>

                            @*------------------------------------END OF STEP FOUR---------------------------------------*@

                        </div>
                    </div>
                </div>
            </article>

        </div>
    </section>

</div>

<div class="modal fade" id="AddManagementModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">

            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Add Management</h3>

            </div>
            <div class="modal-body">
                <form id="managementInfo">
                    <div class="form-horizontal">


                        <div class="row" style="padding:1% 5% 0 5%;">
                            <div class="col-md-2"></div>
                            <div class="col-md-8 col-lg-8 col-sm-12 ">
                                <table>
                                    <tr>
                                        <td class="form-label">
                                             Name <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.ManagementFullname, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                             Title <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white" id="description"></i>
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.ManagementTitle, new { @Class = "input", @required = "required", style = "width:300px; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                             Contact <span class="redStar">*</span>
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.ManagementContact, new { @Class = "input", @required = "required", style = "width:300px; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">Location <span class="redStar">*</span></td>
                                        <td>
                                            @Html.TextBoxFor(model => model.ManagementLocation, new { @Class = "input", @required = "required", style = "width:300px; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                             Photo <span class="redStar">*</span>
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.ManagementPhotoUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Introduction Letters <span class="redStar">*</span>
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.IntroductionLetterUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label"></td>
                                        <td>
                                      
                                            <button type="button" data-dismiss="modal" class="btn btn-info cancel_lpo" style="margin-right:2px;">
                                                <i class="glyphicon revicon-cancel"></i> Cancel
                                            </button>

                                            <button type="button" class="btn btn-info" onclick="AddManagementData()" id="saveManagementForm">
                                                <i class="fa fa-save"></i>Save
                                                <img src="~/Content/img/loading.gif" class="saveLoader" />
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <br />
                        <div class="col-xs-12">

                            <div class="col-md-12">
                                <table class="table" id="dt_management_table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Title</th>
                                            <th>Contact</th>
                                            <th>Location</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="AddEndorsementModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">

            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Add Endorsement</h3>

            </div>
            <div class="modal-body">
                <form id="endorsementInfo">
                    <div class="form-horizontal">

                        <div class="row" style="padding:1% 5% 0 5%;">
                            <div class="col-md-2"></div>
                            <div class="col-md-8 col-lg-8 col-sm-12 ">
                                <table>
                                    <tr>
                                        <td class="form-label">
                                            Full Name <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.EndorsementFullName, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                             Title <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white" id="description"></i>
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.EndorsementTitle, new { @Class = "input", @required = "required", style = "width:300px; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">Location <span class="redStar">*</span></td>
                                        <td>
                                            @Html.TextBoxFor(model => model.EndorsementLocation, new { @Class = "input", @required = "required", style = "width:300px; " })
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Endorsement Date <span class="redStar">*</span>
                                        </td>
                                        <td>
                                            <table>
                                                <tr>
                                                    <td>
                                                        <div class="flatpickr date-group">
                                                            <input type="text" placeholder="Select Date.."
                                                                   data-input
                                                                   style="width:100px;border:none"
                                                                   autocomplete="off" name="EndorsementDate" id="EndorsementDate">
                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label"></td>
                                        <td>

                                            <button type="button"  data-dismiss="modal" class="btn btn-info" style="margin-right:2px;">
                                                <i class="glyphicon revicon-cancel"></i> Cancel
                                            </button>

                                            <button type="button" class="btn btn-info" onclick="AddData()" id="saveEndorsementForm">
                                                <i class="fa fa-save"></i>Save
                                                <img src="~/Content/img/loading.gif" class="saveLoader" />
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <br />
                        <div class="col-xs-12">

                            <div class="col-md-12">
                                <table class="table" id="dt_endorsement_table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Endorsement Name</th>
                                            <th>Endorsement Title</th>
                                            <th>Endorsement Date</th>
                                            <th>Endorsement Office Location</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
   
                                    </tbody>
                            
                                </table>
                            </div>

                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="AddCollateralModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">

            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Add Collateral</h3>

            </div>
            <div class="modal-body">
                <form id="collateralInfo">
                    <div class="form-horizontal">
                        <div class="row" style="padding:1% 5% 0 5%;">
                            <div class="col-md-6 col-lg-6 col-sm-6 col-xs-6 col-sm-12 ">
                                <table>

                                    <tr>
                                        <td class="form-label">
                                            Collateral Type <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px;">
                                                @if (ViewBag.Stage == 5 || ViewBag.Stage == 6 || ViewBag.Stage == 7)
                                                {
                                                    <select id="CollateralTypeId2" class="form-control select2">
                                                        <option value="Select Collateral Type">Select Collateral Type</option>
                                                        @foreach (var collateralType in ViewBag.AddCollateralTypeList)
                                                        {
                                                            <option value='@collateralType.CollateralName'>
                                                                @collateralType.CollateralName
                                                            </option>
                                                        }
                                                    </select>
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                            Registration No <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.CollateralRegistrationNo2, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Owner<span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.Owner2, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                            Region <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px;">
                                                <select id="CollateralRegionId2" class="form-control select2">
                                                    <option value="">Select Region</option>
                                                    @foreach (var region in ViewBag.AddCollateralPreviewRegionList)
                                                    {
                                                        <option value='@region.RegionId'>
                                                            @region.RegionName
                                                        </option>
                                                    }
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                            @*Division <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>*@
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px;">
                                                @*<select id="CollateralDivisionId2" class="form-control select2">
                                                    <option value="">Select Division</option>
                                                    @foreach (var division in ViewBag.AddCollateralPreviewDivisionList)
                                                    {
                                                            <option value='@division.DivisionId'>
                                                                @division.DivisionName
                                                            </option>
                                                    }
                                                </select>*@
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="form-label">
                                            Ward <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px;">
                                                @Html.DropDownList("CollateralWardId2", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Attachment <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.CollateralAttachmentUrl2, new { @Class = "input", @required = "required", type = "file", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label"></td>
                                        <td>
                                            <button type="button"  data-dismiss="modal" class="btn btn-info cancel_lpo" style="margin-right:2px;">
                                                <i class="glyphicon revicon-cancel"></i> Cancel
                                            </button>

                                            <button type="button" class="btn btn-info" onclick="AddCollateralData()" id="addCollateralForm">
                                                <i class="fa fa-save"></i>Save
                                                <img src="~/Content/img/loading.gif" class="saveLoader" />
                                            </button>
                                        </td>
                                    </tr>
                                </table>


                            </div>

                            <div class="col-md-6 col-lg-6 col-sm-6 col-xs-6 col-sm-12 ">
                                <table>

                                    <tr>
                                        <td class="form-label">
                                            Collateral Usage <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px">
                                                @Html.DropDownList("CollateralUsageId2", ViewBag.CollateralUsageList as SelectList, "Select Collateral Usage", new { @Class = "input form-control select2", style = "width:300px" })
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Plot No <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.CollateralPlotNo2, new { @Class = "input", @required = "required", style = "width:300px " })
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="form-label">
                                            Block No <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.BlockNo2, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>


                                    <tr>
                                        <td class="form-label">
                                            District <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width:300px;">
                                                <select id="CollateralDistrictId2" class="form-control select2">
                                                    <option value="">Select District</option>
                                                    @foreach (var district in ViewBag.AddCollateralPreviewDistrictList)
                                                    {
                                                            <option value='@district.DistrictId'>
                                                                @district.DistrictName
                                                            </option>
                                                    }
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                            Village /Street <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.CollateralVillage2, new { @Class = "input", @required = "required", style = "width:300px " })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="form-label">
                                            Hamlet <span class="redStar">*</span>
                                            <i class="fa fa-times" style="color:white"></i>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                @Html.TextBoxFor(model => model.CollateralHamlet2, new { @Class = "input", @required = "required", style = "width:300px; " })
                                            </div>
                                        </td>
                                    </tr>

                                </table>
                            </div>

                        </div>

                        <br />
                        <div class="col-xs-12">

                            <div class="col-md-12">
                                <table class="table" id="dt_collateral_table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Registration No</th>
                                            <th>Plot No</th>
                                            <th>Owner</th>
                                            <th>Block No</th>
                                            <th>Village</th>
                                            <th>Hamlet</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>

                                </table>
                            </div>

                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="payeeModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">


            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Search Payee</h3>

            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                    </div>
                    <div class="col-md-6">
                        <div class="search-container submit-btn" style="float:right">
                            <i class="fa fa-search search-icon"></i>
                            <input type="search" name="search" placeholder="Search..." id="searchbox">
                        </div>
                    </div>
                </div>
                <table class="table" id="dt_search_payee">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>PaymentId</th>
                            <th>Payee BIC</th>
                            <th>Payee Name</th>
                            <th>Payee Code</th>
                            <th>Bank Name</th>
                            <th>Bank Account No</th>
                            <th>Payee Type</th>
                            <th>Address</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

            </div>
            <div class="modal-footer">
                <button class="btn btn-info" data-dismiss="modal">
                    <i class="fa  fa-times"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ApplicantPhoto">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h4 align="center">Applicant Photo</h4>
            </div>

            <div class="modal-body form-horizontal">
                @if (ViewBag.IndividualPhotoUrl != null)
                {
                    <img src="~/Media/Loan/Application/@ViewBag.IndividualPhotoUrl" class="img-thumbnail" style="width:100%;height:100%" />
                }
                <div class="modal-footer">
                    <a href="#" class="btn btn-info" data-dismiss="modal">Cancel</a>

                </div>
            </div>
        </div>
    </div>
    </div>
<div class="modal fade" id="SpousePhoto">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h4 align="center">Spouse Photo</h4>
            </div>

            <div class="modal-body form-horizontal">
                @if (ViewBag.SpousePhotoUrl != null)
                {
                    <img src="~/Media/Loan/Application/@ViewBag.SpousePhotoUrl" class="img-thumbnail" style="width:100%;height:100%" />
                }
                <div class="modal-footer">
                    <a href="#" class="btn btn-info" data-dismiss="modal">Cancel</a>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade RegistrationCertificate">
    <div class="modal-dialog">
        <div class="modal-body ">
            @if (ViewBag.RegistrationCertificate != null)
            {
                <iframe id="RegistrationCertificate"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="Registration Certificate Attachment"
                        src="~/Media/Loan/Application/@ViewBag.RegistrationCertificate"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

<div class="modal fade LoanDeclarationUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.LoanDeclarationUrl != null && ViewBag.LoanDeclaration != "Private" && ViewBag.LoanPurpose != null)
            {
                <iframe id="LoanDeclarationUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="Loan Declaration Attachment"
                        src="~/Media/Loan/Application/@ViewBag.LoanDeclarationUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

<div class="modal fade CollateralAttachmentUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.Stage == 5 && ViewBag.CollateralAttachmentUrl != null)
            {
                <iframe id="CollateralAttachmentUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="Collateral Attachment"
                        src="~/Media/Loan/Application/@ViewBag.CollateralAttachmentUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>
<div class="modal fade IndividualAttachmentUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.IndividualAttachmentUrl != null)
            {
                <iframe id="IndividualAttachmentUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="Title"
                        src="~/Media/Loan/Application/@ViewBag.IndividualAttachmentUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

<div class="modal fade SalarySlipAttachmentUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.Stage == 6 && ViewBag.SalarySlipAttachmentUrl != null)
            {
                <iframe id="SalarySlipAttachmentUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="SalarySlip Attachment"
                        src="~/Media/Loan/Application/@ViewBag.SalarySlipAttachmentUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

<div class="modal fade GuarantorAttachmentUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.Stage == 6 && ViewBag.GuarantorAttachmentUrl != null)
            {
                <iframe id="GuarantorAttachmentUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="SalarySlip Attachment"
                        src="~/Media/Loan/Application/@ViewBag.GuarantorAttachmentUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

<div class="modal fade GuarantorshipUrl">
    <div class="modal-dialog">
        <div class="modal-body ">

            @if (ViewBag.Stage == 7 && ViewBag.GuarantorshipUrl != null)
            {
                <iframe id="GuarantorshipUrl"
                        style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                        title="Collateral Attachment"
                        src="~/Media/Loan/Application/@ViewBag.GuarantorshipUrl"
                        frameborder="1"
                        scrolling="auto"
                        height="600px"
                        width="800px"></iframe>
            }

        </div>
    </div>
</div>

    @section pagespecific {
        <!-- PAGE RELATED PLUGIN(S) -->
        <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
        <script type="text/javascript">

            $("#RequiredDeduction").autoNumeric('init');

            $('#LoanPurpose').on("keyup", function () {
                var count = $('#LoanPurpose').val().split('');
                var numChars = 300 - parseInt(count.length);
                $('#LoanPurposeCount').text(parseInt(numChars));
            });


            $('#RepaymentSource').on("keyup", function () {
                var count = $('#RepaymentSource').val().split('');
                var numChars = 300 - parseInt(count.length);
                $('#RepaymentSourceCount').text(parseInt(numChars));
            });


            $(document).ready(function(){

                if ('@ViewBag.LoanApplicationId'){
                    var count = $('#LoanPurpose').val().split('');
                    var numChars = 300 - parseInt(count.length);
                    $('#LoanPurposeCount').text(parseInt(numChars));

                    var count = $('#RepaymentSource').val().split('');
                    var numChars = 300 - parseInt(count.length);
                    $('#RepaymentSourceCount').text(parseInt(numChars));
                }
                if('@ViewBag.AppliedLoanAmount' != 0){
                    $("#AppliedLoanAmount").val('@string.Format("{0:#,0.00}", ViewBag.AppliedLoanAmount)')
                    $("#_AppliedLoanAmount").val('@string.Format("{0:#,0.00}", ViewBag.AppliedLoanAmount)')
                }

                if('@ViewBag.BasicSalary' != 0){
                    $("#BasicSalary").val('@string.Format("{0:#,0.00}", ViewBag.BasicSalary)')
                    $("#_BasicSalary").val('@string.Format("{0:#,0.00}", ViewBag.BasicSalary)')

                    $("#NetAmount").val('@string.Format("{0:#,0.00}", ViewBag.NetAmount)')
                    $("#_NetAmount").val('@string.Format("{0:#,0.00}", ViewBag.NetAmount)')
                }

                if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.Stage' == 6) {
                    var max_ = document.getElementById("MaxAllowedDeduction").value;
                    var max =  parseFloat(max_);
                    document.getElementById("MaxAllowedDeduction").value = max.toLocaleString();

                    var reqdct = '@ViewBag.RequiredDeduction';
                    var reqDed =  parseFloat(reqdct);
                    document.getElementById("RequiredDeduction").value = reqDed.toLocaleString();
                }

                if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.Stage' == 5) {
                    var loanApplicationId = '@ViewBag.LoanApplicationId';
                    var collateralRegistrationNo = '@ViewBag.CollateralRegistrationNo';
                    var url = '@Url.Action("viewLoanCollateral", "LoanApplication")';
                    $.ajax({
                        data: { "LoanApplicationId": loanApplicationId, "CollateralRegistrationNo" : collateralRegistrationNo},
                        type: 'GET',
                        dataType: "json",
                        url: url,
                        success: function (response) {
                            if (response.message == "Success") {
                                UpdateCollateralTable(response.data)
                            }
                        }
                    });

                    var url = '@Url.Action("countLoanCollateral", "LoanApplication")';
                    var loanApplicationId = '@ViewBag.LoanApplicationId';
                    var collateralRegistrationNo = '@ViewBag.CollateralRegistrationNo';
                    $.ajax({
                        type: "GET",
                        data: { "LoanApplicationId": loanApplicationId, "CollateralRegistrationNo" : collateralRegistrationNo},
                        dataType: "json",
                        url: url,
                        success: function (response) {
                            if (response.message == "Success") {
                                $("#countLoanCollateral").text(response.data);
                                document.getElementById("countLoanCollateral").style.fontWeight = 'bold';
                                document.getElementById("countLoanCollateral").style.fontSize ="15px";
                            }
                        }
                    })
                }

                if ('@ViewBag.LoanApplicationId' != 0 && ('@ViewBag.Stage' == 5 || '@ViewBag.Stage' == 6 || '@ViewBag.Stage' == 7)) {
                    var loanApplicationId = '@ViewBag.LoanApplicationId';
                    var url = '@Url.Action("viewLoanEndorsement", "LoanApplication")';
                    $.ajax({
                        data: { "LoanApplicationId": loanApplicationId},
                        type: 'GET',
                        dataType: "json",
                        url: url,
                        success: function (response) {
                            if (response.message == "Success") {
                                UpdateTable(response.data);
                                document.getElementById("countLoanEndorsement").style.fontWeight = 'bold';
                                document.getElementById("countLoanEndorsement").style.fontSize ="15px";
                            }
                        }
                    });
                }

                if ('@ViewBag.LoanApplicationId' != 0) {
                    var loanProductId =  document.getElementById("LoanProductId").value;
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetLoanProduct", "Setting")/?loanProductId=' + loanProductId,
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            if (data.toString().toUpperCase() == '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()') {
                                $(".SubProductQuantity").show();
                                document.getElementById("QuantityData").value = '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()';
                            }
                            else if (data.toString().toUpperCase() == '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()') {
                                $(".SubProductQuantity").show();
                                document.getElementById("QuantityData").value = '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()';
                            }else{
                                $(".SubProductQuantity").hide();
                                document.getElementById("QuantityData").value ='';
                            }
                        }
                    })
                }

            })

            function CalculateEMIDeduction (){
                if ('@ViewBag.LoanApplicationId' != 0) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetEmi", "LoanApplication")/?loanApplicationId=' + '@ViewBag.LoanApplicationId',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            if(data.status == "Success"){

                                var maxAllowedDeduction1 = document.getElementById("MaxAllowedDeduction").value;
                                var maxAllowedDeduction2 =  maxAllowedDeduction1.split(',').join('');

                                if(parseFloat(data.data) > parseFloat(maxAllowedDeduction2)){
                                    document.getElementById("saveCollateralForm").disabled = true;
                                    document.getElementById("RequiredDeduction").style.color = 'red';
                                    swal("Required Deduction Exceed Maximum Allowed Deduction,Contact Administrator to configure EMI Settings!", { icon: "warning" });
                                    return false;

                                }else{
                                    document.getElementById("saveCollateralForm").disabled = false;
                                    document.getElementById("RequiredDeduction").style.color = '';
                                    $("#RequiredDeduction").val(data.data.toLocaleString());
                                }

                            }
                            else{
                                swal("Contact Administrator to add EMI Settings!", { icon: "warning" });
                                return false;
                            }
                        }
                    })
                }
                else{
                    swal("Please fill all Applicant and Loan Informations First!", { icon: "warning" });
                    return false;
                }
            }

            function CheckNegative(){
                var requiredDeduction1 = document.getElementById("RequiredDeduction").value;

                var requiredDeduction2 =  requiredDeduction1.split(',').join('');

                if(parseFloat(requiredDeduction2) <= 0){
                    document.getElementById("saveCollateralForm").disabled = true;
                    document.getElementById("RequiredDeduction").style.color = 'red';
                    swal("Required Deduction should not be Negative or Zero!", { icon: "warning" });
                }else{

                    var maxAllowedDeduction1 = document.getElementById("MaxAllowedDeduction").value;
                    var maxAllowedDeduction2 =  maxAllowedDeduction1.split(',').join('');

                    if(parseFloat(requiredDeduction2) > parseFloat(maxAllowedDeduction2)){
                        document.getElementById("saveCollateralForm").disabled = true;
                        document.getElementById("RequiredDeduction").style.color = 'red';
                        swal("Required Deduction Exceed Maximum Allowed Deduction!", { icon: "warning" });
                        return false;
                    }else{
                        document.getElementById("saveCollateralForm").disabled = false;
                        document.getElementById("RequiredDeduction").style.color = '';
                        $("#RequiredDeduction").val(requiredDeduction2);
                    }

                }
            }

            function validateSalarySlipYear(){
                var SalarySlipYear = document.getElementById("SalarySlipYear").value;
                current_date = new Date()

                if(parseFloat(SalarySlipYear) > parseFloat(current_date.getFullYear())){
                    document.getElementById("saveCollateralForm").disabled = true;
                    document.getElementById("SalarySlipYear").style.color = 'red';

                    document.getElementById("errorSalarySlip").style.color = 'red';
                    document.getElementById("errorSalarySlip").style.fontWeight = 'bold';
                    $("#errorSalarySlip").text("Invalid Year");
                }else{
                    /*
                    var current_date = new Date()
                    var currentMonth = current_date.getMonth();

                    var getMonth = document.getElementById("SalarySlipMonth");
                    var salaryslipMonth = getMonth.options[getMonth.selectedIndex].value;

                    if(salaryslipMonth > currentMonth){
                        document.getElementById("saveCollateralForm").disabled = true;
                        document.getElementById("SalarySlipYear").style.color = 'red';

                        document.getElementById("errorSalarySlip").style.color = 'red';
                        document.getElementById("errorSalarySlip").style.fontWeight = 'bold';
                        $("#errorSalarySlip").text("Invalid Month");
                    }
                    else{
                        document.getElementById("saveCollateralForm").disabled = false;
                        document.getElementById("SalarySlipYear").style.color = 'black';
                        $("#errorSalarySlip").text("");
                    }
                    */

                    document.getElementById("saveCollateralForm").disabled = false;
                    document.getElementById("SalarySlipYear").style.color = 'black';
                    $("#errorSalarySlip").text("");
                }
            }

            //START OF CODE
            //SHOW LOADER ICON
            $(document).ajaxStart(function () {
                $(".loadingImg").show();

            });
            //HIDE LOADER ICON
            $(document).ajaxStop(function () {
                $(".loadingImg").hide();
            });

            function ToJavaScriptDate(value) {
                var pattern = /Date\(([^)]+)\)/;
                var results = pattern.exec(value);
                var dt = new Date(parseFloat(results[1]));
                return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear();
            }

            var basicSalary = null;
            var getNetAmount = null;

            var netAmount = null;

            function computeBasicSalary() {
                basicSalary = $("#_BasicSalary").val();
                var computation = parseFloat(basicSalary.toString().split(",").join("")) * 1/3;
            }


            function updateDeduction(){
                basicSalary = $("#_BasicSalary").val();
                var netAmount = $("#_NetAmount").val();

                netAmount = netAmount.split(',').join('');

                var bSalary = basicSalary.split(',').join('');
                var finalSalary = parseFloat(bSalary);

                var computedAmount = finalSalary * 1/3;

                var nAmount = netAmount.split(',').join('');
                var finalAmount = parseFloat(nAmount);


                var differenceAmount = finalAmount - computedAmount;
                $("#MaxAllowedDeduction").val(differenceAmount.toLocaleString());

                if(finalAmount > finalSalary){
                    document.getElementById("saveCollateralForm").disabled = true;
                    document.getElementById("NetAmount").style.color = 'red';
                    swal("Net Amount Exceed Basic Salary!", { icon: "warning" });
                    return false;
                }else{
                    document.getElementById("saveCollateralForm").disabled = false;
                    document.getElementById("NetAmount").style.color = '';
                }
            }

            function checkDeduction(){
                basicSalary = $("#_BasicSalary").val();
                var getBasicSalary = document.getElementById("BasicSalary").value;
                var getNetAmount = document.getElementById("NetAmount").value;
                var computedAmount = getBasicSalary * 1/3;

                var netAmount = $("#_NetAmount").val();
                var differenceAmount = parseFloat(getNetAmount) - parseFloat(computedAmount);

                netAmount = netAmount.split(',').join('');

                var differenceAmount = netAmount - computedAmount;

                var diffAmount = differenceAmount;
                $("#MaxAllowedDeduction").val(differenceAmount.toLocaleString());

                var bSalary = basicSalary.split(',').join('');
                var finalSalary = parseFloat(bSalary);

                var nAmount = netAmount.split(',').join('');
                var finalAmount = parseFloat(nAmount);

                if(finalAmount > finalSalary){
                    document.getElementById("saveCollateralForm").disabled = true;
                    document.getElementById("NetAmount").style.color = 'red';
                    swal("Net Amount Exceed Basic Salary!", { icon: "warning" });
                    return false;
                }else{
                    document.getElementById("saveCollateralForm").disabled = false;
                    document.getElementById("NetAmount").style.color = '';
                }
            }

            $(document).ready(function(){
                if ('@ViewBag.MaritalStatus' == "Married") {
                    $("#CustomerTypeHolder").show();
                    $(".spouseInfo").show();
                    $(".titleAttachment").hide();
                }else{
                    $(".spouseInfo").hide();
                    $(".titleAttachment").show();
                }
            });


            function validateForm(formObj) {
                $(".loadingImg").show();
                formObj.submit.disabled = true;
                formObj.submit.value = 'Please Wait...';
                $(".saveLoader").toggle(true);
                successMessage = true;
                return true;
            }

            $(document).ready(function () {
                $("#dt_search_payee_wrapper .dt-toolbar").remove();
            });

            if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.LoanPurpose' != null && '@ViewBag.ApplyDate' != null){

                var dt_updated_payee = $('#dt_updated_payee').dataTable({
                    "data": [],
                    "columnDefs": [{
                        "targets": [0, 1],
                        "visible": false
                    }],
                    "columns": [
                        { title: "Payee DetailId" },
                        { title: "Payee BIC" },
                        { title: "Payee Name" },
                        { title: "Payee Code" },
                        { title: "Bank Name" },
                        { title: "Payee Type" },
                        { title: "Bank Account No" },
                        { title: "Address" },
                        { title: "" }
                    ]
                });

                $("#dt_updated_payee_wrapper .dt-toolbar").remove();
            }else{
                var dt_selected_payee = $('#dt_selected_payee').dataTable({
                    "data": [],
                    "columnDefs": [{
                        "targets": [0, 1],
                        "visible": false
                    }],
                    "columns": [
                        { title: "Payee DetailId" },
                        { title: "Payee BIC" },
                        { title: "Payee Name" },
                        { title: "Payee Code" },
                        { title: "Bank Name" },
                        { title: "Payee Type" },
                        { title: "Bank Account No" },
                        { title: "Address" },
                        { title: "" }
                    ]
                });

                $("#dt_selected_payee_wrapper .dt-toolbar").remove();
            }

            var dt_search_payee = $('#dt_search_payee').dataTable({
                "aoColumnDefs": [{ "bVisible": false, "aTargets": [1, 2] }],
            });

            $("#searchbox").on("keyup search input paste cut", function () {
                if (!this.value) {
                    dt_search_payee.fnClearTable();
                } else {
                    searchPayeeTableUpdate(this.value);
                }
            });

            function searchPayeeTableUpdate(search) {
                var url = '@Url.Action("GetPayee", "Setting")';
                $.ajax({
                    type: "get",
                    url: url + "/?search=" + search + "",
                    contenttype: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (response) {
                        data = response.data;
                        dt_search_payee.fnClearTable();
                        for (var i = 0; i < data.length; i++) {
                            dt_search_payee.fnAddData([i + 1,
                               data[i]["PayeeDetailId"],
                               data[i]["BIC"],
                               data[i]["AccountName"],
                               data[i]["PayeeCode"],
                               data[i]["BankName"],
                               data[i]["Accountnumber"],
                               data[i]["PayeeType"],
                               data[i]["Address1"],
                               '<a href="#" onclick="payeeClicked(' + i + ')"><i class="glyphicon glyphicon-plus-sign"></i></a>'
                            ]);
                        }
                    },
                    failure: function (error) {
                        swal(error);
                    }
                });
            }

            var selectedPayees = []
            var selectedPayeeIds = []

            function payeeClicked(rowId) {
                var data = dt_search_payee.DataTable().rows().data();
                var row = data[rowId];
                $("#PayeeDetailId").val(row[1]);
                $("#PayeeName").val(row[3]);
                if(!selectedPayeeIds.includes(row[1])){
                    selectedPayeeIds.push(row[1])
                    selectedPayees.push(row)

                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.LoanPurpose' != null && '@ViewBag.ApplyDate' != null){
                        updatedLoanPayeeTable()
                    }else{
                        updatePayeeTable()
                    }
                }
                $("#payeeModal").modal("hide");
            }

            function updatePayeeTable(){
                dt_selected_payee.fnClearTable();
                selectedPayees.forEach((row,index)=>{
                    dt_selected_payee.fnAddData([row[1],
                        row[2], row[3], row[4], row[5],
                        row[6], row[7], row[8],
                        '<a href="#" onclick="removePayee('+index+')"><i class="fa fa-trash-o"></i></a>'
                    ]);
                })
            }

            function updatedLoanPayeeTable(){
                dt_updated_payee.fnClearTable();
                selectedPayees.forEach((row,index)=>{
                    dt_updated_payee.fnAddData([row[1],
                        row[2], row[3], row[4], row[5],
                        row[6], row[7], row[8],
                        '<a href="#" onclick="removeLoanPayee('+index+')"><i class="fa fa-trash-o"></i></a>'
                    ]);
                })
            }

            function removeLoanPayee(index){
                selectedPayeeIds.splice(index,1)
                selectedPayees.splice(index,1)
                updatedLoanPayeeTable()
            }

            function removePayee(index){
                selectedPayeeIds.splice(index,1)
                selectedPayees.splice(index,1)
                updatePayeeTable()
            }
            // =========== END SEARCH PAYEE ====================

            function SearchPayee() {
                $('#payeeModal').modal('show');
            }
            //END OF CODE

            if ('@ViewBag.CustomerTypeCount' == 0) {
                swal("Customer Type not Found,Contact Administrator to add Customer Type", { icon: "warning" })
                                  .then((value) => {
                                      var url = '@Url.Action("LoanApplicationList", "LoanApplication")';
                                      window.location.replace(url);
                                  });
            }

            if ('@ViewBag.CollateralTypeCount' == 0) {
                swal("Collateral Type not Found,Contact Administrator to add Collateral Type", { icon: "warning" })
                                  .then((value) => {
                                      var url = '@Url.Action("LoanApplicationList", "LoanApplication")';
                                      window.location.replace(url);
                                  });
            }

            //MANAGE STEP WIZARD
            var navListItems = $('div.setup-panel div a'),
                   allWells = $('.setup-content'),
                   allNextBtn = $('.nextBtn');

            allWells.hide();

            navListItems.click(function (e) {
                e.preventDefault();
                var $target = $($(this).attr('href')),
                        $item = $(this);

                if (!$item.hasClass('disabled')) {
                    navListItems.removeClass('btn-primary').addClass('btn-default');
                    $item.addClass('btn-primary');
                    allWells.hide();
                    $target.show();
                    $target.find('input:eq(0)').focus();
                }
            });

            allNextBtn.click(function () {
                var curStep = $(this).closest(".setup-content"),
                    curStepBtn = curStep.attr("id"),
                    nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                    curInputs = curStep.find("input[type='text'],input[type='url']"),
                    isValid = true;

                $(".form-group").removeClass("has-error");
                for (var i = 0; i < curInputs.length; i++) {
                    if (!curInputs[i].validity.valid) {
                        isValid = false;
                        $(curInputs[i]).closest(".form-group").addClass("has-error");
                    }
                }

                if (isValid)
                    nextStepWizard.removeAttr('disabled').trigger('click');
            });

            $('div.setup-panel div a.btn-primary').trigger('click');
            //END MANAGE STEP WIZARD

            $(document).ready(function () {
                $(".saveLoader").toggle(false);
                document.getElementById("DistrictId").disabled = true;
                //document.getElementById("DivisionId").disabled = true;
                document.getElementById("WardId").disabled = true;

                document.getElementById("CollateralDistrictId").disabled = true;
                //document.getElementById("CollateralDivisionId").disabled = true;
                document.getElementById("CollateralWardId").disabled = true;

                document.getElementById("CollateralDistrictId2").disabled = true;
                //document.getElementById("CollateralDivisionId2").disabled = true;
                document.getElementById("CollateralWardId2").disabled = true;

                document.getElementById("OrganisationDistrictId").disabled = true;
                //document.getElementById("OrganisationDivisionId").disabled = true;
                document.getElementById("OrganisationWardId").disabled = true;

                document.getElementById("LoanSubProductId").disabled = true;
                document.getElementById("CollateralUsageId").disabled = true;
                document.getElementById("GuarantorshipDistrictId").disabled = true;
                document.getElementById("CollateralUsageId2").disabled = true;

                if ('@ViewBag.CollateralOwner' != "0")
                {
                    $(".normalOwnerCollateral").show();
                }else{
                    $(".normalOwnerCollateral").hide();
                }

                $("#RegionId").change(function () {
                    //$('#DivisionId').val('');
                    //$('#DivisionId').change();

                    $('#WardId').val('');
                    $('#WardId').change();

                    $('#DistrictId').val('');
                    $('#DistrictId').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var region = $(this).val();
                    //document.getElementById("DivisionId").value = "";
                    document.getElementById("WardId").value = "";
                    //document.getElementById("DivisionId").disabled = true;
                    document.getElementById("WardId").disabled = true;
                    document.getElementById("DistrictId").disabled = false;
                    getDistricts(region);
                });

                $("#DistrictId").change(function () {
                    //$('#DivisionId').val('');
                    //$('#DivisionId').change();

                    $('#WardId').val('');
                    $('#WardId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var district = $(this).val();
                    document.getElementById("WardId").disabled = false;
                    getWards(district);
                });

                @*$("#DivisionId").change(function () {

                    $('#WardId').val('');
                    $('#WardId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var division = $(this).val();
                    document.getElementById("WardId").disabled = false;
                    getWards(division);
                });*@

                //End Spouse Information
                //Collateral Information
                $("#CollateralRegionId").change(function () {
                    //$('#CollateralDivisionId').val('');
                    //$('#CollateralDivisionId').change();

                    $('#CollateralWardId').val('');
                    $('#CollateralWardId').change();

                    $('#CollateralDistrictId').val('');
                    $('#CollateralDistrictId').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var region = $(this).val();
                    //document.getElementById("CollateralDivisionId").value = "";
                    document.getElementById("CollateralWardId").value = "";
                    //document.getElementById("CollateralDivisionId").disabled = true;
                    document.getElementById("CollateralWardId").disabled = true;
                    document.getElementById("CollateralDistrictId").disabled = false;
                    getCollateralDistricts(region);
                });

                $("#CollateralDistrictId").change(function () {

                    /*$('#CollateralDivisionId').val('');
                    $('#CollateralDivisionId').change();*/

                    $('#CollateralWardId').val('');
                    $('#CollateralWardId').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var district = $(this).val();
                    document.getElementById("CollateralWardId").disabled = false;
                    getCollateralWards(district);
                });

                /*$("#CollateralDivisionId").change(function () {

                    $('#CollateralWardId').val('');
                    $('#CollateralWardId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var division = $(this).val();
                    document.getElementById("CollateralWardId").disabled = false;
                    getCollateralWards(division);
                });*/


                $("#CollateralRegionId2").change(function () {

                    $('#CollateralDistrictId2').val('');
                    $('#CollateralDistrictId2').change();

                    /*$('#CollateralDivisionId2').val('');
                    $('#CollateralDivisionId2').change();*/

                    $('#CollateralWardId2').val('');
                    $('#CollateralWardId2').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var region = $(this).val();
                    //document.getElementById("CollateralDivisionId2").value = "";
                    document.getElementById("CollateralWardId2").value = "";
                    //document.getElementById("CollateralDivisionId2").disabled = true;
                    document.getElementById("CollateralWardId2").disabled = true;
                    document.getElementById("CollateralDistrictId2").disabled = false;
                    getAddCollateralDistricts(region);
                });

                $("#CollateralDistrictId2").change(function () {

                    /*$('#CollateralDivisionId2').val('');
                    $('#CollateralDivisionId2').change();*/

                    $('#CollateralWardId2').val('');
                    $('#CollateralWardId2').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var district = $(this).val();
                    document.getElementById("CollateralWardId2").disabled = false;
                    getAddCollateralWards(district);
                });

                /*$("#CollateralDivisionId2").change(function () {
                    $('#CollateralWardId2').val('');
                    $('#CollateralWardId2').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var division = $(this).val();
                    document.getElementById("CollateralWardId2").disabled = false;
                    getAddCollateralWards(division);
                });*/
                ////End Collateral Information
                //Organisation Information
                $("#OrganisationRegionId").change(function () {

                    $('#OrganisationDistrictId').val('');
                    $('#OrganisationDistrictId').change();

                    /*$('#OrganisationDivisionId').val('');
                    $('#OrganisationDivisionId').change();*/

                    $('#OrganisationWardId').val('');
                    $('#OrganisationWardId').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var region = $(this).val();
                    //document.getElementById("OrganisationDivisionId").value = "";
                    document.getElementById("OrganisationWardId").value = "";
                    //document.getElementById("OrganisationDivisionId").disabled = true;
                    document.getElementById("OrganisationWardId").disabled = true;
                    document.getElementById("OrganisationDistrictId").disabled = false;
                    getOrganisationDistricts(region);
                });

                $("#OrganisationDistrictId").change(function () {
                    /*$('#OrganisationDivisionId').val('');
                    $('#OrganisationDivisionId').change();*/

                    $('#OrganisationWardId').val('');
                    $('#OrganisationWardId').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var district = $(this).val();
                    document.getElementById("OrganisationWardId").disabled = false;
                    getOrganisationWards(district);
                });

               /* $("#OrganisationDivisionId").change(function () {

                    $('#OrganisationWardId').val('');
                    $('#OrganisationWardId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var division = $(this).val();
                    document.getElementById("OrganisationWardId").disabled = false;
                    getOrganisationWards(division);
                });*/
                //End Organisation Information

                //Guarantorship Information
                $("#GuarantorshipRegionId").change(function () {

                    $('#GuarantorshipDistrictId').val('');
                    $('#GuarantorshipDistrictId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var region = $(this).val();

                    document.getElementById("GuarantorshipDistrictId").disabled = false;
                    getGuarantorshipDistricts(region);
                });


                function getGuarantorshipDistricts(region) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select District</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#GuarantorshipDistrictId").html(option);
                        }
                    })
                }
                //End Guarantorship Information

                //Loan Product
                $("#LoanProductId").change(function () {
                    $('#LoanSubProductId').val('');
                    $('#LoanSubProductId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var loanProductId = $(this).val();
                    document.getElementById("LoanSubProductId").value = "";
                    document.getElementById("LoanSubProductId").disabled = false;
                    getLoanSubProduct(loanProductId);
                    getLoanProduct(loanProductId);
                });

                //End Loan Product
                //Collateral Usage
                $("#CollateralTypeId").change(function () {

                    $('#CollateralUsageId').val('');
                    $('#CollateralUsageId').change();

                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var collateralTypeId = $(this).val();
                    if(collateralTypeId == "Select Collateral Type"){
                        document.getElementById("CollateralUsageId").value = "";
                        document.getElementById("CollateralUsageId").disabled = true;
                    }
                    if(collateralTypeId.toUpperCase() != "SALARY"){
                        document.getElementById("CollateralUsageId").value = "";
                        document.getElementById("CollateralUsageId").disabled = false;
                        if(collateralTypeId != "Select Collateral Type"){
                            getCollateralUsage(collateralTypeId);
                        }

                    }

                    if(collateralTypeId.toUpperCase() != "GUARANTORSHIP"){
                        document.getElementById("CollateralUsageId").value = "";
                        document.getElementById("CollateralUsageId").disabled = false;
                        if(collateralTypeId != "Select Collateral Type"){
                            getCollateralUsage(collateralTypeId);
                        }
                    }

                });


                $("#CollateralTypeId2").change(function () {

                    $('#CollateralUsageId2').val('');
                    $('#CollateralUsageId2').change();
                    $(document).ajaxStart(function () {
                        $(".loadingImg").hide();
                    });
                    var collateralTypeId = $(this).val();

                    if(collateralTypeId == "Select Collateral Type"){
                        document.getElementById("CollateralUsageId2").value = "";
                        document.getElementById("CollateralUsageId2").disabled = true;
                    }
                    if(collateralTypeId.toUpperCase() != "SALARY"){
                        document.getElementById("CollateralUsageId2").value = "";
                        document.getElementById("CollateralUsageId2").disabled = false;
                        if(collateralTypeId != "Select Collateral Type"){
                            getCollateralUsage2(collateralTypeId);
                        }

                    }

                    if(collateralTypeId.toUpperCase() != "GUARANTORSHIP"){
                        document.getElementById("CollateralUsageId2").value = "";
                        document.getElementById("CollateralUsageId2").disabled = false;
                        if(collateralTypeId != "Select Collateral Type"){
                            getCollateralUsage2(collateralTypeId);
                        }

                    }

                });

                //End Collateral Usage

                function getDistricts(region) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select District</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#DistrictId").html(option);
                        }
                    })
                }

                @*function getDivisions(district) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Division</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#DivisionId").html(option);
                        }
                    })
                }*@

                function getWards(district) {
                    var option = [];
                     $('#WardId').val('');
                    $('#WardId').change();
                    $.ajax({
                        url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Ward</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#WardId").html(option);
                        }
                    })
                }

                //Collateral Information
                function getCollateralDistricts(region) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select District</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralDistrictId").html(option);
                        }
                    })
                }

                @*function getCollateralDivisions(district) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Division</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralDivisionId").html(option);
                        }
                    })
                }*@

                function getCollateralWards(district) {
                    var option = [];
                    $('#CollateralWardId').val('');
                    $('#CollateralWardId').change();
                    $.ajax({
                        url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Ward</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralWardId").html(option);
                        }
                    })
                }


                function getAddCollateralDistricts(region) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select District</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralDistrictId2").html(option);
                        }
                    })
                }

                @*function getAddCollateralDivisions(district) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Division</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralDivisionId2").html(option);
                        }
                    })
                }*@

                function getAddCollateralWards(district) {
                    var option = [];
                    $('#CollateralWardId2').val('');
                    $('#CollateralWardId2').change();
                    $.ajax({
                        url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Ward</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralWardId2").html(option);
                        }
                    })
                }
                //End Collateral Information
                //Organisation Information
                function getOrganisationDistricts(region) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select District</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#OrganisationDistrictId").html(option);
                        }
                    })
                }

                @*function getOrganisationDivisions(district) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Division</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#OrganisationDivisionId").html(option);
                        }
                    })
                }*@

                function getOrganisationWards(district) {
                    var option = [];
                    $('#OrganisationWardId').val('');
                    $('#OrganisationWardId').change();
                    $.ajax({
                        url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Ward</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#OrganisationWardId").html(option);
                        }
                    })
                }
                //End Organisation Information

                //start collateral usage
                function getCollateralUsage(collateralTypeId) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetCollateralUsage", "Setting")/?collateralTypeId=' + collateralTypeId + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Collateral Usage</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralUsageId").html(option);
                        }
                    })
                }

                function getCollateralUsage2(collateralTypeId) {
                    var option = [];
                    $.ajax({
                        url: '@Url.Action("GetCollateralUsage", "Setting")/?collateralTypeId=' + collateralTypeId + '',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            option.push('<option value="">Select Collateral Usage</option>');
                            data.forEach(d=> {
                                option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                            });
                            option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                            $("#CollateralUsageId2").html(option);
                        }
                    })
                }
                //end collateral usage
            });


            $(".applicationInfo").hide();
            $(".spouseInfo").hide();
            $(".institutionInfo").hide();

            function AddEndorsement() {
                $('#AddEndorsementModal').modal('show');
            }

            function AddCollateral() {
                $('#AddCollateralModal').modal('show');
            }

            function AddManagement() {
                $('#AddManagementModal').modal('show');
            }

            $("#managementInfo").hide();
            $(".btnSaveBack").hide();

            $("#CustomerTypeHolder").show();

            $(".normalCollateral").hide();
            $(".salaryCollateral").hide();
            $(".guarantorshipCollateral").hide();
            $(".collateralUsage").hide();

            $(".management").hide();

            var customerType = document.getElementById("customerTypeId");

            var collateralType = document.getElementById("CollateralTypeId");

            var loanDeclaration = document.getElementById("LoanDeclaration");

            function CollateralTypeChange() {
                if (collateralType.value.toUpperCase() == "SALARY") {
                    if (customerType.value == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' || customerType.value == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()'
                        || customerType.value == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()') {
                        $(".normalCollateral").hide();
                        $(".normalOwnerCollateral").hide();
                        $(".salaryCollateral").show();
                        $(".collateralUsage").hide();
                        $(".guarantorshipCollateral").hide();
                        $("#RequiredDeduction").val(0);
                    }
                    else if (collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CERTIFICATE_OCCUPANCY.ToUpper()'
                        || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.RESIDENTIAL_LICENCE.ToUpper()'
                        || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CUSTOMARY_OCCUPANCY.ToUpper()') {
                        $(".normalCollateral").show();
                        $(".normalOwnerCollateral").show();
                        $(".salaryCollateral").hide();
                        $(".collateralUsage").show();
                        $(".guarantorshipCollateral").hide();
                    }
                    else{
                        $(".normalCollateral").hide();
                        $(".normalOwnerCollateral").hide();
                        $(".salaryCollateral").hide();
                        $(".collateralUsage").hide();
                        $(".guarantorshipCollateral").hide();
                    }

                }  else if (collateralType.value.toUpperCase() == "GUARANTORSHIP") {
                    $(".guarantorshipCollateral").show();
                    $(".normalCollateral").hide();
                    $(".salaryCollateral").hide();
                    $(".collateralUsage").hide();
                    $(".normalOwnerCollateral").hide();
                }

                else if (collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CERTIFICATE_OCCUPANCY.ToUpper()'
                    || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.RESIDENTIAL_LICENCE.ToUpper()' || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CUSTOMARY_OCCUPANCY.ToUpper()') {
                    $(".normalCollateral").show();
                    $(".normalOwnerCollateral").show();
                    $(".salaryCollateral").hide();
                    $(".collateralUsage").show();
                    $(".guarantorshipCollateral").hide();
                }
                else {
                    $(".normalCollateral").show();
                    $(".salaryCollateral").hide();
                    $(".collateralUsage").show();
                    $(".guarantorshipCollateral").hide();
                }
            }

            /*START OF ON LOAD COLLATERAL*/
            if (collateralType.value.toUpperCase() == "SALARY") {
                if (customerType.value == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' || customerType.value == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()' || customerType.value == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()') {
                    $(".normalCollateral").hide();
                    $(".normalOwnerCollateral").hide();
                    $(".salaryCollateral").show();
                    $(".collateralUsage").hide();
                    $(".guarantorshipCollateral").hide();
                }
                else if (collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CERTIFICATE_OCCUPANCY.ToUpper()' || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.RESIDENTIAL_LICENCE.ToUpper()' || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CUSTOMARY_OCCUPANCY.ToUpper()') {
                    $(".normalCollateral").show();
                    $(".normalOwnerCollateral").show();
                    $(".salaryCollateral").hide();
                    $(".collateralUsage").show();
                    $(".guarantorshipCollateral").hide();
                }
                else{
                    $(".normalCollateral").hide();
                    $(".normalOwnerCollateral").hide();
                    $(".salaryCollateral").hide();
                    $(".collateralUsage").hide();
                    $(".guarantorshipCollateral").hide();
                }

            }  else if (collateralType.value.toUpperCase() == "GUARANTORSHIP") {
                $(".guarantorshipCollateral").show();
                $(".normalCollateral").hide();
                $(".salaryCollateral").hide();
                $(".collateralUsage").hide();
                $(".normalOwnerCollateral").hide();
            }

            else if (collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CERTIFICATE_OCCUPANCY.ToUpper()' || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.RESIDENTIAL_LICENCE.ToUpper()' || collateralType.value.toUpperCase() == '@IFMIS.Libraries.Constants.CUSTOMARY_OCCUPANCY.ToUpper()') {
                $(".normalCollateral").show();
                $(".normalOwnerCollateral").show();
                $(".salaryCollateral").hide();
                $(".collateralUsage").show();
                $(".guarantorshipCollateral").hide();
            }
            else {
                $(".normalCollateral").show();
                $(".salaryCollateral").hide();
                $(".collateralUsage").show();
                $(".guarantorshipCollateral").hide();
            }
            /*END OF ON LOAD COLLATERAL*/
            $(".SubProductQuantity").hide();
            if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.LoanDeclaration' != null && ('@ViewBag.Quantity' != null && '@ViewBag.Quantity' != 0) ) {
                $(".SubProductQuantity").show();
            }
            //$(".loanDeclarationInfo").hide();

            function LoanDeclarationChange() {
                if (loanDeclaration.value.toUpperCase() != "PRIVATE" && loanDeclaration.value != null) {
                    $(".loanDeclarationInfo").show();
                } else {
                    $(".loanDeclarationInfo").hide();
                }
            }
            if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.LoanDeclaration' != null && '@ViewBag.LoanDeclaration' != "Private") {
                $(".loanDeclarationInfo").show();
            }


            if ('@ViewBag.LoanApplicationId' != 0 && ('@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' || '@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()' || '@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()') ) {
                $(".applicationInfo").show();
                $(".btnSaveBack").show();
                $(".institutionInfo").hide();
            }

            if ('@ViewBag.LoanApplicationId' != 0 &&  ('@ViewBag.CustomerTypeLabel' != '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' && '@ViewBag.CustomerTypeLabel' != '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()' && '@ViewBag.CustomerTypeLabel' != '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()')) {
                $(".institutionInfo").show();
                $(".applicationInfo").hide();
                $(".management").show();
                $("#managementInfo").show();
                $(".btnSaveBack").show();
            }


            if ('@ViewBag.Stage' == 5) {
                $(".normalCollateral").show();
                $(".salaryCollateral").hide();
                $(".guarantorshipCollateral").hide();
            }

            if ('@ViewBag.Stage' == 6) {
                $(".salaryCollateral").show();
                $(".normalCollateral").hide();
                $(".collateralUsage").hide();
                $(".guarantorshipCollateral").hide();
            }

            if ('@ViewBag.Stage' == 7) {
                $(".salaryCollateral").hide();
                $(".normalCollateral").hide();
                $(".collateralUsage").hide();
                $(".guarantorshipCollateral").show();
            }
            var globalCustomer = null;

            function CustomerTypeChange() {

                $("#CustomerTypeHolder").show();
                globalCustomer = document.getElementById("Customers").value = customerType.value;
                if (customerType.value == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' || customerType.value == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()' || customerType.value == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()') {
                    $(".applicationInfo").show();
                    $(".spouseInfo").hide();
                    $(".institutionInfo").hide();
                    $(".management").hide();
                    $("#managementInfo").hide();
                    $(".btnSaveBack").show();

                }
                else {
                    $(".applicationInfo").hide();
                    $(".spouseInfo").hide();
                    $(".management").show();
                    $("#managementInfo").show();
                    if (customerType.value == "") {
                        $(".institutionInfo").hide();
                        $(".management").hide();
                    } else {
                        $(".institutionInfo").show();
                        $(".management").show();
                        $("#managementInfo").show();
                    }
                    $(".btnSaveBack").show();
                }
            }


            function getLoanSubProduct(loanProductId,customerLabel) {
                if ('@ViewBag.LoanApplicationId' != 0) {
                    globalCustomer = '@ViewBag.CustomerTypeLabel';
                }
                var option = [];
                $.ajax({
                    url: '@Url.Action("GetLoanSubProduct", "Setting")/?loanProductId=' + loanProductId + '&&customerLabel='+globalCustomer,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        option.push('<option value="">Select Loan Sub Product</option>');
                        data.forEach(d=> {
                            option.push('<option value=' + d["LoanSubProductId"] + '>' + d["SubProductName"] + '</option>');
                        });
                        option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                        $("#LoanSubProductId").html(option);
                    }
                })
            }

            function getLoanProduct(loanProductId) {

                var option = [];
                $.ajax({
                    url: '@Url.Action("GetLoanProduct", "Setting")/?loanProductId=' + loanProductId,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        if (data.toString().toUpperCase() == '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()') {
                            $(".SubProductQuantity").show();
                            document.getElementById("QuantityData").value = '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()';
                        }
                        else if (data.toString().toUpperCase() == '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()') {
                            $(".SubProductQuantity").show();
                            document.getElementById("QuantityData").value = '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()';
                        }else{
                            $(".SubProductQuantity").hide();
                            document.getElementById("QuantityData").value ='';
                        }
                    }
                })
            }
            var maritalStatus = document.getElementById("MaritalStatus");
            function maritalStatusChange() {
                $("#CustomerTypeHolder").show();
                if (maritalStatus.value == "Married") {
                    $(".spouseInfo").show();
                    $(".titleAttachment").hide();
                }
                else {
                    $(".spouseInfo").hide();
                    $(".titleAttachment").show();
                }
            }


            function saveForm() {
                var customerType = document.getElementById("customerTypeId");
                var CustomerTypeLabel = customerType.value;
                if (customerType.value == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()'
                    || customerType.value == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()'
                    || customerType.value == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()') {

                    var CustomerName = $("#CustomerName").val();
                    var Occupation = $("#Occupation").val();
                    var WardId = $("#WardId").val();
                    var status = $("#Status").val();
                    var Gender = $("#Gender").val();
                    var MaritalStatus = $("#MaritalStatus").val();
                    var DateOfBirth = $("#DateOfBirth").val();
                    var Email = $("#Email").val();
                    var PhoneNo = $("#PhoneNo").val();
                    var PhysicalAddress = $("#PhysicalAddress").val();
                    var Location = $("#Location").val();
                    var PhotoUrl = $("#PhotoUrl").val();
                    var Village = $("#Village").val();
                    var Hamlet = $("#Hamlet").val();
                    var PlotNo = $("#PlotNo").val();
                    var TinNo = $("#TinNo").val();
                    var Fax = $("#Fax").val();
                    var CustomerTypeLabel = customerType.value;
                    var CategoryNo = $("#CategoryNo").val();
                    var RegionId = $("#RegionId").val();

                    if ('@ViewBag.LoanApplicationId' != 0 && DateOfBirth == '') {
                        DateOfBirth = '@ViewBag.DateOfBirth';
                    }

                    if(PhoneNo != null){
                        if (PhoneNo.toString().length != 10 || PhoneNo < 0 || PhoneNo == 0) {
                            swal("Please Enter Valid Applicant Phone Number");
                            return false;
                        }
                    }

                    if (maritalStatus.value == "Married") {
                        var SpouseName = $("#SpouseName").val();
                        var SpouseDateOfBirth = $("#SpouseDateOfBirth").val();
                        var SpouseOccupation = $("#SpouseOccupation").val();
                        //var SpouseWardId = $("#SpouseWardId").val();
                        var SpouseEmail = $("#SpouseEmail").val();
                        var SpousePhoneNumber = $("#SpousePhoneNumber").val();
                        var SpousePhysicalAddress = $("#SpousePhysicalAddress").val();
                        var SpouseLocation = $("#SpouseLocation").val();
                        var SpousePhotoUrl = $("#SpousePhotoUrl").val();
                        var SpousePlotNo = $("#SpousePlotNo").val();
                        // var SpouseFax = $("#SpouseFax").val();
                        //var SpouseHamlet = $("#SpouseHamlet").val();
                        //var SpouseVillage = $("#SpouseVillage").val();

                        if(SpousePhoneNumber != null){
                            if (SpousePhoneNumber.toString().length != 10 || SpousePhoneNumber < 0 || SpousePhoneNumber == 0) {
                                swal("Please Enter Valid Spouse Phone Number");
                                return false;
                            }
                        }

                        if ('@ViewBag.LoanApplicationId' != 0 && (SpousePhotoUrl == '' || SpousePhotoUrl ==  null)) {
                            SpousePhotoUrl = '@ViewBag.SpousePhotoUrl';
                        }else{
                            SpousePhotoUrl = document.getElementById("SpousePhotoUrl").value;
                            var file = document.querySelector("#SpousePhotoUrl");
                            if ( /\.(jpe?g|png|gif)$/i.test(file.files[0].name) === false ) {
                                swal("Please Upload Spouse Photo");
                                return false;
                            }
                        }

                        if ('@ViewBag.LoanApplicationId' != 0 && SpouseDateOfBirth == '') {
                            SpouseDateOfBirth = '@ViewBag.SpouseDateOfBirth';
                        }

                        if (SpouseName == '' || SpouseDateOfBirth == '' || SpouseOccupation == '' || SpousePhysicalAddress == '' || SpousePhoneNumber == '' || SpouseLocation == '' || SpousePlotNo == '' || SpousePhotoUrl == '' ) {
                            var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                            swal("Please Fill All the required Fields");
                            return false;
                        }

                        if ('@ViewBag.LoanApplicationId' == 0) {
                            var file = document.querySelector("#SpousePhotoUrl");
                            if ( /\.(jpe?g|png|gif)$/i.test(file.files[0].name) === false ) {
                                swal("Please Upload Spouse Photo");
                                return false;
                            }
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseName) == false) {
                            swal("Special Characters for Spouse Full Name are not allowed");
                            return false;
                        }


                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseOccupation) == false) {
                            swal("Special Characters for Spouse Principal Activity are not allowed");
                            return false;
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpousePhysicalAddress) == false) {
                            swal("Special Characters for Spouse Physical Address are not allowed");
                            return false;
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseLocation) == false) {
                            swal("Special Characters for Spouse Location are not allowed");
                            return false;
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpousePlotNo) == false) {
                            swal("Special Characters for Spouse Plot No are not allowed");
                            return false;
                        }

                        /*if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseFax) == false) {
                            swal("Special Characters for Spouse Fax are not allowed");
                            return false;
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseHamlet) == false) {
                            swal("Special Characters for Spouse Hamlet are not allowed");
                            return false;
                        }

                        if (/^[a-zA-Z0-9\-_'\s]*$/.test(SpouseVillage) == false) {
                            swal("Special Characters for Spouse Village are not allowed");
                            return false;
                        }*/

                    }
                    else{
                        var IndividualAttachmentUrl = $("#IndividualAttachmentUrl").val();

                        if ('@ViewBag.LoanApplicationId' != 0 && IndividualAttachmentUrl == '') {
                            IndividualAttachmentUrl = '@ViewBag.IndividualAttachmentUrl';
                        }
                        else{
                            if(IndividualAttachmentUrl == ''){
                                 swal("Please Upload Affidavit (PDF Format is Required)")
                                return false;
                            }
                            var file = document.querySelector("#IndividualAttachmentUrl");
                            if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                                 swal("Please Upload Affidavit (PDF Format is Required)")
                                return false;
                            }
                        }
                    }


                    if ('@ViewBag.LoanApplicationId' != 0 && (PhotoUrl == '' || PhotoUrl ==  null)) {
                        PhotoUrl = '@ViewBag.IndividualPhotoUrl';
                    }else{
                        PhotoUrl = document.getElementById("PhotoUrl").value;
                        var file = document.querySelector("#PhotoUrl");
                        if ( /\.(jpe?g|png|gif)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Applicant Photo");
                            return false;
                        }
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && DateOfBirth == '') {
                        DateOfBirth = '@ViewBag.DateOfBirth';
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && MaritalStatus == '') {
                        MaritalStatus = '@ViewBag.MaritalStatus';
                    }

                    if (CustomerName == '' || Occupation == '' || Gender == '' || MaritalStatus == ''
                        || DateOfBirth == '' || WardId == '' || PhoneNo == '' || PhysicalAddress == ''
                        || Location == '' || Village == '' || Hamlet == '' || PhotoUrl == '' || TinNo == ''
                        || PlotNo == '' || CategoryNo == '' || CategoryNo == 'Select Category') {
                        var url = '@Url.Action("CreateLoanCustomer", "LoanCustomer")';
                        swal("Please Fill All the required Fields");
                        return false;
                    }

                    if ('@ViewBag.LoanApplicationId' == 0) {
                        var file = document.querySelector("#PhotoUrl");
                        if ( /\.(jpe?g|png|gif)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Applicant Photo");
                            return false;
                        }
                    }


                    if(CategoryNo == "TinNo"){
                        if(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{3})$/.test(TinNo) == false){
                            swal("Please Enter Valid Tin Number, Example Format XXX-XXX-XXX or 9 Digits without Hyphen(-)");
                            return false;
                        }
                    }

                    if(CategoryNo == "NationalIDNo"){
                        if(/^\(?([0-9]{8})\)?[- ]?([0-9]{5})[- ]?([0-9]{5})[- ]?([0-9]{2})$/.test(TinNo) == false){
                            swal("Please Enter Valid National ID, Example Format XXXXXXXX-XXXXX-XXXXX-XX or 20 Digits without Hyphen(-)");
                            return false;
                        }
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(CustomerName) == false) {
                        swal("Special Characters for Full Name are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(Occupation) == false) {
                        swal("Special Characters for Principal Activity are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(PhysicalAddress) == false) {
                        swal("Special Characters for Physical Address are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(Location) == false) {
                        swal("Special Characters for Location are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(Village) == false) {
                        swal("Special Characters for Village are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(Hamlet) == false) {
                        swal("Special Characters for Hamlet are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(PlotNo) == false) {
                        swal("Special Characters for Plot No are not allowed");
                        return false;
                    }

                    if(Fax != ''){
                        if (/^[a-zA-Z0-9\-_\s]*$/.test(Fax) == false) {
                            swal("Special Characters for Fax are not allowed");
                            return false;
                        }
                    }


                    if (/^[a-zA-Z0-9\-_\s]*$/.test(TinNo) == false) {
                        swal("Special Characters for Tin No  are not allowed");
                        return false;
                    }

                    var formData = new FormData()
                    formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formData.append('CustomerType', CustomerTypeLabel);
                    formData.append('CustomerName', CustomerName);
                    formData.append('Occupation', Occupation);
                    formData.append('WardId', WardId);
                    formData.append('Gender', Gender);
                    formData.append('MaritalStatus', MaritalStatus);
                    formData.append('DateOfBirth', DateOfBirth);
                    formData.append('Email', Email);
                    formData.append('PhoneNo', PhoneNo);
                    formData.append('PhysicalAddress', PhysicalAddress);
                    formData.append('Location', Location);
                    formData.append('Village', Village);
                    formData.append('Hamlet', Hamlet);
                    formData.append('PlotNo', PlotNo);
                    formData.append('TinNo', TinNo);
                    formData.append('Fax', Fax);
                    formData.append('CategoryNo', CategoryNo);
                    formData.append('RegionId', RegionId);

                    //formData.append('Status', status);
                    formData.append('PhotoUrl', $("#PhotoUrl")[0].files[0]);
                    if ('@ViewBag.LoanApplicationId' != 0) {
                        formData.append('LoanApplicationId', '@ViewBag.LoanApplicationId');
                    }

                    if (maritalStatus.value == "Married") {
                        formData.append('SpouseName', SpouseName);
                        formData.append('SpouseDateOfBirth', SpouseDateOfBirth);
                        formData.append('SpouseOccupation', SpouseOccupation);
                        //formData.append('SpouseWardId', SpouseWardId);
                        formData.append('SpouseEmail', SpouseEmail);
                        formData.append('SpousePhoneNumber', SpousePhoneNumber);
                        formData.append('SpousePhysicalAddress', SpousePhysicalAddress);
                        formData.append('SpouseLocation', SpouseLocation);
                        formData.append('SpousePhotoUrl', $("#SpousePhotoUrl")[0].files[0]);
                        formData.append('SpousePlotNo', SpousePlotNo);
                        //formData.append('SpouseFax', SpouseFax);
                        //formData.append('SpouseHamlet', SpouseHamlet);
                        //formData.append('SpouseVillage', SpouseVillage);
                        formData.append('SpousePhotoUrl', $("#SpousePhotoUrl")[0].files[0]);
                        formData.append('IndividualAttachmentUrl', null);
                    }else{
                        formData.append('IndividualAttachmentUrl', $("#IndividualAttachmentUrl")[0].files[0]);
                    }
                    if ('@ViewBag.LoanApplicationId' != 0) {
                        editFormData(formData);
                    }else{
                        postFormData(formData);
                    }

                }else{
                    var OrganisationFullname = $("#OrganisationFullname").val();
                    var OrganisationRegistrationDate = $("#OrganisationRegistrationDate").val();
                    var OrganisationPhysicalAddress = $("#OrganisationPhysicalAddress").val();
                    var OrganisationLocation = $("#OrganisationLocation").val();
                    var OrganisationPhoneNumber = $("#OrganisationPhoneNumber").val();
                    var OrganisationFax = $("#OrganisationFax").val();
                    var OrganisationPlotNo = $("#OrganisationPlotNo").val();
                    var OrganisationWardId = $("#OrganisationWardId").val();
                    var OrganisationVillage = $("#OrganisationVillage").val();
                    var OrganisationHamlet = $("#OrganisationHamlet").val();
                    var OrganisationEmail = $("#OrganisationEmail").val();
                    var OrganisationTinNo = $("#OrganisationTinNo").val();
                    var RegistrationCertificate = $("#RegistrationCertificate").val();
                    var OrganisationRegistrationNo = $("#OrganisationRegistrationNo").val();
                    var PlaceOfRegistration = $("#PlaceOfRegistration").val();
                    var CategoryNo = $("#OrganisationCategoryNo").val();
                    var OrganisationRegionId = $("#OrganisationRegionId").val();


                    if(OrganisationPhoneNumber != null){
                        if (OrganisationPhoneNumber.toString().length != 10 || OrganisationPhoneNumber < 0 || OrganisationPhoneNumber == 0) {
                            swal("Please Enter Valid Organisation Phone Number");
                            return false;
                        }
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && RegistrationCertificate == '') {
                        RegistrationCertificate = '@ViewBag.RegistrationCertificate';
                    }
                    else{
                        if(RegistrationCertificate == ''){
                            swal("Please Upload Registration Certificate (PDF Format)")
                            return false;
                        }
                        var file = document.querySelector("#RegistrationCertificate");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Registration Certificate (PDF Format)");
                            return false;
                        }
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && OrganisationRegistrationDate == '' || OrganisationRegistrationDate == '' || OrganisationPhysicalAddress == '' || OrganisationWardId == '' || OrganisationLocation == '' || OrganisationPhoneNumber == '' ||  OrganisationVillage == '' || OrganisationHamlet == '' || RegistrationCertificate == '' || OrganisationRegistrationNo == ''   || (CategoryNo == '' || CategoryNo == 'Select Category')) {
                        OrganisationRegistrationDate = '@ViewBag.OrganisationRegistrationDate';
                    }

                    if (PlaceOfRegistration == '' || OrganisationFullname == '' ) {
                        var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                        swal("Please Fill All the required Fields");
                        return false;
                    }

                    if(CategoryNo == "TinNo"){
                        if(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{3})$/.test(OrganisationTinNo) == false){
                            swal("Please Enter Valid Tin Number, Example Format XXX-XXX-XXX or 9 Digits without Hyphen(-)");
                            return false;
                        }
                    }

                    if(CategoryNo == "NationalIDNo"){
                        if(/^\(?([0-9]{8})\)?[- ]?([0-9]{5})[- ]?([0-9]{5})[- ]?([0-9]{2})$/.test(OrganisationTinNo) == false){
                            swal("Please Enter Valid National ID, Example Format XXXXXXXX-XXXXX-XXXXX-XX or 20 Digits without Hyphen(-)");
                            return false;
                        }
                    }


                    if ('@ViewBag.LoanApplicationId' == 0) {
                        var file = document.querySelector("#RegistrationCertificate");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Registration Certificate Attachment (Only PDF is required)");
                            return false;
                        }
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationFullname) == false) {
                        swal("Special Characters for Full Name are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationPhysicalAddress) == false) {
                        swal("Special Characters for Physical Address are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationLocation) == false) {
                        swal("Special Characters for Location are not allowed");
                        return false;
                    }

                    /*if (/^[a-zA-Z0-9\-_\s]*$/.test(OrganisationPlotNo) == false) {
                        swal("Special Characters for Plot No are not allowed");
                        return false;
                    }*/

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationVillage) == false) {
                        swal("Special Characters for Village are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationHamlet) == false) {
                        swal("Special Characters for Hamlet are not allowed");
                        return false;
                    }

                    if (/^[a-zA-Z0-9\-_'\s]*$/.test(OrganisationRegistrationNo) == false) {
                        swal("Special Characters for Registration No are not allowed");
                        return false;
                    }

                    var formDataOrganisation = new FormData()
                    formDataOrganisation.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formDataOrganisation.append('CustomerType', CustomerTypeLabel);
                    formDataOrganisation.append('OrganisationFullname', OrganisationFullname);
                    formDataOrganisation.append('OrganisationRegistrationDate', OrganisationRegistrationDate);
                    formDataOrganisation.append('OrganisationPhysicalAddress', OrganisationPhysicalAddress);
                    formDataOrganisation.append('OrganisationLocation', OrganisationLocation);
                    formDataOrganisation.append('OrganisationPhoneNumber', OrganisationPhoneNumber);
                    formDataOrganisation.append('OrganisationFax', OrganisationFax);
                    formDataOrganisation.append('OrganisationPlotNo', OrganisationPlotNo);
                    formDataOrganisation.append('OrganisationWardId', OrganisationWardId);
                    formDataOrganisation.append('OrganisationVillage', OrganisationVillage);
                    formDataOrganisation.append('OrganisationHamlet', OrganisationHamlet);
                    formDataOrganisation.append('OrganisationEmail', OrganisationEmail);
                    formDataOrganisation.append('OrganisationTinNo', OrganisationTinNo);
                    formDataOrganisation.append('RegistrationCertificate', $("#RegistrationCertificate")[0].files[0]);
                    formDataOrganisation.append('OrganisationRegistrationNo', OrganisationRegistrationNo);
                    formDataOrganisation.append('PlaceOfRegistration', PlaceOfRegistration);
                    formDataOrganisation.append('CategoryNo', CategoryNo);
                    formDataOrganisation.append('RegionId', OrganisationRegionId);


                    if ('@ViewBag.LoanApplicationId' != 0) {
                        formDataOrganisation.append('LoanApplicationId', '@ViewBag.LoanApplicationId');
                    }
                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.RegistrationCertificate' != null) {
                        editFormData(formDataOrganisation);
                    }else{
                        postFormData(formDataOrganisation);
                    }

                }

            }

            function postFormData(formData) {
                $(".loadingImg").show();
                $("#saveForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()'+"?id="+resultData.id;
                                });
                        } else {
                            $("#saveForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }

            function editFormData(formData) {
                $(".loadingImg").show();
                $("#saveForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                var url = '@Url.Action("EditLoanApplication", "LoanApplication")';
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Applicant Information Updated Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()';
                                });
                        } else {
                            $("#saveForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }

            var dt_endorsement_table = $('#dt_endorsement_table').dataTable({
                "searching": false,
                "paging": false,
                "info": false
            });

            function AddData() {
                // Validate
                var EndorsementFullName = $("#EndorsementFullName").val();
                var EndorsementTitle = $("#EndorsementTitle").val();
                var EndorsementLocation = $("#EndorsementLocation").val();
                var EndorsementDate = $("#EndorsementDate").val();
                var LoanApplicationId = '@ViewBag.LoanApplicationId';

                if (EndorsementFullName == '' || EndorsementTitle == '' || EndorsementLocation == '' || EndorsementDate == '') {
                    swal("Please Fill All the Fields");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(EndorsementFullName) == false) {
                    swal("Special Characters for Endorsement FullName are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(EndorsementTitle) == false) {
                    swal("Special Characters for Endorsement Title are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(EndorsementLocation) == false) {
                    swal("Special Characters for Endorsement Location are not allowed");
                    return false;
                }

                var formDataObj = new FormData()
                formDataObj.append('EndorsementFullName', EndorsementFullName);
                formDataObj.append('EndorsementTitle', EndorsementTitle);
                formDataObj.append('EndorsementLocation', EndorsementLocation);
                formDataObj.append('EndorsementDate', EndorsementDate);
                formDataObj.append('LoanApplicationId', LoanApplicationId);

                $("#saveEndorsementForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                $.ajax({
                    url: '@Url.Action("saveLoanEndorsement", "LoanApplication")',
                    data: formDataObj,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response.message == "Success") {
                            $("#saveEndorsementForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal("Endorsement Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    UpdateTable(response.data)
                                });
                            document.getElementById("EndorsementFullName").value= "";
                            document.getElementById("EndorsementTitle").value= "";
                            document.getElementById("EndorsementLocation").value= "";
                            document.getElementById("EndorsementDate").value= "";

                        } else {
                            $("#saveEndorsementForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(response);
                        }
                    },
                    failure: function (error) {
                        $("#saveEndorsementForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }

            function UpdateTable(_data) {
                dt_endorsement_table.fnClearTable();
                _data.forEach((d,i) => {
                    dt_endorsement_table.fnAddData([
                        i + 1,
                        d.EndorsementFullName,
                        d.EndorsementTitle,
                        ToJavaScriptDate(d.EndorsementDate),
                        d.EndorsementLocation,
                        '<div class="btn-group" id="drop-' + i + '">\
                              <button type="button" class="btn btn-info btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
                                 <span class="caret"></span\
                                     <span class="sr-only"></span>\
                             </button>\
                            <ul class="dropdown-menu">\
                                 <li><a href="@Url.Action("EditEndorsement", "LoanApplication")/?id=' + d.LoanEndorsementId+ '">Edit</a></li>\
                                 <li><a href="#" onclick="cancelEndorsement('+d.LoanEndorsementId+')">Delete</a></li>\
                            </ul>\
                        </div>\ '
                    ])
                })
            }

            function cancelEndorsement(id) {
                swal({
                    title: 'Cancel Selected Endorsement: ?',
                    text: "This process cannot be undone",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var loanApplicationId = '@ViewBag.LoanApplicationId';
                        var url = '@Url.Action("CancelLoanEndorsement", "LoanApplication")';
                        $.ajax({
                            data: { "id": id, "loanApplicationId": loanApplicationId},
                            type: 'POST',
                            dataType: "json",
                            url: url,
                            success: function (response) {
                                if (response.message == "Success") {
                                    swal("Endorsement Cancelled Successfully!", { icon: "success" })
                                        .then((m) => {
                                            UpdateTable(response.data);
                                        });
                                } else {
                                    swal("Error Cancelling Endorsement", { icon: "warning" });
                                }
                            },
                            failure: function (error) {
                                swal("Error Cancelling Endorsement", { icon: "warning" });
                            }
                        });
                    } else {
                        swal("Cancelled", "No change was made");
                    }
                });
            }
            //BEGINNING OF ADDITIONAL COLLATERAL

            var dt_collateral_table = $('#dt_collateral_table').dataTable({
                "searching": false,
                "paging": false,
                "info": false
            });

            var collateralData=[];
            function AddCollateralData() {

                var CollateralRegistrationNo = $("#CollateralRegistrationNo2").val();
                var CollateralPlotNo = $("#CollateralPlotNo2").val();
                var CollateralWardId = $("#CollateralWardId2").val();
                var CollateralVillage = $("#CollateralVillage2").val();
                var CollateralHamlet = $("#CollateralHamlet2").val();
                var CollateralAttachmentUrl = $("#CollateralAttachmentUrl2").val();
                var LoanApplicationId = $("#LoanApplicationId").val();
                var CollateralTypeId = $("#CollateralTypeId2").val();
                var CollateralUsageId = $("#CollateralUsageId2").val();
                var Owner = $("#Owner2").val();
                var BlockNo = $("#BlockNo2").val();
                var CollateralRegistrationNo2 = $("#CollateralRegistrationNo").val();

                if (CollateralRegistrationNo == '' || CollateralWardId == '' || CollateralPlotNo == ''
                    || CollateralVillage == '' || CollateralHamlet == '' || CollateralAttachmentUrl == '' || CollateralUsageId == '' || Owner == '' || BlockNo == '') {
                    var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                    swal("Please Fill All the required Fields");
                    return false;
                }

                if(CollateralAttachmentUrl != ''){
                    var file = document.querySelector("#CollateralAttachmentUrl2");
                    if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                        swal("Please Upload Attachment (PDF Format)");
                        return false;
                    }
                }
                var formData = new FormData()
                formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                formData.append('CollateralRegistrationNo', CollateralRegistrationNo);
                formData.append('CollateralPlotNo', CollateralPlotNo);
                formData.append('CollateralWardId', CollateralWardId);
                formData.append('CollateralVillage', CollateralVillage);
                formData.append('CollateralHamlet', CollateralHamlet);
                formData.append('CollateralUsageId', CollateralUsageId);
                formData.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                formData.append('CollateralName', CollateralTypeId);
                formData.append('CollateralAttachmentUrl', $("#CollateralAttachmentUrl2")[0].files[0]);
                formData.append('Owner', Owner);
                formData.append('BlockNo', BlockNo);
                formData.append('CollateralRegistrationNo2', CollateralRegistrationNo2);

                $("#addCollateralForm").prop('disabled', true);
                $(".saveLoader").toggle(true);

                $.ajax({
                    url: '@Url.Action("saveLoanCollateral", "LoanApplication")',
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response.message == "Success") {
                            $("#addCollateralForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal("Collateral Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    UpdateCollateralTable(response.data)
                                });
                            document.getElementById("CollateralRegistrationNo2").value= "";
                            document.getElementById("CollateralPlotNo2").value= "";
                            document.getElementById("CollateralWardId2").value= "";
                            document.getElementById("CollateralDistrictId2").value= "";
                            document.getElementById("CollateralVillage2").value= "";
                            document.getElementById("CollateralHamlet2").value= "";
                            document.getElementById("CollateralAttachmentUrl2").value= "";
                            document.getElementById("Owner2").value= "";
                            document.getElementById("BlockNo2").value= "";
                            document.getElementById("CollateralWardId2").options.length = 0;

                            $('#CollateralTypeId2').val('');
                            $('#CollateralTypeId2').change();

                            $('#CollateralUsageId2').val('');
                            $('#CollateralUsageId2').change();

                            $('#CollateralRegionId2').val('');
                            $('#CollateralRegionId2').change();

                            $('#CollateralDistrictId2').val('');
                            $('#CollateralDistrictId2').change();

                            $('#CollateralWardId2').val('');
                            $('#CollateralWardId2').change();

                        } else {
                            $("#addCollateralForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(response.data);
                        }
                    },
                    failure: function (error) {
                        $("#addCollateralForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });

            }

            function cancelCollateral(id) {
                swal({
                    title: 'Cancel Selected Collateral: ?',
                    text: "This process cannot be undone",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var loanApplicationId = '@ViewBag.LoanApplicationId';
                        var collateralRegistrationNo = '@ViewBag.CollateralRegistrationNo';
                        var url = '@Url.Action("CancelLoanCollateral", "LoanApplication")';
                        $.ajax({
                            data: { "id": id, "loanApplicationId": loanApplicationId, "collateralRegistrationNo" : collateralRegistrationNo},
                            type: 'POST',
                            dataType: "json",
                            url: url,
                            success: function (response) {
                                if (response.message == "Success") {
                                    swal("Collateral Cancelled Successfully!", { icon: "success" })
                                        .then((m) => {
                                            UpdateCollateralTable(response.data);
                                        });
                                } else {
                                    swal("Error Cancelling Collateral", { icon: "warning" });
                                }
                            },
                            failure: function (error) {
                                swal("Error Cancelling Collateral", { icon: "warning" });
                            }
                        });
                    } else {
                        swal("Cancelled", "No change was made");
                    }
                });
            }

            var globalRegistrationNumber = null;
            var globalOwner = null;
            var data = [];
            function UpdateCollateralTable(x) {
                dt_collateral_table.fnClearTable();
                data = x.data;
                x.forEach((d,i) => {
                    globalRegistrationNumber = d.CollateralRegistrationNo;
                    globalOwner = d.Owner;
                    dt_collateral_table.fnAddData([
                        i + 1,
                        d.CollateralRegistrationNo,
                        d.CollateralPlotNo,
                        d.Owner,
                        d.BlockNo,
                        d.CollateralVillage,
                        d.CollateralHamlet,
                        '<div class="btn-group" id="drop-' + i + '">\
                              <button type="button" class="btn btn-info btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
                                 <span class="caret"></span\
                                     <span class="sr-only"></span>\
                             </button>\
                            <ul class="dropdown-menu">\
                                 <li><a href="@Url.Action("ViewLoanDetails", "ViewLoanApplication")/?Id=' + d.LoanApplicationId+ '" target="_blank">View</a></li>\
                                 <li><a href="#" onclick="cancelCollateral('+d.LoanCollateralId+')">Delete</a></li>\
                            </ul>\
                        </div>\ '
                    ])
                })
            }
            //END OF ADDITIONAL COLLATERAL

            //BEGINNING OF MANAGEMENT

            var dt_management_table = $('#dt_management_table').dataTable({
                "searching": false,
                "paging": false,
                "info": false
            });

            function AddManagementData() {
                // Validate
                var ManagementFullname = $("#ManagementFullname").val();
                var ManagementTitle = $("#ManagementTitle").val();
                var ManagementLocation = $("#ManagementLocation").val();
                var ManagementContact = $("#ManagementContact").val();
                var ManagementPhotoUrl = $("#ManagementPhotoUrl").val();
                var IntroductionLetterUrl = $("#IntroductionLetterUrl").val();

                if (ManagementFullname == '' || ManagementTitle == '' ||  ManagementContact == '' || ManagementLocation == '' || ManagementPhotoUrl == '' || IntroductionLetterUrl == '') {
                    swal("Please Fill All the required Fields");
                    return false;
                }

                var file = document.querySelector("#ManagementPhotoUrl");
                if ( /\.(jpe?g|png|gif)$/i.test(file.files[0].name) === false ) {
                    swal("Please Upload Management Photo");
                    return false;
                }

                var file = document.querySelector("#IntroductionLetterUrl");
                if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                    swal("Please Upload Introduction Letter Attachment (Only PDF is required)");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(ManagementFullname) == false) {
                    swal("Special Characters for Management FullName are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(ManagementTitle) == false) {
                    swal("Special Characters for Management Title are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(ManagementLocation) == false) {
                    swal("Special Characters for Management Location are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_'\s]*$/.test(ManagementContact) == false) {
                    swal("Special Characters for Management Contact are not allowed");
                    return false;
                }

                var formDataObj = new FormData()
                formDataObj.append('ManagementFullname', ManagementFullname);
                formDataObj.append('ManagementTitle', ManagementTitle);
                formDataObj.append('ManagementLocation', ManagementLocation);
                formDataObj.append('ManagementContact', ManagementContact);
                formDataObj.append('ManagementPhotoUrl', $("#ManagementPhotoUrl")[0].files[0]);
                formDataObj.append('IntroductionLetterUrl', $("#IntroductionLetterUrl")[0].files[0]);
                formDataObj.append('LoanApplicationId', @ViewBag.LoanApplicationId);

                $("#saveManagementForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                $.ajax({
                    url: '@Url.Action("saveOrganisationManagement", "LoanApplication")',
                    data: formDataObj,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response.message == "Success") {
                            $("#saveManagementForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal("Management Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    console.log(response.data);
                                    UpdateManagementTable([response.data])
                                });
                            document.getElementById("ManagementFullname").value= "";
                            document.getElementById("ManagementTitle").value= "";
                            document.getElementById("ManagementContact").value= "";
                            document.getElementById("ManagementLocation").value= "";
                            document.getElementById("ManagementPhotoUrl").value= "";
                            document.getElementById("IntroductionLetterUrl").value= "";

                        } else {
                            $("#saveManagementForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(response.message);
                        }
                    },
                    failure: function (error) {
                        $("#saveManagementForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }

            function UpdateManagementTable(_data) {
                _data.forEach((d,i) => {
                    dt_management_table.fnAddData([
                        i + 1,
                        d.ManagementFullname,
                        d.ManagementTitle,
                         d.ManagementContact,
                        d.ManagementLocation,
                        '<a href="#" onclick="removeManagement('+d.OrganisationManagementId+')"><i class="fa fa-trash-o"></i></a>'
                    ])
                })
            }

            function removeManagement(id){
                swal({
                    title: 'Delete Management ?',
                    buttons: [
                      'NO',
                      'YES'
                    ],
                    dangerMode: true,
                }).then(function (isConfirmed) {
                    if (isConfirmed) {
                        removeManagementConfirmed(id);
                    } else {
                        swal("Cancelled", "No change was made");
                    }
                });
            }

            function removeManagementConfirmed(id){
                $.ajax({
                    url: '@Url.Action("DeleteManagement", "LoanApplication")',
                    data: {id},
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response.message == "Success") {
                            swal("Removed Successfully!", { icon: "success" })
                                .then((m) => {
                                    UpdateManagementTable(response.data)
                                });
                        } else {
                            swal(response)
                        }
                    },
                    failure: function (error) {
                        swal(error)
                    }
                });
            }

            //END OF MANAGEMENT
            //console.log(d)

     var dateDifferenceInDays = function (date1, date2) {
                const oneDay = 24 * 60 * 60 * 1000; // hours*minutes*seconds*milliseconds
                var datearray = date1.split("/");
                var newdate1 = datearray[1] + '/' + datearray[0] + '/' + datearray[2];

                var datearray2 = date2.split("/");
                var newdate2 = datearray2[1] + '/' + datearray2[0] + '/' + datearray2[2];

                const firstDate = new Date(newdate1);
                const secondDate = new Date(newdate2);

                const diffDays = Math.round((secondDate - firstDate) / oneDay);
                return diffDays;
            }

            function saveCollateralForm() {
               if (collateralType.value.toUpperCase() == "SALARY") {
                    var BasicSalary = $("#BasicSalary").val();
                    var NetAmount = $("#NetAmount").val();
                    var MaxAllowedDeduction = $("#MaxAllowedDeduction").val();
                    var RequiredDeduction = $("#RequiredDeduction").val();
                    var RetirementDate = document.getElementById("RetirementDate").value;
                    var SalarySlipAttachmentUrl = $("#SalarySlipAttachmentUrl").val();
                    var GuarantorAttachmentUrl = $("#GuarantorAttachmentUrl").val();
                    var LoanApplicationId = $("#LoanApplicationId").val();
                    var CollateralTypeId = $("#CollateralTypeId").val();
                    var SalarySlipMonth = $("#SalarySlipMonth").val();
                    var SalarySlipYear = $("#SalarySlipYear").val();

                    var numberOfDaysToAdd = '@ViewBag.LoanPeriod';

                    Date.prototype.addDays = function(days) {
                        var date = new Date(this.valueOf());
                        date.setDate(date.getDate() + days);
                        return date;
                    }

                    var date = new Date();
                    let formatted_date = date.addDays(numberOfDaysToAdd);
                    let expectedRetirementDate = (formatted_date.getFullYear() + "-" + (formatted_date.getMonth() + 1) + "-" + formatted_date.getDate());
                    if ('@ViewBag.LoanApplicationId' != 0 && RetirementDate == '') {
                        RetirementDate = '@ViewBag.RetirementDate';
                    }
                    if (dateDifferenceInDays(expectedRetirementDate, RetirementDate) < 0) {g
			checkDeduction();
                        swal("Retirement Date is less than Recovery Period", { icon: "warning" })
                        document.getElementById("errorRetirementDate").style.color = 'red';
                        document.getElementById("errorRetirementDate").style.fontWeight = 'bold';
                        $("#errorRetirementDate").text("Retirement Date is less than Recovery Period");
                        return false;
                    }else{
                        $("#errorRetirementDate").text("");
                        checkDeduction();
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && RetirementDate == '') {
                        RetirementDate = '@ViewBag.RetirementDate';
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && SalarySlipAttachmentUrl == '') {
                        SalarySlipAttachmentUrl = '@ViewBag.SalarySlipAttachmentUrl';
                    }
                    else{
                        if(SalarySlipAttachmentUrl == ''){
                            swal("Fill All the Required Fields")
                            return false;
                        }
                        var file = document.querySelector("#SalarySlipAttachmentUrl");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload SalarySlip Attachment");
                            return false;
                        }
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && GuarantorAttachmentUrl == '') {
                        GuarantorAttachmentUrl = '@ViewBag.GuarantorAttachmentUrl';
                    }
                    else{
                        if(GuarantorAttachmentUrl == ''){
                            swal("Fill All the Required Fields")
                            return false;
                        }
                        var file = document.querySelector("#GuarantorAttachmentUrl");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Guarantor Attachment");
                            return false;
                        }
                    }
                    if (BasicSalary == '' || NetAmount == '' || MaxAllowedDeduction == '' || RequiredDeduction == '' || RetirementDate == '' || SalarySlipAttachmentUrl == '' || GuarantorAttachmentUrl == '' || SalarySlipMonth == '' || SalarySlipYear == '') {
                        var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                        swal("Please Fill All the required Fields");
                        return false;
                    }

                    var MaxAllowedDeduction = MaxAllowedDeduction.split(',').join('');
                    var RequiredDeduction = RequiredDeduction.split(',').join('');

                    if (BasicSalary < 0 || NetAmount < 0 || MaxAllowedDeduction < 0 || RequiredDeduction < 0 || SalarySlipMonth < 0  || SalarySlipYear < 0) {
                        swal("Negative Input is not allowed");
                        return false;
                    }

                    if (SalarySlipYear ==  0 || SalarySlipYear.length < 4 || SalarySlipYear.length > 4) {

                        swal("Please Enter valid Salaryslip Year");
                        return false;
                    }

                    if (RequiredDeduction ==  0 || RequiredDeduction == '') {

                        swal("Please Calculate Required Deduction");
                        return false;
                    }

                    var formData = new FormData()
                    formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formData.append('BasicSalary', BasicSalary);
                    formData.append('NetAmount', NetAmount);
                    formData.append('MaxAllowedDeduction', MaxAllowedDeduction);
                    formData.append('RequiredDeduction', RequiredDeduction);
                    formData.append('RetirementDate', RetirementDate);
                    formData.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                    formData.append('CollateralName', CollateralTypeId);
                    formData.append('SalarySlipMonth', SalarySlipMonth);
                    formData.append('SalarySlipYear', SalarySlipYear);
                    formData.append('SalarySlipAttachmentUrl', $("#SalarySlipAttachmentUrl")[0].files[0]);
                    formData.append('GuarantorAttachmentUrl', $("#GuarantorAttachmentUrl")[0].files[0]);

                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.RetirementDate' != "0" ) {
                        editFormCollateralData(formData);
                    }else{
                        postFormCollateralData(formData);
                    }

                }
                else if (collateralType.value.toUpperCase() == "GUARANTORSHIP") {
                    var MeetingNo = $("#MeetingNo").val();
                    var AgendaNo = $("#AgendaNo").val();
                    var MeetingDate = $("#MeetingDate").val();
                    var GuarantorshipAttachmentUrl = $("#GuarantorshipAttachmentUrl").val();
                    var LoanApplicationId = $("#LoanApplicationId").val();
                    var GuarantorshipDistrictId = $("#GuarantorshipDistrictId").val();
                    var CollateralTypeId = $("#CollateralTypeId").val();
                    //var CollateralUsageId = $("#CollateralUsageId").val();
                    var Name = $("#Name").val();
                    var GuarantorPhysicalAddress = $("#GuarantorPhysicalAddress").val();


                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.MeetingNo' != "0" && MeetingDate == '') {
                        MeetingDate = '@ViewBag.MeetingDate';
                    }


                    if ('@ViewBag.LoanApplicationId' != 0 && GuarantorshipAttachmentUrl == '') {
                        GuarantorshipAttachmentUrl = '@ViewBag.GuarantorshipUrl';
                    }
                    else{
                        if(GuarantorshipAttachmentUrl == ''){
                            swal("Fill All the Required Fields")
                            return false;
                        }
                        var file = document.querySelector("#GuarantorshipAttachmentUrl");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Attachment (PDF Format)");
                            return false;
                        }
                    }

                    if (Name == '' || GuarantorPhysicalAddress == '' || MeetingNo == ''  || AgendaNo == '' || MeetingDate == '' || GuarantorshipAttachmentUrl == '' || GuarantorshipDistrictId == '' ||CollateralTypeId == '') {
                        var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                        swal("Please Fill All the required Fields");
                        return false;
                    }

                    if ('@ViewBag.LoanApplicationId' == 0) {
                        var file = document.querySelector("#GuarantorshipAttachmentUrl");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Guarantorship Attachment (Only PDF is required)");
                            return false;
                        }
                    }

                    var formData = new FormData()
                    formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formData.append('MeetingNo', MeetingNo);
                    formData.append('AgendaNo', AgendaNo);
                    formData.append('MeetingDate', MeetingDate);
                    formData.append('GuarantorshipAttachmentUrl', $("#GuarantorshipAttachmentUrl")[0].files[0]);
                    formData.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                    formData.append('GuarantorshipDistrictId', GuarantorshipDistrictId);
                    formData.append('CollateralName', CollateralTypeId);
                    formData.append('Name', Name);
                    formData.append('GuarantorPhysicalAddress', GuarantorPhysicalAddress);
                    //formData.append('CollateralUsageId', CollateralUsageId);
                    console.log(formData);
                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.MeetingNo' != "0" ) {
                        editFormCollateralData(formData);
                    }else{
                        postFormCollateralData(formData);
                    }

                }
                else{
                    var CollateralRegistrationNo = $("#CollateralRegistrationNo").val() || "NA";
                   var CollateralPlotNo = $("#CollateralPlotNo").val() || "NA";
                   var CollateralWardId = $("#CollateralWardId").val();
                   var CollateralVillage = $("#CollateralVillage").val() || "NA";
                   var CollateralHamlet = $("#CollateralHamlet").val() || "NA";
                   var CollateralAttachmentUrl = $("#CollateralAttachmentUrl").val();
                   var LoanApplicationId = $("#LoanApplicationId").val();
                   var CollateralTypeId = $("#CollateralTypeId").val() || 0;
                   var CollateralUsageId = $("#CollateralUsageId").val();
                   var Owner = $("#Owner").val() || "NA";
                   var BlockNo = $("#BlockNo").val() || "NA";
                    if ('@ViewBag.LoanApplicationId' != 0 && CollateralAttachmentUrl == '') {
                        CollateralAttachmentUrl = '@ViewBag.CollateralAttachmentUrl';
                    }
                    else{
                        //if(CollateralAttachmentUrl == ''){
                        //    swal("Fill All the Required Fields")
                        //    return false;
                        //}
                        //var file = document.querySelector("#CollateralAttachmentUrl");
                        //if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                        //    swal("Please Upload Attachment (PDF Format)");
                        //    return false;
                        //}
                   }


                   console.log({CollateralRegistrationNo, CollateralWardId, CollateralPlotNo, CollateralVillage, CollateralHamlet, CollateralUsageId, Owner , BlockNo })

                    if (CollateralRegistrationNo == '' || CollateralPlotNo == ''
                        || CollateralVillage == '' || CollateralHamlet == '' || Owner == '' || BlockNo == '') {
                        var url = '@Url.Action("CreateLoanApplication", "LoanApplication")';
                        swal("Please Fill All the required Fields1");
                        return false;
                    }

                    //var file = document.querySelector("#CollateralAttachmentUrl");
                    //if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                    //    swal("Please Upload Collateral Attachment (Only PDF is required)");
                    //    return false;
                    //}

                    var formData = new FormData()
                    formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formData.append('CollateralRegistrationNo', CollateralRegistrationNo);
                    formData.append('CollateralPlotNo', CollateralPlotNo);
                    formData.append('CollateralWardId', CollateralWardId);
                    formData.append('CollateralVillage', CollateralVillage);
                    formData.append('CollateralHamlet', CollateralHamlet);
                    formData.append('CollateralUsageId', CollateralUsageId);
                    formData.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                    formData.append('CollateralName', CollateralTypeId);
                    formData.append('CollateralAttachmentUrl', $("#CollateralAttachmentUrl")[0].files[0]);
                    formData.append('Owner', Owner);
                    formData.append('BlockNo', BlockNo);
                
                    if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.CollateralRegistrationNo' != "0" ) {
                        editFormCollateralData(formData);
                    }else{
                        postFormCollateralData(formData);
                    }
                }
            }

            function postFormCollateralData(formData) {
                if (collateralType.value.toUpperCase() == "SALARY") {
                    url = '@Url.Action("CreateSalaryLoanCollateral", "LoanApplication")';
                }
                else if (collateralType.value.toUpperCase() == "GUARANTORSHIP") {
                    url = '@Url.Action("CreateGuarantorshipCollateral", "LoanApplication")';
                }else{
                    url = '@Url.Action("CreateLoanCollateral", "LoanApplication")';
                }

                $("#saveCollateralForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveCollateralForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()';
                                });
                        } else {
                            $("#saveCollateralForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveCollateralForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                });
            }


            function editFormCollateralData(formData) {
                if (collateralType.value.toUpperCase() == "SALARY") {
                    url = '@Url.Action("EditSalaryLoanCollateral", "LoanApplication")';
                }
                else if (collateralType.value.toUpperCase() == "GUARANTORSHIP") {
                    url = '@Url.Action("EditGuarantorshipCollateral", "LoanApplication")';
                }else{
                    url = '@Url.Action("EditLoanCollateral", "LoanApplication")';
                }

                $("#saveCollateralForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveCollateralForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Collateral Updated Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()';
                                });
                        } else {
                            $("#saveCollateralForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveCollateralForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                });
            }

            var Quantity = null;
            var LoanProductName =  null;
            function saveApplicationForm() {

                var LoanApplicationId = $("#LoanApplicationId").val();
                var LoanSubProductId = $("#LoanSubProductId").val();
                var LoanPurpose = $("#LoanPurpose").val();
                var AppliedLoanAmount = $("#_AppliedLoanAmount").val();
                var RepaymentSource = $("#RepaymentSource").val();
                var ApplyDate = $("#ApplyDate").val();
                //var LoanDeclaration = $("#LoanDeclaration").val();
                var LoanDeclarationUrl = $("#LoanDeclarationUrl").val();
                var LoanDeclarationDate = $("#LoanDeclarationDate").val();
                //var Quantity = $("#Quantity").val();
                Quantity = $("#Quantity").val();
                var QuantityData = $("#QuantityData").val();
                if ('@ViewBag.LoanApplicationId' != 0 && ApplyDate == '' && '@ViewBag.ApplyDate' != null ) {
                    ApplyDate = '@ViewBag.ApplyDate';
                }

                var LoanDeclaration = null;
                if (
                '@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.INDIVIDUAL.ToUpper()' ||
                '@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.CIVIL_SERVANT.ToUpper()' ||
                '@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.AGITF_STAFF.ToUpper()')
                {
                    LoanDeclaration = "Private";
                }

                else if ('@ViewBag.CustomerTypeLabel' == '@IFMIS.Libraries.Constants.CO_OPERATIVE_SOCIETY.ToUpper()')
                {
                    LoanDeclaration ="General Meeting";
                }
                else
                {
                    LoanDeclaration =  "Board Resolution";
                }

                if (LoanApplicationId == '' || LoanSubProductId == '' || LoanPurpose == '' || AppliedLoanAmount == '' || LoanDeclaration == '' || RepaymentSource == '' || ApplyDate == '' ) {
                    var url = '@Url.Action("CreateApplication", "LoanApplication")';
                    swal("Please Fill All the required Fields");
                    return false;
                }

                if (LoanDeclaration != "Private") {
                    if ('@ViewBag.LoanApplicationId' != 0 && LoanDeclarationDate == '' && '@ViewBag.LoanDeclarationDate' != null ) {
                        LoanDeclarationDate = '@ViewBag.LoanDeclarationDate';
                    }

                    if ('@ViewBag.LoanApplicationId' != 0 && LoanDeclarationUrl == '' && '@ViewBag.LoanDeclarationUrl' != null ) {
                        if (LoanDeclarationUrl == '') {
                            LoanDeclarationUrl = '@ViewBag.LoanDeclarationUrl';
                        }
                        else{
                            var file = document.querySelector("#LoanDeclarationUrl");
                            if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                                swal("Please Upload Declaration Attachment");
                                return false;
                            }
                        }
                    }
                    else{
                        var file = document.querySelector("#LoanDeclarationUrl");
                        if ( /\.(pdf)$/i.test(file.files[0].name) === false ) {
                            swal("Please Upload Declaration Attachment (Only PDF is required)");
                            return false;
                        }
                    }
                    if(LoanDeclarationUrl == '' || LoanDeclarationDate == ''){
                        var url = '@Url.Action("CreateApplication", "LoanApplication")';
                        swal("Please Fill All the required Fields");
                        return false;
                    }

                }

                if (AppliedLoanAmount < 0 ) {
                    swal("Negative Input for Applied Loan Amount is not allowed");
                    return false;
                }

                if(QuantityData == '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()' || QuantityData == '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()'){
                    if (Quantity == '' ) {
                        swal("Quantity is required");
                        return false;
                    }

                    if (Quantity < 0 ) {
                        swal("Negative Input for Quantity is not allowed");
                        return false;
                    }
                }

                if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.LoanDeclaration' != null && ('@ViewBag.Quantity' != null && '@ViewBag.Quantity' != 0) ) {
                    if (Quantity == '' ) {
                        swal("Quantity is required");
                        return false;
                    }

                    if (Quantity < 0 ) {
                        swal("Negative Input for Quantity is not allowed");
                        return false;
                    }
                }
                var formDataApp = new FormData()

                if (LoanDeclaration != "Private") {
                    formDataApp.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formDataApp.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                    formDataApp.append('LoanSubProductId', LoanSubProductId);
                    formDataApp.append('LoanPurpose', LoanPurpose);
                    formDataApp.append('AppliedLoanAmount', AppliedLoanAmount);
                    formDataApp.append('LoanDeclaration', LoanDeclaration);
                    formDataApp.append('RepaymentSource', RepaymentSource);
                    formDataApp.append('ApplyDate', ApplyDate);
                    formDataApp.append('LoanDeclarationUrl', $("#LoanDeclarationUrl")[0].files[0]);
                    formDataApp.append('LoanDeclarationDate', LoanDeclarationDate);

                }
                if(LoanDeclaration == "Private"){
                    formDataApp.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
                    formDataApp.append('LoanApplicationId', @ViewBag.LoanApplicationId);
                    formDataApp.append('LoanSubProductId', LoanSubProductId);
                    formDataApp.append('LoanPurpose', LoanPurpose);
                    formDataApp.append('AppliedLoanAmount', AppliedLoanAmount);
                    formDataApp.append('LoanDeclaration', LoanDeclaration);
                    formDataApp.append('RepaymentSource', RepaymentSource);
                    formDataApp.append('ApplyDate', ApplyDate);
                }

                if(QuantityData == '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()' || QuantityData == '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()'){
                    formDataApp.append('Quantity', Quantity);
                    formDataApp.append('QuantityData', QuantityData);
                }

                if ('@ViewBag.LoanApplicationId' != 0 && '@ViewBag.ApplyDate' != null) {
                    if(QuantityData == '@IFMIS.Libraries.Constants.FARM_MACHINERY.ToUpper()' || '@ViewBag.LoanProductName.ToUpper()' == '@IFMIS.Libraries.Constants.POWER_TILER.ToUpper()'){
                        formDataApp.append('Quantity', Quantity);
                        formDataApp.append('QuantityData', QuantityData);
                    }
                    if(QuantityData == '' || QuantityData == null ){
                        Quantity = 0;
                        formDataApp.append('Quantity',Quantity);
                        formDataApp.append('QuantityData', QuantityData);
                    }

                    if (loanInfoFormValidation()) {
                        editFormApplicationData(formDataApp);
                    }

                }else{
                    if (loanInfoFormValidation()) {
                        postFormApplicationData(formDataApp);
                    }

                }
            }

            function postFormApplicationData(formData) {
                formData.append('PayeeIds', selectedPayeeIds.toString());
                formData.append('CustomerType','@ViewBag.CustomerTypeLabel');
                $(".loadingImg").show();
                $("#saveApplicationForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                var url = '@Url.Action("RegisterApplication", "LoanApplication")';
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveApplicationForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Saved Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()';
                                });
                        } else {
                            $("#saveApplicationForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveApplicationForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }

            function editFormApplicationData(formData) {
                formData.append('PayeeIds', selectedPayeeIds.toString());
                formData.append('CustomerType','@ViewBag.CustomerTypeLabel');
                $(".loadingImg").show();
                $("#saveApplicationForm").prop('disabled', true);
                $(".saveLoader").toggle(true);
                var url = '@Url.Action("EditRegisteredApplication", "LoanApplication")';
                $.ajax({
                    url: url,
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (resultData) {
                        $("#saveApplicationForm").prop('disabled', true);
                        $(".saveLoader").toggle(true);
                        if (resultData.response == "Success") {
                            swal("Loan Information Updated Successfully!", { icon: "success" })
                                .then((m) => {
                                    window.location.href ='@Request.Url.ToString()';
                                });
                        } else {
                            $("#saveApplicationForm").prop('disabled', false);
                            $(".saveLoader").toggle(false);
                            swal(resultData.response)
                        }
                    },
                    failure: function (error) {
                        $("#saveApplicationForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(error)
                    }
                });
            }
            $(".loanPayeeCancellation").on('click', function () {
                var id = $(this).data('id');
                var name = $(this).data('name');
                swal({
                    title: 'Payee Cancellation',
                    text: "Do you what to Cancel Payee " + name + " ?",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var url = '@Url.Action("CancelLoanPayee", "LoanApplication")';
                        $.ajax(
            {
                type: "POST",
                url: url,
                data: { id: id },
                success: function (resultData) {
                    $(".delete").hide();
                    if (resultData.response == "Success") {
                        swal("Cancelled Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href ='@Request.Url.ToString()';
                            });
                    } else {
                        swal("Error in Cancelling Payee");
                    }
                },
                error: function (xhr) {
                    swal("Error in Cancelling Payee");
                },

            });
                    } else {
                        swal("Cancelled", "No change was made");
                    }
                });

            });


            $(".managementCancellation").on('click', function () {
                var id = $(this).data('id');
                var name = $(this).data('name');
                swal({
                    title: 'Management Cancellation',
                    text: "Do you what to Cancel Management " + name + " ?",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var url = '@Url.Action("DeleteManagement", "LoanApplication")';
                        $.ajax(
            {
                type: "POST",
                url: url,
                data: { id: id },
                success: function (resultData) {
                    $(".delete").hide();
                    if (resultData.response == "Success") {
                        swal("Management Cancelled Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href ='@Request.Url.ToString()';
                            });
                    }
                },
                error: function (xhr) {
                    $(".delete").show();
                    swal("Error in Cancelling Management");
                },

            });
                    } else {
                        $(".delete").show();
                        swal("Cancelled", "No change was made");
                    }
                });

            });

            $(".endorsementCancellation").on('click', function () {
                var id = $(this).data('id');
                var name = $(this).data('name');
                swal({
                    title: 'Endorsement Cancellation',
                    text: "Do you what to Cancel Endorsement " + name + " ?",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var url = '@Url.Action("DeleteLoanEndorsement", "LoanApplication")';
                        $.ajax(
            {
                type: "POST",
                url: url,
                data: { id: id },
                success: function (resultData) {
                    $(".delete").hide();
                    if (resultData.response == "Success") {
                        swal("Endorsement Cancelled Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href ='@Request.Url.ToString()';
                            });
                    }
                },
                error: function (xhr) {
                    $(".delete").show();
                    swal("Error in Cancelling Endorsement");
                },

            });
                    } else {
                        $(".delete").show();
                        swal("Cancelled", "No change was made");
                    }
                });

            });


            $(".attachmentCancellation").on('click', function () {
                var id = $(this).data('id');
                var name = $(this).data('name');
                swal({
                    title: 'Attachment Cancellation',
                    text: "Do you what to Cancel Attachment " + name + " ?",
                    buttons: [
                      'No',
                      'Yes'
                    ],
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        var url = '@Url.Action("DeleteLoanAttachment", "LoanApplication")';
                        $.ajax(
            {
                type: "POST",
                url: url,
                data: { id: id },
                success: function (resultData) {
                    $(".delete").hide();
                    if (resultData.response == "Success") {
                        swal("Attachment Cancelled Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href ='@Request.Url.ToString()';
                            });
                    }
                },
                error: function (xhr) {
                    $(".delete").show();
                    swal("Error in Cancelling Attachment");
                },

            });
                    } else {
                        $(".delete").show();
                        swal("Cancelled", "No change was made");
                    }
                });

            });
            function toLabel(number) {
                return number.toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })
            }

            function validateInputsParameters(parameterList) {
                var resetStyle = function (parameterList) {
                    for (var i = 0; i < parameterList.length; i++) {
                        $(parameterList[i] + "_1").attr("style", "color: white;");
                    }
                }

                resetStyle(parameterList);
                for (var i = 0; i < parameterList.length; i++) {
                    if (!$(parameterList[i]).val()) {
                        return parameterList[i];
                    }
                }
                return null;
            }

            function loanInfoFormValidation() {
                var isNotValid = validateInputsParameters([
                   "#LoanPurpose",
                    "#LoanProductId",
                    "#LoanSubProductId",
                    "#AppliedLoanAmount",
                    "#RepaymentSource"
                ]);

                if (isNotValid) {
                    $(isNotValid + "_1").attr("style", "color: red;");
                    swal(isNotValid+" is Required", { icon: "warning" });
                    $(".saveAppLoader").toggle(false);
                    return false;
                }
                return true;
            }

        </script>
    }



