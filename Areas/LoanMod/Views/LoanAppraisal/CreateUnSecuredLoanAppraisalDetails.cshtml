@model IFMIS.Areas.LoanMod.Models.LoanAppraisalVM
@{
    ViewBag.Title = "Loan Appraisal Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    body {
        margin-top: 40px;
    }

    .stepwizard-step p {
        margin-top: 10px;
    }

    .stepwizard-row {
        display: table-row;
    }

    .stepwizard {
        display: table;
        width: 100%;
        position: relative;
    }

    .stepwizard-step button[disabled] {
        opacity: 1 !important;
        filter: alpha(opacity=100) !important;
    }

    .stepwizard-row:before {
        top: 14px;
        bottom: 0;
        position: absolute;
        content: " ";
        width: 100%;
        height: 1px;
        background-color: #ccc;
        z-order: 0;
    }

    .stepwizard-step {
        display: table-cell;
        text-align: center;
        position: relative;
    }

    .loadingImg {
        display: none;
    }

    .search-btn {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 5px;
        padding-right: 10px;
    }

    .search-container {
        display: inline-flex;
        flex: 1 1 300px;
        position: relative;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
        padding-left: 10px;
    }

    .name-input-container {
        display: inline-flex;
        flex: 1 1 300px;
        position: relative;
        overflow: hidden;
    }

    .search-icon {
        padding: 0.5rem;
    }

    .search-button {
        background: #538AC5;
        border: 0;
        color: white;
        padding: 8px;
        border-radius: 0;
    }

    input[type=number] {
        padding: 8px;
        border: 1px solid #ccc;
        width: 205px;
    }

    input[type=text] {
        padding: 5px;
        border: 1px solid #ccc;
    }

    input[type=search] {
        padding: 4px;
        border: hidden;
        border-radius: 4px;
    }

    textarea {
        border: 1px solid #ccc;
    }

    select {
        padding: 8px;
        border: 1px solid #ccc;
        resize: vertical;
        width: 230px;
    }

    .action-btn {
        width: 100px;
        color: white;
    }

    .form-label {
        text-align: right;
    }

    td {
        padding: 5px;
    }

    .info-box {
        padding: 10px;
        background-color: #ECF3F8;
        text-align: center;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    #itemUL li {
        margin-left: -40px;
        border-bottom: 1px solid silver;
        height: 26px;
        padding-left: 5px;
        padding-top: 8px;
        cursor: pointer;
    }

    .imagePropertiesx {
        position: relative;
        top: 80%;
        z-index: 1000;
    }

    .redStar {
        color: red;
        font-size: 15px;
    }
</style>
<div id="content" style="margin: 5px; padding-top: 30px">
    <div class="row"></div>
    <!-- widget grid -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2>@ViewBag.Title </h2>

                    </header>


                    <div>
                        <div class="widget-body " style="padding-top:10px;width:100%">

                            <!----WIZARD HEADING -->
                            <input type="hidden" id="globalLoanApraisalId" name="globalLoanApraisalId" value="@ViewBag.LoanAppraisalId" />
                            <div class="stepwizard">
                                <div class="stepwizard-row setup-panel">
                                    <div class="stepwizard-step">
                                        <a href="#step-1" type="button" class="btn btn-primary btn-circle">1</a>
                                        <p><strong>Initial Information </strong></p>
                                    </div>

                                    <div class="stepwizard-step">
                                        <a href="#step-2" type="button" class="btn btn-default btn-circle">2</a>
                                        <p><strong>Appraisal Information</strong></p>
                                    </div>

                                    <div class="stepwizard-step">
                                        <a href="#step-3" type="button" class="btn btn-default btn-circle">3</a>
                                        <p><strong>Score Card Information</strong></p>
                                    </div>
                                </div>
                            </div>
                            <br />
                            <br />
                            @*--------------------BEGINNING OF STEP ONE-------------------------*@
                            <div class="form-horizontal">
                                <div class="row setup-content" id="step-1">
                                    <div align="center">
                                        <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                    </div>
                                    <form>
                                        <div class="col-xs-12">
                                            <div class="col-md-12">
                                                @Html.AntiForgeryToken()
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Site Visiting Date<span class="redStar">*</span></label>
                                                    <div class="col-md-3">
                                                        <table>
                                                            <tr>
                                                                <td>
                                                                    @if (ViewBag.LoanAppraisalId != 0)
                                                                    {

                                                                        @Convert.ToDateTime(ViewBag.SiteVisitingDate).ToString("dd/MM/yyyy")
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="SiteVisitingDate" id="SiteVisitingDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <div class="flatpickr date-group">
                                                                            <input type="text" placeholder="Select Date.."
                                                                                   data-input
                                                                                   style="width:100px;border:none"
                                                                                   autocomplete="off" name="SiteVisitingDate" id="SiteVisitingDate">
                                                                            <a class="input-button" title="open" data-toggle href="#">
                                                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                            </a>
                                                                        </div>
                                                                    }

                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>

                                                </div>
                                                <fieldset class="scheduler-border localLeaderInformation" style="width:85%;">
                                                    <legend class="scheduler-border"><b>Local Leader</b></legend>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Full Name <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @Html.TextBoxFor(model => model.LeaderName, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                        </div>
                                                        <label class="control-label col-md-2">Phone Number <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @Html.TextBoxFor(model => model.PhoneNumber, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                        </div>

                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Region <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @if (ViewBag.RegionId != null)
                                                            {
                                                                <select id="LocalLeaderRegionId" class="form-control select2">
                                                                    @foreach (var region in ViewBag.PreviewRegionList)
                                                                    {
                                                                        if (ViewBag.RegionId == region.RegionId)
                                                                        {
                                                                            <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value='@region.RegionId'>
                                                                                @region.RegionName
                                                                            </option>
                                                                        }
                                                                    }
                                                                </select>
                                                            }
                                                            else
                                                            {
                                                                @Html.DropDownList("LocalLeaderRegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                            }
                                                        </div>

                                                        <label class="control-label col-md-2">District <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @if (ViewBag.DistrictId != null)
                                                            {
                                                                <select id="LocalLeaderDistrictId" class="form-control select2">
                                                                    @foreach (var district in ViewBag.PreviewDistrictList)
                                                                    {
                                                                        if (ViewBag.DistrictId == district.DistrictId)
                                                                        {
                                                                            <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value='@district.DistrictId'>
                                                                                @district.DistrictName
                                                                            </option>
                                                                        }
                                                                    }
                                                                </select>
                                                            }
                                                            else
                                                            {
                                                                @Html.DropDownList("LocalLeaderDistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                            }

                                                        </div>

                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Ward <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @Html.DropDownList("LocalLeaderWardId", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                        </div>

                                                        <label class="control-label col-md-2">Village / Street <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @Html.TextBoxFor(model => model.LocalLeaderVillage, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Hamlet <span class="redStar">*</span></label>
                                                        <div class="col-md-3">
                                                            @Html.TextBoxFor(model => model.LocalLeaderHamlet, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                        </div>
                                                    </div>

                                                        <div class="form-group">
                                                            <label class="control-label col-md-2">Appraisal Form <span class="redStar">*</span></label>
                                                            <div class="col-md-2">
                                                                @if (ViewBag.AppraisalFormUrl != "0")
                                                                {
                                                                    @Html.TextBoxFor(model => model.AppraisalFormUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                                    <a href="#" data-toggle="modal" data-target=".AppraisalFormUrl" class="btn-xs edit">View Attachment</a>
                                                                }
                                                                else
                                                                {
                                                                    @Html.TextBoxFor(model => model.AppraisalFormUrl, new { @Class = "input", @required = "required", type = "file", style = "width:100%; " })
                                                                }

                                                            </div>
                                                        </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Comments <span class="redStar">*</span></label>
                                                        <div class="col-md-10">

                                                            @Html.TextArea("LocalLeaderComments", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                @if (ViewBag.MaritalStatus != null)
                                                {
                                                    <fieldset class="scheduler-border localLeaderInformation" style="width:85%;">
                                                        <legend class="scheduler-border"><b>Spouse Comments</b></legend>
                                                        <div class="form-group spouseComments">
                                                            <label class="control-label col-md-2"></label>
                                                            <div class="col-md-10">

                                                                @Html.TextArea("SpouseComments", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                }
                                                @if (ViewBag.Guarantor == IFMIS.Libraries.Constants.YES.ToUpper())
                                                {
                                                    <fieldset class="scheduler-border" style="width:85%;">
                                                        <legend class="scheduler-border"><b>Guarantor</b></legend>
                                                        <div class="form-group guarantorComments">
                                                            <label class="control-label col-md-2">Comments<span class="redStar">*</span></label>
                                                            <div class="col-md-10">

                                                                @Html.TextArea("GuarantorComments", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                            </div>
                                                        </div>


                                                        <div class="form-group guarantorComments">
                                                            <label class="control-label col-md-2">Full Name <span class="redStar">*</span> </label>
                                                            <div class="col-md-3">
                                                                @Html.TextBoxFor(model => model.GuarantorName, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                            </div>
                                                            <label class="control-label col-md-2">Phone Number <span class="redStar">*</span></label>
                                                            <div class="col-md-3">
                                                                @Html.TextBoxFor(model => model.GuarantorPhoneNumber, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                            </div>
                                                        </div>

                                                        <div class="form-group guarantorComments">
                                                            <label class="control-label col-md-2">Region <span class="redStar">*</span></label>
                                                            <div class="col-md-3">
                                                                @if (ViewBag.RegionId != null)
                                                                {
                                                                    <select id="GuarantorRegionId" class="form-control select2">
                                                                        @foreach (var region in ViewBag.PreviewRegionList)
                                                                        {
                                                                            if (ViewBag.RegionId == region.RegionId)
                                                                            {
                                                                                <option value='@region.RegionId' selected>@region.RegionName</option>
                                                                            }
                                                                            else
                                                                            {
                                                                                <option value='@region.RegionId'>
                                                                                    @region.RegionName
                                                                                </option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                }
                                                                else
                                                                {
                                                                    @Html.DropDownList("GuarantorRegionId", ViewBag.RegionList as SelectList, "Select Region", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                                }


                                                            </div>
                                                            <label class="control-label col-md-2">District <span class="redStar">*</span></label>
                                                            <div class="col-md-3">
                                                                @if (ViewBag.DistrictId != null)
                                                                {
                                                                    <select id="GuarantorDistrictId" class="form-control select2">
                                                                        @foreach (var district in ViewBag.PreviewDistrictList)
                                                                        {
                                                                            if (ViewBag.DistrictId == district.DistrictId)
                                                                            {
                                                                                <option value='@district.DistrictId' selected>@district.DistrictName</option>
                                                                            }
                                                                            else
                                                                            {
                                                                                <option value='@district.DistrictId'>
                                                                                    @district.DistrictName
                                                                                </option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                }
                                                                else
                                                                {
                                                                    @Html.DropDownList("GuarantorDistrictId", ViewBag.DistrictList as SelectList, "Select District", new { @Class = "input form-control select2", style = "width:300px", required = "required" })
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="form-group guarantorComments">

                                                            <label class="control-label col-md-2">Ward <span class="redStar">*</span></label>
                                                            <div class="col-md-3">
                                                                @Html.DropDownList("GuarantorWardId", ViewBag.WardList as SelectList, "Select Ward", new { @Class = "input form-control select2", style = "width:100%", required = "required" })
                                                            </div>

                                                            <label class="control-label col-md-2">Village / Street<span class="redStar">*</span> </label>
                                                            <div class="col-md-3">
                                                                @Html.TextBoxFor(model => model.GuarantorVillage, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                            </div>
                                                        </div>

                                                        <div class="form-group guarantorComments">
                                                            <label class="control-label col-md-2">Hamlet <span class="redStar">*</span></label>
                                                            <div class="col-md-3">
                                                                @Html.TextBoxFor(model => model.GuarantorHamlet, new { @Class = "input", @required = "required", style = "width:100%; " })
                                                            </div>

                                                        </div>
                                                    </fieldset>
                                                }

                                            </div>
                                            @if (ViewBag.LoanAppraisalId != 0)
                                            {
                                                <input type="hidden" id="LoanAppraisalId" name="LoanAppraisalId" value="@ViewBag.LoanAppraisalId" />
                                                <div class="col-md-offset-2">
                                                    <a href="@Url.Action("AssignedAssessmentList", "LoanAppraisal")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                    <button type="button" class="btn btn-info" onclick="saveInitialForm()" id="saveForm">
                                                        <i class="glyphicon glyphicon-arrow-right"></i>Update
                                                        <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                    </button>
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="col-md-offset-2">
                                                    <a href="@Url.Action("AssignedAssessmentList", "LoanAppraisal")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                    <button type="button" class="btn btn-info" onclick="saveInitialForm()" id="saveForm">
                                                        <i class="glyphicon glyphicon-arrow-right"></i>Save
                                                        <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                    </button>
                                                </div>
                                            }

                                        </div>
                                    </form>

                                </div>
                            </div>
                            @*--------------------END OF STEP ONE--------------------*@

                            @*--------------------BEGINNING OF STEP TWO---------------*@
                            @if (ViewBag.LoanAppraisalId != 0)
                            {
                                <div class="row setup-content" id="step-2">
                                    <div align="center">
                                        <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                    </div>
                                    <form id="lpo">
                                        <div class="form-horizontal">
                                            <div class="col-xs-12">
                                                <div align="center">
                                                    <img src="~/Media/Images/ajax_loader.gif" class="loadingImg" />
                                                </div>
                                                <fieldset class="scheduler-border" style="width:85%;">
                                                    <legend class="scheduler-border"><b>Character Information</b></legend>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Credit History<span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("CreditHistory", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Comments on Credit History<span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("CommentsOnCreditHistory", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">General Comments on Character <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("GeneralCommentsOnCharacter", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <fieldset class="scheduler-border" style="width:85%;">
                                                    <legend class="scheduler-border"><b>Conditions Information</b></legend>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Business Plan <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("BusinessPlan", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Comments on Conditions <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("CommentsOnConditions", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <fieldset class="scheduler-border" style="width:85%;">
                                                    <legend class="scheduler-border"><b>Capacity Information </b></legend>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Other Sources of Income <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("OtherSourcesOfIncome", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Comments on the Applicant Client Capacity <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("CommentsOnClientCapacity", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <fieldset class="scheduler-border" style="width:85%;">
                                                    <legend class="scheduler-border"><b>Capital Information</b></legend>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Tangible and Intangible Assets <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("TangibleAndIntangibleAssets", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">Comments on the Capital <span class="redStar">*</span></label>
                                                        <div class="col-md-10">
                                                            @Html.TextArea("CommentsOnTheCapital", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                        </div>
                                                    </div>
                                                </fieldset>

                                            </div>
                                        </div>
                                    </form>

                                    @if (ViewBag.BusinessPlan != "0")
                                    {
                                        <input type="hidden" id="LoanAppraisalId" name="LoanAppraisalId" value="@ViewBag.LoanAppraisalId" />
                                        <div class="col-md-offset-2">
                                            <a href="@Url.Action("AssignedAssessmentList", "LoanAppraisal")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                            <button type="button" class="btn btn-info" onclick="updateAppraisalForm()" id="saveAppraisalForm">
                                                <i class="glyphicon glyphicon-arrow-right"></i>Update
                                                <img src="~/Content/img/loading.gif" class="saveLoader" />
                                            </button>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-md-offset-2">
                                            <a href="@Url.Action("AssignedAssessmentList", "LoanAppraisal")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                            <button type="button" class="btn btn-info" onclick="updateAppraisalForm()" id="saveAppraisalForm">
                                                <i class="glyphicon glyphicon-arrow-right"></i>Save
                                                <img src="~/Content/img/loading.gif" class="saveLoader" />
                                            </button>
                                        </div>
                                    }

                                </div>
                            }
                            else
                            {
                                <div class="row setup-content" id="step-2">
                                    <div class="row">
                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                        <div class="col-lg-6 col-sm-6 col-xs-6">

                                            <div class="alert alert-block alert-info">
                                                <a class="close" data-dismiss="alert" href="#">×</a>
                                                <h4 class="alert-heading">Appraisal Information</h4>
                                                <center><span>Please Add Initial Information First</span></center>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                    </div>
                                </div>
                            }
                            @*---------------------BEGINNING OF STEP THREE--------------------------*@
                            <div class="row setup-content" id="step-3">

                                @if (ViewBag.LoanAppraisalId != 0 && ViewBag.CreditHistory != null)
                                {
                                    using (Html.BeginForm("CreateScoreCard", "LoanAppraisal", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return validateForm(this);" }))
                                    {
                                        <div class="form-horizontal">
                                            <div class="col-xs-12">
                                                <div>
                                                    <div class="widget-body">
                                                        @Html.AntiForgeryToken()
                                                        <table class="table  table-bordered table-hover table-condensed" id="dt_lpo">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Score Card</th>
                                                                    <th>Criteria</th>
                                                                    <th>Min Value</th>
                                                                    <th>Max Value</th>
                                                                    <th>Score Value</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @if (Model != null && Model.ScoreCardDetailVMList != null)
                                                                {
                                                                    int i = 0;
                                                                    foreach (var item in Model.ScoreCardDetailVMList)
                                                                    {
                                                                        i++;
                                                                        if (item.ScoreCardName == @IFMIS.Libraries.Constants.LOAN_COLLATERAL)
                                                                        {
                                                                            <tr style="display:none">
                                                                                <td>@i</td>
                                                                                <td>

                                                                                    @Html.DisplayFor(modelItem => item.ScoreCardName)

                                                                                    <input type="hidden" name="LoanAppraisalId" id="LoanAppraisalId" value="@ViewBag.LoanAppraisalId" />
                                                                                </td>
                                                                                <td>@Html.DisplayFor(modelItem => item.ScoreDesc)<input type="hidden" name="ScoreCardDetailDataId[]" id="ScoreCardDetailDataId" value="@item.ScoreCardDetailId" /></td>
                                                                                <td>@Html.DisplayFor(modelItem => item.ScoreDetailMinVal)</td>
                                                                                <td id="max-@i">@Html.DisplayFor(modelItem => item.ScoreDetailMaxVal)</td>

                                                                                <td>
                                                                                    @if (item.ScoreCardName == @IFMIS.Libraries.Constants.LOAN_COLLATERAL)
                                                                                    {
                                                                                        <input type="hidden" min="0" required readonly name="ScoreCard[]" id="ScoreCard-@i" />
                                                                                                <span>@IFMIS.Libraries.Constants.WAITING_EVALUATION</span>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <input type="number" min="0" required name="ScoreCard[]" id="ScoreCard-@i" />
                                                                                    }

                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                        else
                                                                        {

                                                                            <tr>
                                                                                <td>@i</td>
                                                                                <td>@Html.DisplayFor(modelItem => item.ScoreCardName) <input type="hidden" name="LoanAppraisalId" id="LoanAppraisalId" value="@ViewBag.LoanAppraisalId" /></td>
                                                                                <td>@Html.DisplayFor(modelItem => item.ScoreDesc)<input type="hidden" name="ScoreCardDetailDataId[]" id="ScoreCardDetailDataId" value="@item.ScoreCardDetailId" /></td>
                                                                                <td>@Html.DisplayFor(modelItem => item.ScoreDetailMinVal)</td>
                                                                                <td id="max-@i">@Html.DisplayFor(modelItem => item.ScoreDetailMaxVal)</td>

                                                                                <td>
                                                                                    @if (item.ScoreCardName == @IFMIS.Libraries.Constants.LOAN_COLLATERAL)
                                                                                    {
                                                                                        <input type="hidden" min="0" required readonly name="ScoreCard[]" id="ScoreCard-@i" />
                                                                                                <span>@IFMIS.Libraries.Constants.WAITING_EVALUATION</span>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <input type="number" min="0" required name="ScoreCard[]" id="ScoreCard-@i" />
                                                                                    }

                                                                                </td>
                                                                            </tr>
                                                                        }

                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                        <table>
                                                            <tr><td>Score (%)</td><td><strong id="displayScore">0</strong></td></tr>
                                                            <tr><td></td><td><span id="displayGradeDecision"></span></td></tr>
                                                            <tr>
                                                                <td>Applied Amount</td>
                                                                <td>@ViewBag.AppliedLoanAmount.ToString("#,##0.###")</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Proposed Amount</td>

                                                                <td><amount-input id="ProposedLoanAmount" name="ProposedLoanAmount" required onkeyup="proposedAmountValidation()" style="width:100%;" class="input" /></td>
                                                            </tr>
                                                            <tr><td></td><td><span id="proposedAmountValidationMessage"></span></td></tr>

                                                            <tr>
                                                               <td><input type="hidden" name="ScoreGrade" id="ScoreGrade" /></td> 
                                                               <td><input type="hidden" name="AppliedLoanAmount" id="AppliedLoanAmount" value="@ViewBag.AppliedLoanAmount" /></td>
                                                            </tr>

                                                        </table>

                                                        <div class="form-group" id="generalComment">
                                                            <div class="col-md-10">
                                                                Appraiser Comments<br />
                                                                @Html.TextArea("GeneralComment", null, new { @class = "form-control", @required = "required", rows = "2", cols = "41", @style = "width:80%;" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>
                                                <div class="col-md-offset-2 btnSaveBack">
                                                    <a href="@Url.Action("AssignedAssessmentList", "LoanAppraisal")" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a>
                                                    <button type="submit" name="submit" id="btnSubmit" class="btn btn-info">
                                                        <i class="glyphicon glyphicon-arrow-right"></i>Finish
                                                        <img src="~/Content/img/loading.gif" class="saveLoader" />
                                                    </button>
                                                </div>
                                    }
                                }
                                else
                                {
                                    <div class="row">
                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                        <div class="col-lg-6 col-sm-6 col-xs-6">

                                            <div class="alert alert-block alert-info">
                                                <a class="close" data-dismiss="alert" href="#">×</a>
                                                <h4 class="alert-heading">Score Card Information</h4>
                                                <center><span>Please Complete Previous Information First</span></center>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                    </div>
                                }
                            </div>
                            @*------------------------------END OF STEP THREE-----------------------------*@


                        </div>
                    </div>
                </div>
            </article>

        </div>
    </section>
    <div class="modal fade AppraisalFormUrl">
        <div class="modal-dialog">
            <div class="modal-body ">

                @if (ViewBag.AppraisalFormUrl != null)
                {
                    <iframe id="AppraisalFormUrl"
                            style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                            title="Title"
                            src="~/Media/Loan/Appraisal/@ViewBag.AppraisalFormUrl"
                            frameborder="1"
                            scrolling="auto"
                            height="600px"
                            width="800px"></iframe>
                }
            </div>
        </div>
    </div>

    <div class="modal fade SecuredAppraisalFormUrl">
        <div class="modal-dialog">
            <div class="modal-body ">

                @if (ViewBag.SecuredAppraisalFormUrl != null)
                {
                    <iframe id="AppraisalFormUrl"
                            style="border:1px solid #666CCC;margin-left:auto;margin-right:auto"
                            title="Title"
                            src="~/Media/Loan/Appraisal/@ViewBag.SecuredAppraisalFormUrl"
                            frameborder="1"
                            scrolling="auto"
                            height="600px"
                            width="800px"></iframe>
                }
            </div>
        </div>
    </div>

</div>


@section pagespecific {
    <!-- PAGE RELATED PLUGIN(S) -->
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script type="text/javascript">
        //START OF CODE
        //SHOW LOADER ICON
        $(document).ajaxStart(function () {
            $(".loadingImg").show();

        });
        //HIDE LOADER ICON
        $(document).ajaxStop(function () {
            $(".loadingImg").hide();
        });

        //MANAGE STEP WIZARD
        var navListItems = $('div.setup-panel div a'),
               allWells = $('.setup-content'),
               allNextBtn = $('.nextBtn');

        allWells.hide();

        navListItems.click(function (e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                    $item = $(this);

            if (!$item.hasClass('disabled')) {
                navListItems.removeClass('btn-primary').addClass('btn-default');
                $item.addClass('btn-primary');
                allWells.hide();
                $target.show();
                $target.find('input:eq(0)').focus();
            }
        });

        allNextBtn.click(function () {
            var curStep = $(this).closest(".setup-content"),
                curStepBtn = curStep.attr("id"),
                nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                curInputs = curStep.find("input[type='text'],input[type='url']"),
                isValid = true;

            $(".form-group").removeClass("has-error");
            for (var i = 0; i < curInputs.length; i++) {
                if (!curInputs[i].validity.valid) {
                    isValid = false;
                    $(curInputs[i]).closest(".form-group").addClass("has-error");
                }
            }

            if (isValid)
                nextStepWizard.removeAttr('disabled').trigger('click');
        });

        $('div.setup-panel div a.btn-primary').trigger('click');
        //END MANAGE STEP WIZARD
        $(".saveLoader").toggle(false);

        $("#LocalLeaderRegionId").change(function () {

            $('#LocalLeaderDistrictId').val('');
            $('#LocalLeaderDistrictId').change();

            $('#LocalLeaderWardId').val('');
            $('#LocalLeaderWardId').change();

            $(document).ajaxStart(function () {
                $(".loadingImg").hide();
            });
            var region = $(this).val();
            document.getElementById("LocalLeaderWardId").value = "";
            document.getElementById("LocalLeaderWardId").disabled = true;
            document.getElementById("LocalLeaderDistrictId").disabled = false;
            getLocalLeaderDistricts(region);
        });

        $("#LocalLeaderDistrictId").change(function () {

            $('#LocalLeaderWardId').val('');
            $('#LocalLeaderWardId').change();

            $(document).ajaxStart(function () {
                $(".loadingImg").hide();
            });
            var district = $(this).val();
            document.getElementById("LocalLeaderWardId").disabled = false;
            getLocalLeaderWards(district);
        });

        function getLocalLeaderDistricts(region) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select District</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#LocalLeaderDistrictId").html(option);
                }
            })
        }

        @*function getLocalLeaderDivisions(district) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select Division</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#LocalLeaderDivisionId").html(option);
                }
            })
        }*@

        function getLocalLeaderWards(district) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select Ward</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#LocalLeaderWardId").html(option);
                }
            })
        }


        $("#GuarantorRegionId").change(function () {

            $('#GuarantorDistrictId').val('');
            $('#GuarantorDistrictId').change();

            $('#GuarantorWardId').val('');
            $('#GuarantorWardId').change();
            $(document).ajaxStart(function () {
                $(".loadingImg").hide();
            });
            var region = $(this).val();
            document.getElementById("GuarantorWardId").value = "";
            document.getElementById("GuarantorWardId").disabled = true;
            document.getElementById("GuarantorDistrictId").disabled = false;
            getGuarantorDistricts(region);
        });

        $("#GuarantorDistrictId").change(function () {

            $('#GuarantorWardId').val('');
            $('#GuarantorWardId').change();

            $(document).ajaxStart(function () {
                $(".loadingImg").hide();
            });
            var district = $(this).val();
            document.getElementById("GuarantorWardId").disabled = false;
            getGuarantorWards(district);
        });

        function getGuarantorDistricts(region) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetDistricts", "Setting")/?region=' + region + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select District</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#GuarantorDistrictId").html(option);
                }
            })
        }

        @*function getGuarantorDivisions(district) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetDivisions", "Setting")/?district=' + district + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select Division</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#GuarantorDivisionId").html(option);
                }
            })
        }*@

        function getGuarantorWards(district) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetWards", "Setting")/?district=' + district + '',
                type: "GET",
                dataType: "json",
                success: function (data) {
                    option.push('<option value="">Select Ward</option>');
                    data.forEach(d=> {
                        option.push('<option value=' + d["Value"] + '>' + d["Text"] + '</option>');
                    });
                    option = option.toString().replace(",", "").replace("[", "").replace("]", "");
                    $("#GuarantorWardId").html(option);
                }
            })
        }

        var saveInitialForm = function () {
            $('#ImageLoading').addClass('imageProperties');
            var SiteVisitingDate = $("#SiteVisitingDate").val();
            var LeaderName = $("#LeaderName").val();
            var PhoneNumber = $("#PhoneNumber").val();
            var LocalLeaderWardId = $("#LocalLeaderWardId").val();
            var LocalLeaderVillage = $("#LocalLeaderVillage").val();
            var LocalLeaderHamlet = $("#LocalLeaderHamlet").val();
            var LocalLeaderComments = $("#LocalLeaderComments").val();

            if ('@ViewBag.LoanAppraisalId' != 0 && SiteVisitingDate == '') {
                SiteVisitingDate = '@ViewBag.SiteVisitingDate';
            }

            if (PhoneNumber != null) {
                    if (PhoneNumber.toString().length != 10 || PhoneNumber < 0 || PhoneNumber == 0) {
                    swal("Please Enter Valid Phone Number");
                    return false;
                }
            }

            var AppraisalFormUrl = $("#AppraisalFormUrl").val();
            var SecuredAppraisalFormUrl = $("#SecuredAppraisalFormUrl").val();

            if ('@ViewBag.LoanSecurityType.ToUpper()' == '@IFMIS.Libraries.Constants.UNSECURED.ToUpper()') {
                if ('@ViewBag.LoanAppraisalId' != 0 && '@ViewBag.AppraisalFormUrl' != "0" && AppraisalFormUrl == '') {
                    AppraisalFormUrl = '@ViewBag.AppraisalFormUrl';
                }
                else {
                    if (AppraisalFormUrl == '') {
                        swal("Upload Appraisal Form")
                        return false;
                    }
                    var file = document.querySelector("#AppraisalFormUrl");
                    if (/\.(pdf)$/i.test(file.files[0].name) === false) {
                        swal("Please Upload Appraisal Form (PDF Format)");
                        return false;
                    }
                }
            }

            if (SiteVisitingDate == '' || LeaderName == '' || PhoneNumber == '' || LocalLeaderWardId == '' || LocalLeaderVillage == '' || LocalLeaderHamlet == '' || LocalLeaderComments == '') {
                swal("Please Fill All the Required Fields");
                return false;
            }

            if ('@ViewBag.MaritalStatus' != null) {
                var SpouseComments = $("#SpouseComments").val();
                if (SpouseComments == '') {

                    swal("Please Fill Spouse Comments");
                    return false;
                }
            }

            if ('@ViewBag.Guarantor' =='@IFMIS.Libraries.Constants.YES.ToUpper()') {
                var GuarantorComments = $("#GuarantorComments").val();
                var GuarantorName = $("#GuarantorName").val();
                var GuarantorPhoneNumber = $("#GuarantorPhoneNumber").val();
                var GuarantorWardId = $("#GuarantorWardId").val();
                var GuarantorVillage = $("#GuarantorVillage").val();
                var GuarantorHamlet = $("#GuarantorHamlet").val();

                if (GuarantorComments == '' || GuarantorName == '' || GuarantorPhoneNumber == '' || GuarantorWardId == '' || GuarantorVillage == '' || GuarantorHamlet == '') {
                    swal("Please Fill All the Required Fields");
                    return false;
                }

                if (GuarantorPhoneNumber != null) {
                    if (GuarantorPhoneNumber.toString().length != 10 || GuarantorPhoneNumber < 0 || GuarantorPhoneNumber == 0) {
                    swal("Please Enter Valid Guarantor Phone Number");
                    return false;
                    }
                }

                if (/^[a-zA-Z0-9\-_\s]*$/.test(GuarantorName) == false) {
                    swal("Special Characters for Guarantor Name are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_\s]*$/.test(GuarantorVillage) == false) {
                    swal("Special Characters for Guarantor Village are not allowed");
                    return false;
                }

                if (/^[a-zA-Z0-9\-_\s]*$/.test(GuarantorHamlet) == false) {
                    swal("Special Characters for Guarantor Hamlet are not allowed");
                    return false;
                }

            }

            var formData = new FormData()
            formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
            formData.append('SiteVisitingDate', SiteVisitingDate);
            formData.append('LeaderName', LeaderName);
            formData.append('PhoneNumber', PhoneNumber);
            formData.append('LocalLeaderWardId', LocalLeaderWardId);
            formData.append('LocalLeaderVillage', LocalLeaderVillage);
            formData.append('LocalLeaderHamlet', LocalLeaderHamlet);
            formData.append('LocalLeaderComments', LocalLeaderComments);
            formData.append('ApplicationNo', '@ViewBag.ApplicationNo');
            formData.append('AppraisalFormUrl', $("#AppraisalFormUrl")[0].files[0]);

            if ('@ViewBag.MaritalStatus' != null) {
                formData.append('SpouseComments', SpouseComments);
            }


            if ('@ViewBag.Guarantor' != null) {
                formData.append('GuarantorComments', GuarantorComments);
                formData.append('GuarantorName', GuarantorName);
                formData.append('GuarantorPhoneNumber', GuarantorPhoneNumber);
                formData.append('GuarantorWardId', GuarantorWardId);
                formData.append('GuarantorVillage', GuarantorVillage);
                formData.append('GuarantorHamlet', GuarantorHamlet);
            }

            if ('@ViewBag.LoanAppraisalId' != 0) {
                formData.append('LoanAppraisalId', '@ViewBag.LoanAppraisalId');
                editFormData(formData);
            }
            else {
                postFormData(formData);
            }

        }

        function postFormData(data) {
            $(".loadingImg").show();
            $("#saveForm").prop('disabled', true);
            $(".saveLoader").toggle(true);
            var url = '@Url.Action("CreateInitialAppraisalDetails", "LoanAppraisal")';
            $.ajax({
                url: url,
                data: data,
                type: 'POST',
                contentType: false,
                processData: false,
                success: function (resultData) {
                    $("#saveForm").prop('disabled', true);
                    $(".saveLoader").toggle(true);
                    if (resultData.response == "Success") {
                        swal("Saved Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href = '@Request.Url.ToString()';
                            });
                    } else {
                        $("#saveForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                },
                failure: function (error) {
                    $("#saveForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    swal("An Error Occur while Creating Initial Appraisal Details")
                }
            });
        }

        function editFormData(data) {
            $(".loadingImg").show();
            $("#saveForm").prop('disabled', true);
            $(".saveLoader").toggle(true);
            var url = '@Url.Action("UpdateInitialAppraisalDetails", "LoanAppraisal")';
            $.ajax({
                url: url,
                data: data,
                type: 'POST',
                contentType: false,
                processData: false,
                success: function (resultData) {
                    $("#saveForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    if (resultData.response == "Success") {
                        swal("Initial Appraisal Details Updated Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href = '@Request.Url.ToString()';
                            });
                    } else {
                        $("#saveForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                },
                failure: function (error) {
                    $("#saveForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    swal("An Error Occur while Updating Initial Appraisal Details")
                }
            });
        }

        /*BEGINNIGN OF APPRAISAL DETAILS*/

        var updateAppraisalForm = function () {
            var CreditHistory = $("#CreditHistory").val();
            var CommentsOnCreditHistory = $("#CommentsOnCreditHistory").val();
            var GeneralCommentsOnCharacter = $("#GeneralCommentsOnCharacter").val();
            var BusinessPlan = $("#BusinessPlan").val();
            var CommentsOnConditions = $("#CommentsOnConditions").val();
            var OtherSourcesOfIncome = $("#OtherSourcesOfIncome").val();
            var CommentsOnClientCapacity = $("#CommentsOnClientCapacity").val();
            var TangibleAndIntangibleAssets = $("#TangibleAndIntangibleAssets").val();
            var CommentsOnTheCapital = $("#CommentsOnTheCapital").val();

            //START OF COLLATERAL
            var AppraisedCollateralMarketValue = $("#AppraisedCollateralMarketValue").val();
            var ForcedValuePercentage = $("#ForcedValuePercentage").val();
            var InsuarableValue = $("#InsuarableValue").val();
            var Encumbrance = $("#Encumbrance").val();
            var Tenor = $("#Tenor").val();
            var OwnershipDocument = $("#OwnershipDocument").val();
            var OwnerOfCollateral = $("#OwnerOfCollateral").val();
            var AddressOfCollateral = $("#AddressOfCollateral").val();
            var LocationOfTheCollateral = $("#LocationOfTheCollateral").val();
            var RiskAssociatedWithCollateral = $("#RiskAssociatedWithCollateral").val();
            var ConditionOnTheCollateral = $("#ConditionOnTheCollateral").val();
            var CommentsOnTheCollateral = $("#CommentsOnTheCollateral").val();
            //END OF COLLATERAL

            if (CreditHistory == '' || CommentsOnCreditHistory == '' || GeneralCommentsOnCharacter == '' || BusinessPlan == '' || CommentsOnConditions == ''
                || OtherSourcesOfIncome == '' || CommentsOnClientCapacity == '' || TangibleAndIntangibleAssets == '' || CommentsOnTheCapital == '') {
                swal("Please Fill All the Required Fields");
                return false;
            }

            var formData = new FormData()
            formData.append('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val());
            formData.append('CreditHistory', CreditHistory);
            formData.append('CommentsOnCreditHistory', CommentsOnCreditHistory);
            formData.append('GeneralCommentsOnCharacter', GeneralCommentsOnCharacter);
            formData.append('BusinessPlan', BusinessPlan);
            formData.append('CommentsOnConditions', CommentsOnConditions);
            formData.append('OtherSourcesOfIncome', OtherSourcesOfIncome);
            formData.append('CommentsOnClientCapacity', TangibleAndIntangibleAssets);
            formData.append('TangibleAndIntangibleAssets', TangibleAndIntangibleAssets);
            formData.append('CommentsOnTheCapital', CommentsOnTheCapital);
            formData.append('ApplicationNo', '@ViewBag.ApplicationNo');
            formData.append('LoanAppraisalId', '@ViewBag.LoanAppraisalId');

            if ('@ViewBag.BusinessPlan' != "0") {
                editAppraisalFormData(formData);
            } else {
                postAppraisalFormData(formData);
            }
        }

        function postAppraisalFormData(data) {
            $(".loadingImg").show();
            $("#saveAppraisalForm").prop('disabled', true);
            $(".saveLoader").toggle(true);
            var url = '@Url.Action("UpdateAppraisalDetails", "LoanAppraisal")';
            $.ajax({
                url: url,
                data: data,
                type: 'POST',
                contentType: false,
                processData: false,
                success: function (resultData) {
                    $("#saveAppraisalForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    if (resultData.response == "Success") {
                        swal("Saved Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href = '@Request.Url.ToString()';
                            });
                    } else {
                        $("#saveAppraisalForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                },
                failure: function (error) {
                    $("#saveAppraisalForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    swal("An Error Occur while Creating Appraisal Details")
                }
            });
        }

        function editAppraisalFormData(data) {
            $(".loadingImg").show();
            $("#saveAppraisalForm").prop('disabled', true);
            $(".saveLoader").toggle(true);
            var url = '@Url.Action("UpdateAppraisalDetails", "LoanAppraisal")';
            $.ajax({
                url: url,
                data: data,
                type: 'POST',
                contentType: false,
                processData: false,
                success: function (resultData) {
                    $("#saveAppraisalForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    if (resultData.response == "Success") {
                        swal("Appraisal Details Updated Successfully!", { icon: "success" })
                            .then((m) => {
                                window.location.href = '@Request.Url.ToString()';
                            });
                    } else {
                        $("#saveAppraisalForm").prop('disabled', false);
                        $(".saveLoader").toggle(false);
                        swal(resultData.response)
                    }
                },
                failure: function (error) {
                    $("#saveAppraisalForm").prop('disabled', false);
                    $(".saveLoader").toggle(false);
                    swal("An Error Occur while Updating Appraisal Details")
                }
            });
        }
        /*END OF APPRAISAL DETAILS*/
        var scores = []
        var inValidScores = []
        var total = 0;
        var totalMaxValue = 0;
        $(document).ready(function () {
            if ($("#globalLoanApraisalId").val() != 0) {
                for (var i = 0; i <= '@Model.ScoreCardDetailVMList.Count()' ; i++) {
                    totalMaxValue += parseInt($(`#max-${i}`).text()) || 0;
                }

                $('input[name="ScoreCard[]"]').on('keyup change paste search cut', function (e) {
                    total = 0;
                    for (var i = 0; i <= '@Model.ScoreCardDetailVMList.Count()' ; i++) {
                        if ($(`#ScoreCard-${i}`).val() == '') {
                            inValidScores.push(i)
                        }
                        if (parseInt($(`#ScoreCard-${i}`).val() || 0) > parseInt($(`#max-${i}`).text()) || parseInt($(`#ScoreCard-${i}`).val()) < 0) {
                            $(`#ScoreCard-${i}`).attr({ 'style': 'color:red' })
                            if (!inValidScores.includes(i)) {
                                inValidScores.push(i)
                            }
                        } else {
                            $(`#ScoreCard-${i}`).attr({ 'style': 'color:black' })
                            total += parseInt($(`#ScoreCard-${i}`).val()) || 0;
                            inValidScores = inValidScores.filter(index=>index != i)
                        }
                    }
                    $("#displaySum").text(total)
                    var percentage = (total / totalMaxValue * 100).toFixed(2);
                    $("#displayScore").text(percentage)
                    $("#ScoreGrade").val(percentage)

                    var scoreGrade = percentage;
                    getScoreGrade(scoreGrade);
                });

            }
        });

        if ('@ViewBag.LoanAppraisalId' != 0){
        document.getElementById('generalComment').style.display = 'block';
        }

        function getScoreGrade(scoreGrade) {
            var option = [];
            $.ajax({
                url: '@Url.Action("GetScoreGrade", "Setting")/?scoreGrade=' + scoreGrade,
                type: "GET",
                dataType: "json",
                success: function (data) {
                    $("#displayGradeDecision").text(data.toString().toUpperCase());
                    document.getElementById("displayGradeDecision").style.fontWeight = 'bold';
                }
            })
        }

        function proposedAmountValidation() {

            var appliedLoanAmount = document.getElementById("AppliedLoanAmount").value;
            var proposedLoanAmount = document.getElementById("ProposedLoanAmount").value;

            var proposedlnAmount = $("#_ProposedLoanAmount").val();
            proposedlnAmount = proposedlnAmount.split(',').join('');

            if (parseFloat(proposedlnAmount) < 0 || parseFloat(proposedlnAmount) == 0 || proposedlnAmount == 'NaN') {
                $("#proposedAmountValidationMessage").text("Proposed Amount should not be Zero or Negative");
                document.getElementById("ProposedLoanAmount").style.color = 'red';
                document.getElementById("ProposedLoanAmount").style.fontWeight = 'bold';
                document.getElementById("btnSubmit").disabled = true;
                document.getElementById("#proposedAmountValidationMessage").style.color = 'red';
            }
            else if (parseFloat(proposedlnAmount) > parseFloat(appliedLoanAmount)) {
                document.getElementById("ProposedLoanAmount").style.color = 'red';
                document.getElementById("ProposedLoanAmount").style.fontWeight = 'bold';
                document.getElementById("btnSubmit").disabled = true;
                document.getElementById("proposedAmountValidationMessage").style.color = 'red';
                $("#proposedAmountValidationMessage").text("Proposed Amount should not Exceed Applied Amount");

            } else {
                document.getElementById("ProposedLoanAmount").style.color = 'black';
                document.getElementById("ProposedLoanAmount").style.fontWeight = 'normal';
                document.getElementById("btnSubmit").disabled = false;
                $("#proposedAmountValidationMessage").text(" ");
            }

        }

        function validateForm(formObj) {
            $(".loadingImg").show();
            $(".saveLoader").show();
            formObj.submit.disabled = true;
            formObj.submit.value = 'Please Wait...';
            successMessage = true;

            if (inValidScores === undefined || inValidScores.length == 0 && total != 0) {

                if (formObj.ProposedLoanAmount.value == '' || formObj.ProposedLoanAmount.value == 0) {
                    swal("Proposed Amount is required and should not be Zero", { icon: "warning" })
                    $(".loadingImg").hide();
                    $(".saveLoader").hide();
                    formObj.submit.disabled = false;
                    return false;
                }

                if (formObj.GeneralComment.value == '') {
                    swal("Appraiser Comments is required", { icon: "warning" })
                    $(".loadingImg").hide();
                    $(".saveLoader").hide();
                    formObj.submit.disabled = false;
                    return false;
                }
            }
            else {
                formObj.submit.disabled = false;
                $(".loadingImg").hide();
                $(".saveLoader").hide();
                swal("Some Score Value fields are Invalid!", { icon: "warning" })
                return false;
            }
        }

        function validateInputsParameters(parameterList) {
            var resetStyle = function (parameterList) {
                for (var i = 0; i < parameterList.length; i++) {
                    $(parameterList[i] + "_1").attr("style", "color: white;");
                }
            }

            resetStyle(parameterList);
            for (var i = 0; i < parameterList.length; i++) {
                if (!$(parameterList[i]).val()) {
                    return parameterList[i];
                }
            }
            return null;
        }
    </script>
}



