@model IFMIS.Areas.CashManagement.Models.GenerateForecastVM

@using (Html.BeginForm("", "", FormMethod.Post, new { id = "form" }))
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.GenerationMonth, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-6">
                @Html.DropDownListFor(model => model.GenerationMonth, Model.GenerationMonths, 
                    "Select Forecast Month", 
                    new { @class = "form-control" }
                )
                @Html.ValidationMessageFor(model => model.GenerationMonth, "", new { @class = "text-danger" })
            </div>
        </div>
    </div>
}

<script>
    $("#btnSave").on("click", function () {
        $("#btnSave").attr("disabled", true);
        $.validator.unobtrusive.parse("#form");
        if (!$("#form").valid()) {
            $("#btnSave").attr("disabled", false);
            return false;
        }
        $("#divLoader").show();
        var token = $("[name='__RequestVerificationToken']").val();
        var formData = new FormData();
        formData.append("__RequestVerificationToken", token);
        formData.append("GenerationMonth", $("#GenerationMonth").val());
        var url = '@Url.Action("GenerateExcelForecast", "Forecasts")';
        $.ajax({
            url: url,
            type: "POST",
            data: formData,
            dataType: "JSON",
            processData: false,
            contentType: false,
            success: function (response) {
                console.log(response);
                if (!response.error) {
                   window.location.href = "@Url.RouteUrl(new { Controller = "Forecasts", Action = "DownloadExcelTemplateV2" })/?fileName=" + response.fileName;
                } else {
                    swal({
                        text: response.message,
                        icon: "warning",
                        button: "OK",
                    })
                }
            },
            error: function () {
                swal({
                    text: "An error occured while processing your request, please contact system support",
                    icon: "error",
                    button: "OK",
                })
            },
            complete: function () {
                $("#btnSave").attr("disabled", false);
                $("#divLoader").hide();
            }
        });
    });
</script>
