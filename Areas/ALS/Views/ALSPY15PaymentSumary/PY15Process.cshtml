@{
    ViewBag.Title = "PY15 Process";
}
<style>
    .search-container {
        background-color: white;
        color: black;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 3px;
        padding-right: 10px;
        padding-left: 10px;
    }

    input[type=number] {
        padding: 8px;
        border: 1px solid #ccc;
    }

    select {
        padding: 8px;
        border: 1px solid #ccc;
        resize: vertical;
        width: 230px;
    }

    input[type=search] {
        padding: 4px;
        border: hidden;
    }

    input[type=text] {
        padding: 8px;
        border: 1px solid #ccc;
    }

    td {
        padding: 5px;
    }

    .table-amount td:nth-child(7) {
        text-align: right;
    }

    .table-view-details td:nth-child(4) {
        text-align: right;
    }

    .payee-entry {
        border: 1px solid #ccc;
        border-radius: 10px;
        padding-bottom: 10px;
    }

    .entry-label {
        position: relative;
        top: -12px;
        background-color: white;
        width: 110px;
        left: 15px;
        padding-left: 5px;
        padding-right: 5px;
        text-align: center;
        font-weight: bold;
        color: #2196F3;
    }

    .total-amount {
        float: right;
    }
</style>
<div id="divLoader">
</div>
<!-- MAIN CONTENT -->
<div id="content">


    <!-- widget grid -->
    <section id="widget-grid" class="">


        <!-- START ROW -->

        <div class="row">

            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2> PY15 Process </h2>

                    </header>

                    <!-- widget div-->
                    <div>
                        <div class="widget-body">
                            <form class="form-horizontal" autocomplete="off" id="createBillForm" name="createBillForm">
                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                <div class="form-group">
                                    <label class="col-md-2 control-label">Category</label>
                                    <div class="col-md-3">
                                        @Html.DropDownList("Category", null, "Select Category", new { @class = "form-control select2" })
                                        @Html.ValidationMessage("Category", "", new { @class = "text-danger" })
                                    </div>
                                    <label class="col-md-2 control-label">Action</label>
                                    <div class="col-md-3">
                                        @Html.DropDownList("Action", new SelectList(""), "Select Action", new { @class = "form-control select2" })
                                        @Html.ValidationMessage("Action", "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    @Html.Label("CheckDate", "Check Date", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-3">
                                        @Html.Editor("CheckDate", new { htmlAttributes = new { @class = "form-control", type = "date" } })
                                        @Html.ValidationMessage("CheckDate", "", new { @class = "text-danger" })
                                    </div>
                                </div>


                                <div class="form-actions">
                                    <div class="row">
                                        <div class="col-md-offset-2 col-md-8">
                                            <button class="btn btn-info" type="submit" onclick="process()" style="float: left" id="btnProcess">
                                                <i class="fa fa-save"></i>
                                                Process
                                            </button>
                                            
                                        </div>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                    <!-- end widget div -->

                </div>
                <!-- end widget -->

            </article>
            <!-- END COL -->

        </div>

        <!-- END ROW -->

    </section>
    <!-- end widget grid -->

</div>
<!-- END MAIN CONTENT -->



@section pagespecific{

    <script>
        // ============ INIT DATA TABLES START =====================


        $("#Category").change(function () {
            debugger
            var category = $("#Category").val();
            var url = '@Url.Action("GetAction", "ALSPY15PaymentSumary")?category=' + category;

            $("#divLoader").show();
            $('#btnProcess').attr("disabled", true);

            $.ajax({
                type: "POST",
                url: url,
                contentType: "html",
                success: function (response) {
                    $("#divLoader").toggle(false);
                    $("#Action").empty();
                    $("#Action").append(response);
                },
                error: function (xhr) {
                    swal("Something went wrong, contact system supporter", { icon: "error" });
                },
                complete: function () {
                    $("#divLoader").hide();
                    $('#btnProcess').attr("disabled", false);
                }
            })
        });

        $("#saveLoader").toggle(false);
        function process() {
            var url = '@Url.Action("PostPY15Process", "ALSPY15PaymentSumary")';
            var Category = $("#Category").val();
            var Action = $("#Action").val();
            var CheckDate = $("#CheckDate").val();
            if (Category == "" || Action == "" || CheckDate == "" ) {
                swal("Please select all input", { icon: "error" });
                return false;
            }

            $("#divLoader").show();
            $('#btnProcess').attr("disabled", true);
            $.ajax({
                type: "post",
                url: url,
                contenttype: "application/json; charset=utf-8",
                datatype: "json",
                data: { category: Category, action: Action, checkdate: CheckDate },
                success: function (response) {
                    debugger
                    if (response == "Success") {
                        swal("Processed Successful", { icon: "success" }).then((value) => {
                                 window.location.reload();
                        });

                    } else {
                        swal("Something went wrong, contact system supporter", { icon: "warning" });
                    }
                },
                error: function (xhr) {
                    swal("Something went wrong, contact system supporter", { icon: "error" });
                },
                complete: function () {
                    $("#divLoader").hide();
                    $('#btnProcess').attr("disabled", false);
                }
            });
        }

        function ToJavaScriptDate(value) {
            var pattern = /Date\(([^)]+)\)/;
            var results = pattern.exec(value);
            var dt = new Date(parseFloat(results[1]));
            return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear();
        }

    </script>
}
