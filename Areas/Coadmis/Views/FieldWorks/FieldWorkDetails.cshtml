@model IFMIS.Areas.Coadmis.Models.FieldWorkSummary
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    .loadingImg {
        display: none;
    }
</style>
<div id="content" style="margin: 5px; padding-top: 50px">
    <div class="row"></div>
    <!-- widget grid -->
    <section id="widget-grid" class="">
        <div class="row">
            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-folder-o"></i> </span>
                        <h2> Field Work Details </h2>
                    </header>

                    <div class="widget-body">
                        <table width="100%" style="margin-bottom:5px">
                            <tr class="alert alert-block alert-info">
                                <td colspan="9" style="font-weight:bold"> Client Name : @Model.ClientName <br /> </td>

                                <td colspan="9" style="font-weight:bold"> Engagement Name : @Model.EngagementName <br /> </td>

                                <td colspan="9" style="font-weight:bold"> Auditable Area : @Model.AuditableArea <br /> </td>
                            </tr>
                        </table>
                        <br />
                        <div class="row">
                            <div class="tabs-left">
                                <ul class="nav nav-tabs tabs-left" id="demo-pill-nav">
                                    <li class="active">
                                        <a href="#tab-r1" data-toggle="tab"><i class="fa fa-folder-open-o" aria-hidden="true"></i> Details   </a>
                                    </li>
                                    <li>
                                        <a href="#tab-r2" data-toggle="tab"><i class="glyphicon glyphicon-list-alt" aria-hidden="true"></i> Audit Program </a>
                                    </li>
                                    <li>
                                        <a href="#tab-r3" data-toggle="tab"><i class="fa fa-bar-chart-o" aria-hidden="true"></i> Lead Schedule </a>
                                    </li>
                                    <li>
                                        <a href="#tab-r4" data-toggle="tab"><i class="fa fa-list" aria-hidden="true"></i>  Summary of Findings </a>
                                    </li>
                                    <li>
                                        <a href="#tab-r5" data-toggle="tab"><i class="fa fa-paperclip" aria-hidden="true"></i>  Attachments  </a>
                                    </li>
                                    <li>
                                        <a href="#tab-r6" data-toggle="tab"><i class="fa fa-comment-o" aria-hidden="true"></i> Remarks </a>
                                    </li>

                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="tab-r1">

                                        <div class="row">

                                            <div class="col-md-8">
                                                <table style="border:1px solid #ffffff;width:500px;height:270px">
                                                    <tr style="border-bottom:1px dashed #cecbcb;padding-bottom:2em">
                                                        <td style="font-weight:bold"> Reference Number :</td>
                                                        <td> @Model.ReferenceNo </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb;padding-bottom:2em">
                                                        <td style="font-weight:bold"> Aditable Area : </td>
                                                        <td> @Model.AuditableArea </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Engagement Name : </td>
                                                        <td> @Model.EngagementName </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Client Name : </td>
                                                        <td> @Model.ClientName </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Audit Financial Year : </td>
                                                        <td> @Model.FinancialYear </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Prepared By : </td>
                                                        <td> @Model.CreatedBy </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Prepared Date : </td>
                                                        <td> @string.Format("{0:d/M/yyyy}", Model.CreatedAt) </td>
                                                    </tr>

                                                    <tr style="border-bottom:1px dashed #cecbcb">
                                                        <td style="font-weight:bold"> Status : </td>
                                                        <td> @Model.Status </td>
                                                    </tr>
                                                </table>

                                            </div>

                                        </div>
                                    </div>
                                    <div class="tab-pane" id="tab-r2">
                                        <div class="row">
                                            <div class="col-md-10">
                                                <table class="table table-condensed table-bordered">
                                                    <thead style="display: table-header-group;">

                                                        <tr style="text-align:center;font-weight:bold;height:20px" bgcolor="lightgrey">
                                                            <td id="fungutd" style="width:5%"> No </td>
                                                            <td id="fungutd" style="width:40%"> Procedures </td>
                                                            <td id="amounttd" style="width:8%"> Test Required </td>
                                                            <td id="amounttdp" style="width:8%"> Result Satisfactory </td>
                                                            <td id="amounttdp" style="width:32%;text-align:center"> Comments </td>
                                                            <td></td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var group1 in ((IEnumerable<IFMIS.Areas.Coadmis.Models.FieldWorkProgram>)Model.FieldPrograms).GroupBy(a => a.Title))
                                                        {


                                                            <tr bgcolor="lightgrey"> <td colspan="8" style="font-weight:bold;width:600px"> @group1.Key </td> </tr>

                                                            foreach (var group in group1)
                                                            {
                                                                <tr>

                                                                    <td style="text-align:center"> @group.ProcedureNo </td>
                                                                    <td> @group.ProgramProcedure  </td>
                                                                    <td>
                                                                        @group.TestRequired
                                                                    </td>
                                                                    <td>
                                                                        @group.ResultSatisfactory
                                                                    </td>
                                                                    <td>
                                                                        @group.Remark
                                                                    </td>


                                                                </tr>
                                                            }


                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="tab-r3">
                                        <div class="row">
                                            <div class="col-md-10">

                                                <table class="table table-condensed table-bordered">
                                                    <thead style="display: table-header-group;">

                                                        <tr style="text-align:center;font-weight:bold;height:20px" bgcolor="lightgrey">
                                                            <td>#</td>
                                                            <td id="fungutd" style="width:30%"> Auditable Item  </td>
                                                            <td id="fungutd" style="width:5%"> WP  </td>
                                                            <td id="fungutd" style="width: 12%;text-align: right"> Previous Amount </td>
                                                            <td id="amounttd" style="width:12%;text-align:right"> Current  Amount </td>
                                                            <td id="amounttdp" style="width:8%"> Adjustment </td>
                                                            <td id="amounttdp" style="width:12%;text-align:right"> Adjusted Amount </td>
                                                            <td id="amounttdp" style="width:12%;text-align:right"> Final Amount </td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @{
                                                            int i = 0;
                                                            foreach (var item in Model.LeadSchedules)
                                                            {
                                                                i++;
                                                                <tr>
                                                                    <td>@i</td>
                                                                    <td> @item.AuditableAreaItem </td>
                                                                    <td>
                                                                        @if (item.SchRef != null)
                                                                        {
                                                                            <a href="#" onclick=preview("@item.SchRef")><i class="glyphicon glyphicon-file" title="Preview"> </i></a>
                                                                        }
                                                                        else
                                                                        {
                                                                            string message = "N/A";
                                                                            @message;
                                                                        }
                                                                    </td>
                                                                    <td> @string.Format("{0:#,0.00}", item.PreviousAmount)</td>
                                                                    <td> @string.Format("{0:#,0.00}", item.CurrentAmount)</td>
                                                                    <td> @item.Adjustment </td>
                                                                    <td> @string.Format("{0:#,0.00}", item.AdjustedAmount) </td>
                                                                    <td>
                                                                        @string.Format("{0:#,0.00}", item.FinalAmount)
                                                                    </td>

                                                                </tr>
                                                            }
                                                        }

                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="tab-r4">
                                        <div class="row">

                                            <div class="col-md-10">

                                                <table class="table table-condensed table-bordered">
                                                    <thead style="display: table-header-group;">

                                                        <tr style="text-align:center;font-weight:bold;height:20px" bgcolor="lightgrey">

                                                            <td id="fungutd" style="width:40%"> Finding Name  </td>
                                                            <td id="fungutd" style="width: 12%;text-align: right"> Criteria </td>
                                                            <td id="amounttd" style="width:12%;text-align:right"> Condition </td>
                                                            <td id="amounttdp" style="width:8%"> Consequence </td>
                                                            <td id="amounttdp" style="width:12%;text-align:right"> Causes </td>
                                                            <td id="amounttdp" style="width:12%;text-align:right"> Recommendation </td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.FwSummaryFindings)
                                                        {
                                                            <tr>
                                                                <td> @item.FindingName </td>
                                                                <td> @item.Criteria </td>
                                                                <td>@item.Condition </td>
                                                                <td> @item.Consequence </td>
                                                                <td> @item.Causes </td>
                                                                <td>
                                                                    @item.Recommendation

                                                                </td>

                                                            </tr>
                                                        }

                                                    </tbody>

                                                </table>
                                            </div>


                                        </div>
                                    </div>
                                    <div class="tab-pane" id="tab-r5">
                                        <div class="row">
                                            <div class="col-md-10">
                                                <table class="table" id="dt_attachments" width="100%">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Attachment Name</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @{
                                                            int id = 0;
                                                            foreach (var item in ViewBag.Attachments)
                                                            {
                                                                id++;
                                                                <tr>
                                                                    <td>
                                                                        @id
                                                                    </td>
                                                                    <td>
                                                                        @item.AttachmentName
                                                                    </td>
                                                                    <td>
                                                                        <a href="#" onclick="previewAttachment('@item.FilePath')"> Preview</a>
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }
                                                    </tbody>
                                                </table>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="tab-r6">
                                        <div class="row">
                                            <div class="smart-timeline" style="height:auto">
                                                <ul class="smart-timeline-list">
                                                    @{
                                                        int z = 0;
                                                        string status = string.Empty;

                                                        if (ViewBag.Remarks.Count != 0)
                                                        {
                                                            foreach (var itemzz in ViewBag.Remarks)
                                                            {
                                                                z++;
                                                                <li>
                                                                    <div class="smart-timeline-icon">
                                                                        <i class="fa fa-user"></i>
                                                                    </div>
                                                                    <div class="smart-timeline-content">
                                                                        <p>
                                                                            <a href="javascript:void(0);"><strong>@itemzz.UserName  <br /> @itemzz.ModuleLevel </strong></a>&nbsp;&nbsp;<small>@itemzz.CreatedAt</small>
                                                                        </p>
                                                                        <p>
                                                                            @itemzz.Remarks
                                                                        </p>
                                                                        @if (itemzz.FilePath == null || itemzz.FilePath == "")
                                                                        {

                                                                        }
                                                                        else
                                                                        {
                                                                            <a href="#" onclick="previewAttachment('@itemzz.FilePath')"> <i class="fa fa-file-pdf-o search-icon"></i> Preview </a>
                                                                        }
                                                                    </div>
                                                                </li>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            status = "No Remarks Provided for this Auditable Area";
                                                            <a  style="text-align:center;margin:450px 0px 0px 10px" class="alert alert-block alert-info">
                                                                @status
                                                            </a>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="form-actions row" style="margin: 10px">
                                <div class="col-md-1">
                                    <a class="btn btn-default" href='@Request.UrlReferrer'><i class="glyphicon glyphicon-arrow-left"></i> Back</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </section>
</div>



<!----------- IMPORT DIALOG ----------------->
<div class="modal fade" id="importModal" style="left:4%">

    <div class="modal-dialog" style="width:40%;">
        <div class="modal-content panel-info">


            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Upload Working Paper </h3>

            </div>
            @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", @class = "well form-horizontal" }))
            {
                <div class="modal-body">
                    <div class="row">

                        <div class="col-md-4">
                            Source Reference
                            <input type="text" class="form-control" name="sourcereference" id="sourcereference" />
                        </div>
                        <div class="col-md-8">
                            Upload File
                            <input class="form-control" id="file2" type="file" name="postedFile" onchange="this.parentNode.nextSibling.value = this.value" required>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" id="importFile">
                        <i class="fa fa-save"></i>Save
                    </button>
                    <button type="submit" class="btn btn-info" data-dismiss="modal">
                        <i class="glyphicon glyphicon"></i>Cancel
                    </button>
                </div>
            }
        </div>
    </div>
</div>


<div class="modal fade" id="slipModal" style="left:4%">

    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content panel-info">
            <div class="modal-header panel-heading">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title"> Attachment Preview  </h3>
            </div>
            <div class="modal-body">
                <div>
                    <div class="widget-body" id="transferSlip_body" style="height:auto">

                        <div id="detailID"><iframe height="700" id="slipImage" width="100%" src=""></iframe></div>

                    </div>
                </div>

                <div class="modal-footer">
                    @*<button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                            <i class="fa fa-check"></i>Accept
                        </button>
                        <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                            <i class="fa  fa-times-circle"></i> Reject
                        </button>*@<button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button><button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button><button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button><button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button><button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button><button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="accept('x')">
                        <i class="fa fa-check"></i>
                    </button>
                    <button class="btn btn-info btn-150" data-dismiss="modal" style="width:100px;" onclick="reject('x')">
                        <i class="fa  fa-times-circle"></i>
                    </button>

                </div>
            </div>
        </div>
    </div>
</div>



@section pagespecific {
    <!-- PAGE RELATED PLUGIN(S) -->
    <script type="text/javascript">
        $(document).ready(function () {
            //  $('#hide-menu > span > a').trigger('click');
        });

        //$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        //    localStorage.setItem('lastTab', $(this).attr('href'));
        //});
        //var lastTab = localStorage.getItem('lastTab');

        //if (lastTab) {
        //    $('[href="' + lastTab + '"]').tab('show');
        //    if (lastTab == "#tab-r2") {
        //        getAdvisors();
        //    }

        //    if (lastTab == "#tab-r3") {
        //        getPersonnels()
        //    }

        //    if (lastTab == "#tab-r4") {
        //        getRegulations();
        //    }

        //    if (lastTab == "#tab-r5") {
        //        getRelated();
        //    }

        //    if (lastTab == "#tab-r6") {
        //        getPolicies();
        //    }

        //    if (lastTab == "#tab-r7") {
        //        getEstimates();
        //    }

        //    if (lastTab == "#tab-r8") {
        //        getService();
        //    }

        //    if (lastTab == "#tab-r9") {
        //        getControl();
        //    }

        //    if (lastTab == "#tab-r10") {
        //        getAssets();
        //    }

        //    if (lastTab == "#tab-r11") {
        //        getContracts();
        //    }

        //    if (lastTab == "#tab-r12") {
        //        getAttachments();
        //    }
        //}

        //**** Starting Banker process ****

        //**** End Banker process ****


        //**** Start Proffessional Advisor process ****




        function ImportOwnSource() {
            $('#importModal').modal('show');
        }

        function previewAttachment(attachmentpath) {
            debugger;
             var url = '@Url.Content("~/Areas/Coadmis/Attachments/")' + attachmentpath;
            document.getElementById("slipImage").src = url;
            $('#detailID').dialog({
                                 autoOpen: true,
                                 width: 900,
                                 height: 700,
                                 position: 'center',
                                 resizable: true,
                                draggable: true
                                });
        };

    </script>
}
