@model IFMIS.Areas.Coadmis.Models.QuestionnaireAnswerDetailVM
@{
    ViewBag.Title = "Preliminary Analysis Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    textarea {
        resize: none;
        width: 100%;
        background-color:white !important;
    }
</style>
<div id="content" style="margin: 5px;">
    <div class="row"></div>
    <!-- widget grid -->
    <section id="widget-grid" class="">
        <div class="row">
            <!-- NEW COL START -->
            <article class="col-sm-12 col-md-12 col-lg-12">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">

                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2> @ViewBag.Title</h2>
                    </header>

                    <div>
                        <div class="widget-body " style="padding-top:10px;width:100%">
                            @*--------------------BEGINNING OF STEP ONE-------------------------*@
                            <div class="form-horizontal">
                                <div class="row setup-content" id="step-1">
                                    <div class="col-xs-12">
                                        <div class="col-md-12">
                                            <div class="form-horizontal">
                                                <div class="col-xs-12">
                                                    <a onclick="history.back()" style="margin-right:5px" type="submit" class="btn btn-info pull-left"><i class="glyphicon glyphicon-arrow-left"></i> Back  </a><br /><br />
                                                    @if (ViewBag.PreliminaryAnalysisId != 0)
                                                    {
                                                        <div class="col-xs-6">
                                                            <table class="table">
                                                                <tr><td colspan="2"><b>Client Name:</b> @ViewBag.ClientName</td></tr>
                                                                <tr><td colspan="2"><b>Financial Year:</b> @ViewBag.FinancialYearName</td></tr>
                                                                <tr><td colspan="2"><b>Status:</b> @ViewBag.Status</td></tr>
                                                                <tr><td colspan="2"><b>Client Type:</b> @ViewBag.ClientType</td></tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>All Questionnaire Full Answered?:</b>
                                                                        @if (ViewBag.IsQuestionnaireFullAnswered == true)
                                                                        {
                                                                            <span>YES</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>NO</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>Is Organisation Independent Questionnaire Full Answered?:</b>
                                                                        @if (ViewBag.IsIndependentQuestionnaireFullAnswered == true)
                                                                        {
                                                                            <span>YES</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>NO</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                                @if (ViewBag.EntranceMeetingDoc != null)
                                                                {
                                                                    <tr>
                                                                        <td colspan="2">
                                                                            <b>Entrance Meeting Attachment:</b>
                                                                            <span><a href="#" onclick="previewAttachment('@ViewBag.EntranceMeetingDoc')">Preview Entrance Meeting</a></span>
                                                                        </td>
                                                                    </tr>
                                                                }

                                                                @if (ViewBag.ProfessionalClearance != null)
                                                                {
                                                                    <tr>
                                                                        <td colspan="2">
                                                                            <b>Attachment:</b>
                                                                            <span><a href="#" onclick="previewAttachment('@ViewBag.ProfessionalClearance')">Preview Professional Clearance</a></span>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </table>
                                                        </div>
                                                        <div class="col-xs-6">
                                                            <table class="table">
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>Is Safe Guard Full Answered?:</b>
                                                                        @if (ViewBag.IsSafeGuardFullAnswered == true)
                                                                        {
                                                                            <span>YES</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>NO</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>Is Engagement Activities Full Answered?:</b>
                                                                        @if (ViewBag.IsEngagementActivitiesFullAnswered == true)
                                                                        {<span>YES</span> }
                                                                        else
                                                                        { <span>NO</span>}
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>Aggreed Amount (Amount with VAT):</b>
                                                                        @if (Model.AgreedAmount != 0)
                                                                        {
                                                                            <span>TZS:@string.Format("{0:#,0.00}", Model.AgreedAmount)</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>TZS:@Model.AgreedAmount</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                                <tr><td colspan="2"><b>VAT:</b> @ViewBag.VAT</td></tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>VAT Amount : </b>
                                                                        @if (Model.VatAmount != 0)
                                                                        {
                                                                            <span>TZS:@string.Format("{0:#,0.00}", Model.VatAmount)</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>TZS:@Model.VatAmount</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2">
                                                                        <b>Calculated Amount (Amount without VAT):</b>

                                                                        @if (Model.CalculatedAmount != 0)
                                                                        {
                                                                            <span>TZS:@string.Format("{0:#,0.00}", Model.CalculatedAmount)</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>TZS:@Model.CalculatedAmount</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*--------------------END OF STEP ONE--------------------*@
                            @*--------------------BEGINNING OF STEP TWO---------------*@
                            <div class="row setup-content" id="step-2">
                                <div class="form-horizontal">
                                    <div class="col-xs-12">
                                        <div class="col-md-12">
                                            @if (ViewBag.PreliminaryAnalysisId != 0)
                                            {

                                                if (Model.GetIndependentQuestionnaire != null && ViewBag.IsIndependentQuestionnaireFullAnswered == false)
                                                {
                                                    /*BEGIN ADDING QUESTIONNAIRE ANSWERS*/
                                                    <h5><b><i>1.Organisation Independent Questionnaire</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.OrgClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.OrgFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.OrgWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>Organisation Independent Questionnair</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.OrgPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.OrgPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0; }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.OrgQuestionnaireDescription</td>
                                                            </tr>
                                                            @foreach (var group in Model.GetIndependentQuestionnaire.GroupBy(a => a.QuestionnairTitleName))
                                                            {
                                                                n++;
                                                                <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                    <td colspan="13">
                                                                        <strong>
                                                                            <span class="sign"></span>
                                                                            @n. @group.Key
                                                                        </strong>
                                                                    </td>
                                                                </tr>

                                                                foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                {
                                                                    int y = 0;

                                                                    int num = 0;
                                                                    if (item.Key != null)
                                                                    {
                                                                        <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                            <td colspan="13">
                                                                                <strong>
                                                                                    <span class="sign"></span>
                                                                                    <i>@item.Key</i>
                                                                                </strong>
                                                                            </td>
                                                                        </tr>

                                                                        foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                        {
                                                                            num++;
                                                                            <tr>
                                                                                <td>@itemQn.Key </td>
                                                                                @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                {

                                                                                    foreach (var data in itemx)
                                                                                    {
                                                                                        y++;

                                                                                        if (itemx.Key == "Radio Button")
                                                                                        {
                                                                                            <td>
                                                                                                <input type="checkbox" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                            </td>
                                                                                        }

                                                                                        else if (itemx.Key == "Text")
                                                                                        {
                                                                                            <td colspan="2">
                                                                                                <label>@data.Value</label>
                                                                                                <input type="hidden" id="QuestionIdForTextAreas-@y" name="QuestionIdForTextAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()" />
                                                                                                <textarea class="form-control answers" id="Answers-@y" rows="4" cols="150" name="Answers[]" readonly></textarea>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@y" />
                                                                                                <label>@data.Value</label>
                                                                                            </td>
                                                                                        }
                                                                                    }
                                                                                }

                                                                            </tr>
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                        foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                        {
                                                                            num++;
                                                                            <tr>
                                                                                <td>@itemQn.Key </td>
                                                                                @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                {

                                                                                    foreach (var data in itemx)
                                                                                    {
                                                                                        y++;

                                                                                        if (itemx.Key == "Radio Button")
                                                                                        {
                                                                                            <td>
                                                                                                <input type="checkbox" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                            </td>
                                                                                        }

                                                                                        else if (itemx.Key == "Text")
                                                                                        {
                                                                                            <td colspan="2">
                                                                                                <label>@data.Value</label>
                                                                                                <input type="hidden" id="QuestionIdForTextAreas-@y" name="QuestionIdForTextAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()" />
                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]"></textarea>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@y" />
                                                                                                <label>@data.Value</label>
                                                                                            </td>
                                                                                        }
                                                                                    }
                                                                                }

                                                                            </tr>
                                                                        }
                                                                    }
                                                                }

                                                            }

                                                        </tbody>
                                                    </table>
                                                    /*END ADDING QUESTIONNAIRE ANSWERS*/
                                                }//END IF STATEMENT

                                                /*BEGIN EDITING QUESTIONNAIRE ANSWERS*/
                                                if (ViewBag.IsIndependentQuestionnaireFullAnswered)
                                                {
                                                    <h5><b><i>1.Organisation Independent Questionnaire</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.OrgClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.OrgFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.OrgWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>Organisation Independent Questionnair</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.OrgPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.OrgPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0;
                                                            }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.OrgQuestionnaireDescription</td>
                                                            </tr>
                                                            @if (Model.GetIndependentQuestionnaire != null)
                                                            {
                                                                foreach (var group in Model.GetIndependentQuestionnaire.GroupBy(a => a.QuestionnairTitleName))
                                                                {
                                                                    n++;
                                                                    List<int> questionList = new List<int>();
                                                                    if (ViewBag.GetIndependentQuestionnaireAnswers != null)
                                                                    {
                                                                        for (var mn = 0; mn < ViewBag.GetIndependentQuestionnaireAnswers.Count; mn++)
                                                                        {
                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers[mn].QuestionId == group.Select(a => a.QuestionId).FirstOrDefault())
                                                                            {
                                                                                questionList.Add((int)group.Select(a => a.QuestionId).FirstOrDefault());
                                                                            }
                                                                        }
                                                                    }

                                                                    if (questionList.Contains((int)group.Select(a => a.QuestionId).FirstOrDefault()))
                                                                    {
                                                                        <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                            <td colspan="13">
                                                                                <strong>
                                                                                    <span class="sign"></span>
                                                                                    @n. @group.Key
                                                                                </strong>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                    foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                    {
                                                                        int y = 0;

                                                                        int num = 0;
                                                                        if (item.Key != null)
                                                                        {

                                                                            if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                            {
                                                                                <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                                    <td colspan="13">
                                                                                        <strong>
                                                                                            <span class="sign"></span>
                                                                                            <i>@item.Key</i>
                                                                                        </strong>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                            foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetIndependentQuestionnaireAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" class="answers" onclick="return false;" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {

                                                                            foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @{
                                                                                        if (ViewBag.GetIndependentQuestionnaireAnswers != null)
                                                                                        {
                                                                                            for (var mn = 0; mn < ViewBag.GetIndependentQuestionnaireAnswers.Count; mn++)
                                                                                            {
                                                                                                if (ViewBag.GetIndependentQuestionnaireAnswers[mn].QuestionId == itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                {
                                                                                                    questionList.Add((int)itemQn.Select(a => a.QuestionId).FirstOrDefault());
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }

                                                                                    @if (questionList.Contains((int)itemQn.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }

                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            //BEGIN CHECKING IF ANSWERS IS NOT NULL
                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetIndependentQuestionnaireAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetIndependentQuestionnaireAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetIndependentQuestionnaireAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            //END CHECKING IF ANSWERS IS NOT NULL
                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }

                                                                }
                                                            }

                                                        </tbody>

                                                    </table>
                                                }
                                                /*END EDITING QUESTIONNAIRE ANSWERS*/
                                            }
                                            else
                                            {
                                                <div class="row">
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                    <div class="col-lg-6 col-sm-6 col-xs-6">

                                                        <div class="alert alert-block alert-info">
                                                            <a class="close" data-dismiss="alert" href="#">×</a>
                                                            <center><span>Independent Questionnaire will display after Client Information added</span></center>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>

                            </div>
                            @*---------------------BEGINNING OF STEP THREE--------------------------*@
                            <div class="row setup-content" id="step-3">
                                <div class="form-horizontal">
                                    <div class="col-xs-12">
                                        <div class="col-md-12">
                                            @if (ViewBag.PreliminaryAnalysisId != 0)
                                            {
                                                if (Model.GetSafeGuard != null && ViewBag.IsSafeGuardFullAnswered == false)
                                                {
                                                    <h5><b><i>2.Other Services To Client and Safeguards Applied</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.SfClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.SfFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.SfWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>Safe Guard</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.SfPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.SfPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    /*BEGIN ADDING QUESTIONNAIRE ANSWERS*/
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0;
                                                            }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.SfQuestionnaireDescription</td>
                                                            </tr>
                                                            @if (Model.GetSafeGuard != null)
                                                            {
                                                                foreach (var group in Model.GetSafeGuard.GroupBy(a => a.QuestionnairTitleName))
                                                                {
                                                                    n++;
                                                                    List<int> questionList = new List<int>();
                                                                    if (ViewBag.GetSafeGuardAnswers != null)
                                                                    {
                                                                        for (var mn = 0; mn < ViewBag.GetSafeGuardAnswers.Count; mn++)
                                                                        {
                                                                            if (ViewBag.GetSafeGuardAnswers[mn].QuestionId == group.Select(a => a.QuestionId).FirstOrDefault())
                                                                            {
                                                                                questionList.Add((int)group.Select(a => a.QuestionId).FirstOrDefault());
                                                                            }
                                                                        }
                                                                    }

                                                                    if (questionList.Contains((int)group.Select(a => a.QuestionId).FirstOrDefault()))
                                                                    {
                                                                        <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                            <td colspan="13">
                                                                                <strong>
                                                                                    <span class="sign"></span>
                                                                                    @n. @group.Key
                                                                                </strong>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                    foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                    {
                                                                        int y = 0;

                                                                        int num = 0;
                                                                        if (item.Key != null)
                                                                        {

                                                                            if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                            {
                                                                                <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                                    <td colspan="13">
                                                                                        <strong>
                                                                                            <span class="sign"></span>
                                                                                            <i>@item.Key</i>
                                                                                        </strong>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                            foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (ViewBag.GetSafeGuardAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetSafeGuardAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetSafeGuardAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetSafeGuardAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetSafeGuardAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" class="answers" onclick="return false;" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {

                                                                            foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @{
                                                                                        if (ViewBag.GetSafeGuardAnswers != null)
                                                                                        {
                                                                                            for (var mn = 0; mn < ViewBag.GetSafeGuardAnswers.Count; mn++)
                                                                                            {
                                                                                                if (ViewBag.GetSafeGuardAnswers[mn].QuestionId == itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                {
                                                                                                    questionList.Add((int)itemQn.Select(a => a.QuestionId).FirstOrDefault());
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }

                                                                                    @if (questionList.Contains((int)itemQn.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }

                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            //BEGIN CHECKING IF ANSWERS IS NOT NULL
                                                                                            if (ViewBag.GetSafeGuardAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetSafeGuardAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetSafeGuardAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetSafeGuardAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetSafeGuardAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            //END CHECKING IF ANSWERS IS NOT NULL
                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }

                                                                }
                                                            }

                                                        </tbody>
                                                    </table>
                                                    /*END ADDING QUESTIONNAIRE ANSWERS*/
                                                }//END IF STATEMENT

                                                /*BEGIN EDITING QUESTIONNAIRE ANSWERS*/
                                                if (ViewBag.IsSafeGuardFullAnswered)
                                                {
                                                    <h5><b><i>2.Other Services To Client and Safeguards Applied</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.SfClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.SfFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.SfWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>Safe Guard</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.SfPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.SfPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0;
                                                            }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.SfQuestionnaireDescription</td>
                                                            </tr>
                                                            @if (Model.GetSafeGuard != null)
                                                            {
                                                                foreach (var group in Model.GetSafeGuard.GroupBy(a => a.QuestionnairTitleName))
                                                                {
                                                                    n++;
                                                                    <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                        <td colspan="13">
                                                                            <strong>
                                                                                <span class="sign"></span>
                                                                                @n. @group.Key
                                                                            </strong>
                                                                        </td>
                                                                    </tr>

                                                                    foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                    {
                                                                        int y = 0;

                                                                        int num = 0;
                                                                        if (item.Key != null)
                                                                        {
                                                                            <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                                <td colspan="13">
                                                                                    <strong>
                                                                                        <span class="sign"></span>
                                                                                        <i>@item.Key</i>
                                                                                    </strong>
                                                                                </td>
                                                                            </tr>
                                                                            foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    <td>@itemQn.Key </td>
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (ViewBag.GetSafeGuardAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetSafeGuardAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetSafeGuardAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetSafeGuardAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetSafeGuardAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    <td>@itemQn.Key </td>
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (ViewBag.GetSafeGuardAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetSafeGuardAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetSafeGuardAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetSafeGuardAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetSafeGuardAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetSafeGuardAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetSafeGuardAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetSafeGuardAnswers[nm].Answer-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetSafeGuardAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetSafeGuardAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }

                                                                }
                                                            }

                                                        </tbody>
                                                    </table>
                                                }
                                                /*END EDITING QUESTIONNAIRE ANSWERS*/
                                            }
                                            else
                                            {
                                                <div class="row">
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                    <div class="col-lg-6 col-sm-6 col-xs-6">

                                                        <div class="alert alert-block alert-info">
                                                            <a class="close" data-dismiss="alert" href="#">×</a>
                                                            <center><span>Safe Guard will display after Independent Questionnaire added</span></center>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*------------------------------END OF STEP THREE-----------------------------*@
                            @*------------------------------BEGINNING OF STEP FOUR------------------------*@
                            <div class="row setup-content" id="step-4">
                                <div class="form-horizontal">
                                    <div class="col-xs-12">
                                        <div class="col-md-12">
                                            @if (ViewBag.PreliminaryAnalysisId != 0)
                                            {
                                                if (Model.GetEngagementActivities != null && ViewBag.IsEngagementActivitiesFullAnswered == false)
                                                {
                                                    <h5><b><i>3.General Preliminary Engagement</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.EnClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.EnFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.EnWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>General Preliminary Engagement</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.EnPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.EnPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    /*BEGIN ADDING QUESTIONNAIRE ANSWERS*/
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0;
                                                            }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.EnQuestionnaireDescription</td>
                                                            </tr>
                                                            @if (Model.GetEngagementActivities != null)
                                                            {
                                                                foreach (var group in Model.GetEngagementActivities.GroupBy(a => a.QuestionnairTitleName))
                                                                {
                                                                    n++;
                                                                    <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                        <td colspan="13">
                                                                            <strong>
                                                                                <span class="sign"></span>
                                                                                @n. @group.Key
                                                                            </strong>
                                                                        </td>
                                                                    </tr>

                                                                    foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                    {
                                                                        int y = 0;

                                                                        int num = 0;
                                                                        if (item.Key != null)
                                                                        {
                                                                            <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                                <td colspan="13">
                                                                                    <strong>
                                                                                        <span class="sign"></span>
                                                                                        <i>@item.Key</i>
                                                                                    </strong>
                                                                                </td>
                                                                            </tr>

                                                                            foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    <td>@itemQn.Key </td>
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (itemx.Key == "Radio Button")
                                                                                            {
                                                                                                <td>
                                                                                                    <input type="checkbox" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                                </td>
                                                                                            }

                                                                                            else if (itemx.Key == "Text")
                                                                                            {
                                                                                                <td colspan="2">
                                                                                                    <label>@data.Value</label>
                                                                                                    <input type="hidden" id="QuestionIdForTextAreas-@y" name="QuestionIdForTextAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()" />
                                                                                                    <textarea readonly class="form-control answers" id="Answers-@y" rows="4" cols="150" name="Answers[]"></textarea>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <td>
                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@y" />
                                                                                                    <label>@data.Value</label>
                                                                                                </td>
                                                                                            }
                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {

                                                                            foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    <td>@itemQn.Key </td>
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (itemx.Key == "Radio Button")
                                                                                            {
                                                                                                <td>
                                                                                                    <input type="checkbox" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@num" onclick="return false;" />@data.Value
                                                                                                </td>
                                                                                            }

                                                                                            else if (itemx.Key == "Text")
                                                                                            {
                                                                                                <td colspan="2">
                                                                                                    <label>@data.Value</label>
                                                                                                    <input type="hidden" id="QuestionIdForTextAreas-@y" name="QuestionIdForTextAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()" />
                                                                                                    <textarea readonly class="form-control answers" id="Answers-@y" rows="4" cols="150" name="Answers[]"></textarea>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <td>
                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value" name="Answers[]" id="Answers-@y" />
                                                                                                    <label>@data.Value</label>
                                                                                                </td>
                                                                                            }
                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }

                                                                }

                                                            }

                                                        </tbody>
                                                    </table>
                                                    /*END ADDING QUESTIONNAIRE ANSWERS*/
                                                }//END IF STATEMENT

                                                /*BEGIN EDITING QUESTIONNAIRE ANSWERS*/
                                                if (ViewBag.IsEngagementActivitiesFullAnswered)
                                                {
                                                    <h5><b><i>3.General Preliminary Engagement</i></b></h5>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt><strong>Client Name:</strong></dt>
                                                                <dd>@ViewBag.EnClientName</dd>
                                                                <dt><strong>File No.:</strong></dt>
                                                                <dd>@ViewBag.EnFileNo</dd>
                                                                <dt> <strong>Working Paper Ref:</strong></dt>
                                                                <dd> @ViewBag.EnWorkPaper</dd>
                                                            </dl>
                                                        </div>
                                                        <div class="col-md-6" style="padding-top:20px">
                                                            <dl class="dl-horizontal">
                                                                <dt>Questionnaire Title</dt>
                                                                <dd>General Preliminary Engagement</dd>
                                                                <dt><strong>Prepared By:</strong></dt>
                                                                <dd>@ViewBag.EnPreparedBy</dd>
                                                                <dt><strong>Prepared At:</strong></dt>
                                                                <dd>@ViewBag.EnPreparedAt</dd>
                                                            </dl>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <table id="dataTableList" class="table table-striped table-bordered table-hover" width="100%">
                                                        <thead><tr></tr></thead>
                                                        <tbody>
                                                            @{ int n = 0;
                                                            }
                                                            <tr>
                                                                <td colspan="3" style="">@ViewBag.EnQuestionnaireDescription</td>
                                                            </tr>
                                                            @if (Model.GetEngagementActivities != null)
                                                            {
                                                                foreach (var group in Model.GetEngagementActivities.GroupBy(a => a.QuestionnairTitleName))
                                                                {
                                                                    n++;
                                                                    List<int> questionList = new List<int>();
                                                                    if (ViewBag.GetEngagementActivitiesAnswers != null)
                                                                    {
                                                                        for (var mn = 0; mn < ViewBag.GetEngagementActivitiesAnswers.Count; mn++)
                                                                        {
                                                                            if (ViewBag.GetEngagementActivitiesAnswers[mn].QuestionId == group.Select(a => a.QuestionId).FirstOrDefault())
                                                                            {
                                                                                questionList.Add((int)group.Select(a => a.QuestionId).FirstOrDefault());
                                                                            }
                                                                        }
                                                                    }

                                                                    if (questionList.Contains((int)group.Select(a => a.QuestionId).FirstOrDefault()))
                                                                    {
                                                                        <tr data-level='1' style="background:#f5f5f5; color:#000000">
                                                                            <td colspan="13">
                                                                                <strong>
                                                                                    <span class="sign"></span>
                                                                                    @n. @group.Key
                                                                                </strong>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                    foreach (var item in group.GroupBy(a => a.QuestionnairSubTitleName))
                                                                    {
                                                                        int y = 0;

                                                                        int num = 0;
                                                                        if (item.Key != null)
                                                                        {

                                                                            if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                            {
                                                                                <tr data-level='1' style="background:#f5f5f5; color:#000000;">
                                                                                    <td colspan="13">
                                                                                        <strong>
                                                                                            <span class="sign"></span>
                                                                                            <i>@item.Key</i>
                                                                                        </strong>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                            foreach (var itemQn in item.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @if (questionList.Contains((int)item.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }
                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            if (ViewBag.GetEngagementActivitiesAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetEngagementActivitiesAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetEngagementActivitiesAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].Answer-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetEngagementActivitiesAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetEngagementActivitiesAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a=>a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].Answer-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {

                                                                            foreach (var itemQn in group.GroupBy(a => a.Question))
                                                                            {
                                                                                num++;
                                                                                <tr>
                                                                                    @{
                                                                                        if (ViewBag.GetEngagementActivitiesAnswers != null)
                                                                                        {
                                                                                            for (var mn = 0; mn < ViewBag.GetEngagementActivitiesAnswers.Count; mn++)
                                                                                            {
                                                                                                if (ViewBag.GetEngagementActivitiesAnswers[mn].QuestionId == itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                {
                                                                                                    questionList.Add((int)itemQn.Select(a => a.QuestionId).FirstOrDefault());
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }

                                                                                    @if (questionList.Contains((int)itemQn.Select(a => a.QuestionId).FirstOrDefault()))
                                                                                    {
                                                                                        <td>
                                                                                            @itemQn.Key
                                                                                        </td>
                                                                                    }

                                                                                    @foreach (var itemx in itemQn.GroupBy(a => a.Lebal))
                                                                                    {

                                                                                        foreach (var data in itemx)
                                                                                        {
                                                                                            y++;

                                                                                            //BEGIN CHECKING IF ANSWERS IS NOT NULL
                                                                                            if (ViewBag.GetEngagementActivitiesAnswers != null)
                                                                                            {
                                                                                                for (var nm = 0; nm < ViewBag.GetEngagementActivitiesAnswers.Count; nm++)
                                                                                                {
                                                                                                    if (ViewBag.GetEngagementActivitiesAnswers[nm].QuestionId == @itemQn.Select(a => a.QuestionId).FirstOrDefault())
                                                                                                    {

                                                                                                        if (itemx.Key == "Radio Button")
                                                                                                        {

                                                                                                            if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer == data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].Answer-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                            else if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer != data.Value)
                                                                                                            {
                                                                                                                <td>
                                                                                                                    <input type="checkbox" onclick="return false;" class="answers" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@num" onclick="AllowSingleSelection(this);" />@data.Value
                                                                                                                </td>
                                                                                                            }
                                                                                                        }
                                                                                                        else if (itemx.Key == "Text")
                                                                                                        {
                                                                                                            <td colspan="2">
                                                                                                                <label>@data.Value</label>
                                                                                                                <input type="hidden" id="QuestionIdForTxtAreas-@y" name="QuestionIdForTxtAreas[]" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" />
                                                                                                                <textarea class="form-control answers" readonly id="Answers-@y" rows="4" cols="150" name="Answers[]">@ViewBag.GetEngagementActivitiesAnswers[nm].Answer</textarea>
                                                                                                            </td>
                                                                                                        }
                                                                                                        else
                                                                                                        {

                                                                                                            if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer.Contains(","))
                                                                                                            {
                                                                                                                string[] answerArray = ViewBag.GetEngagementActivitiesAnswers[nm].Answer.Split(',');

                                                                                                                <td>
                                                                                                                    @for (var z = 0; z < answerArray.Count(); z++)
                                                                                                                    {
                                                                                                                        if (answerArray[z] == data.Value)
                                                                                                                        {
                                                                                                                            <input type="checkbox" onclick="return false;" class="answers" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@answerArray[z]-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                            <label>@data.Value</label>
                                                                                                                        }
                                                                                                                    }
                                                                                                                    @if (!answerArray.Contains(data.Value))
                                                                                                                    {
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    }

                                                                                                                </td>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer == data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" checked value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@ViewBag.GetEngagementActivitiesAnswers[nm].Answer-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                                else if (ViewBag.GetEngagementActivitiesAnswers[nm].Answer != data.Value)
                                                                                                                {
                                                                                                                    <td>
                                                                                                                        <input type="checkbox" class="answers" onclick="return false;" value="@itemQn.Select(a => a.QuestionId).FirstOrDefault()_@data.Value-@ViewBag.GetEngagementActivitiesAnswers[nm].QuestionnaireAnswerDetailId" name="Answers[]" id="Answers-@y" />
                                                                                                                        <label>@data.Value</label>
                                                                                                                    </td>
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            //END CHECKING IF ANSWERS IS NOT NULL
                                                                                        }
                                                                                    }

                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }

                                                                }
                                                            }

                                                        </tbody>
                                                    </table>
                                                }
                                                /*END EDITING QUESTIONNAIRE ANSWERS*/

                                            }
                                            else
                                            {
                                                <div class="row">
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                    <div class="col-lg-6 col-sm-6 col-xs-6">

                                                        <div class="alert alert-block alert-info">
                                                            <a class="close" data-dismiss="alert" href="#">×</a>
                                                            <center><span>General Preliminary Engagement Questionnaire will display after Safe Guard Questionnaire added</span></center>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3 col-sm-3 col-xs-3"></div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*------------------------------------END OF STEP FOUR---------------------------------------*@
                        </div>
                    </div>
                </div>
            </article>
            <div class="modal modal-lg fade " id="attachmentModal" style="margin-left:20%; ">
                <div class="modal-dialog  modal-lg modal-dialog-centered">
                    <div class="modal-content bg-white">
                        <div class="modal-header alert alert-info">
                            <a href="#" class="close" data-dismiss="modal">&times;</a>
                            <h3 class="modal-title">Professional Clearance</h3>
                        </div>

                        <!-- Modal body -->
                        <div class="modal-body ">
                            <embed id="embedDocument" style="height: 70vh !important;" width="100"
                                   class="embed-responsive-item col-md-12" src="images/sample.pdf" />
                        </div>
                        <!-- Modal footer -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">
                                Close
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
   
</div>

@section pagespecific {
    <!-- PAGE RELATED PLUGIN(S) -->
    <script type="text/javascript">
        function previewAttachment(attachment) {
            urlLink = '@Url.Content("~/Media/Attachments/")' + attachment;
            document.getElementById("embedDocument").setAttribute("src", urlLink);
            $("#attachmentModal").modal("show");
        }
    </script>
}


